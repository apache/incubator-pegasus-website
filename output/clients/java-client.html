<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pegasus | Java Client</title>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" href="/assets/css/utilities.min.css">
    <link rel="stylesheet" href="/assets/css/docsearch.v3.css">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/all.min.js"></script>
    <script src="/assets/js/docsearch.v3.js"></script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Java Client | Pegasus</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Java Client" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Getting the Java Client" />
<meta property="og:description" content="Getting the Java Client" />
<meta property="og:site_name" content="Pegasus" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-17T03:48:47+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Java Client" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-17T03:48:47+00:00","datePublished":"2025-04-17T03:48:47+00:00","description":"Getting the Java Client","headline":"Java Client","mainEntityOfPage":{"@type":"WebPage","@id":"/clients/java-client"},"url":"/clients/java-client"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
    <div class="dashboard is-full-height">
        <!-- left panel -->
        <div class="dashboard-panel is-medium is-hidden-mobile pl-0">
            <div class="dashboard-panel-header has-text-centered">
                <a href="/">
                    <img src="/assets/images/pegasus-logo-inv.png" style="width: 80%;">
                </a>
                
            </div>
            <div class="dashboard-panel-main is-scrollable pl-6">
                

<aside class="menu">
    
    <p class="menu-label">The Pegasus documentation</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/downloads"
                class="">
                Downloads
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Building Pegasus</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/build/compile-by-docker"
                class="">
                Compile by docker (recommended)
            </a>
        </li>
        
        <li>
            <a href="/docs/build/compile-from-source"
                class="">
                Compile from source
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Client Libs</p>
    <ul class="menu-list">
        
        <li>
            <a href="/clients/java-client"
                class="is-active">
                Java Client
            </a>
        </li>
        
        <li>
            <a href="/clients/cpp-client"
                class="">
                C++ Client
            </a>
        </li>
        
        <li>
            <a href="https://github.com/apache/incubator-pegasus/tree/master/go-client"
                class="">
                Golang Client
            </a>
        </li>
        
        <li>
            <a href="/clients/python-client"
                class="">
                Python Client
            </a>
        </li>
        
        <li>
            <a href="/clients/node-client"
                class="">
                NodeJS Client
            </a>
        </li>
        
        <li>
            <a href="/clients/scala-client"
                class="">
                Scala Client
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Tools</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/tools/shell"
                class="">
                Pegasus Shell
            </a>
        </li>
        
        <li>
            <a href="https://github.com/pegasus-kv/admin-cli"
                class="">
                Admin CLI
            </a>
        </li>
        
        <li>
            <a href="https://github.com/pegasus-kv/pegic"
                class="">
                Pegasus data access CLI
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">API</p>
    <ul class="menu-list">
        
        <li>
            <a href="/api/ttl"
                class="">
                TTL(Time To Live)
            </a>
        </li>
        
        <li>
            <a href="/api/single-atomic"
                class="">
                Single-Atomic Operations
            </a>
        </li>
        
        <li>
            <a href="/api/redis"
                class="">
                Redis Adaption
            </a>
        </li>
        
        <li>
            <a href="/api/geo"
                class="">
                GEO Support
            </a>
        </li>
        
        <li>
            <a href="/api/http"
                class="">
                HTTP API
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Admin</p>
    <ul class="menu-list">
        
        <li>
            <a href="/administration/deployment"
                class="">
                Deployment
            </a>
        </li>
        
        <li>
            <a href="/administration/config"
                class="">
                Configurations
            </a>
        </li>
        
        <li>
            <a href="/administration/rebalance"
                class="">
                Rebalance
            </a>
        </li>
        
        <li>
            <a href="/administration/monitoring"
                class="">
                Monitoring
            </a>
        </li>
        
        <li>
            <a href="/administration/rolling-update"
                class="">
                Rolling Restart and Upgrade
            </a>
        </li>
        
        <li>
            <a href="/administration/scale-in-out"
                class="">
                Scale-in and Scale-out
            </a>
        </li>
        
        <li>
            <a href="/administration/resource-management"
                class="">
                Resource Management
            </a>
        </li>
        
        <li>
            <a href="/administration/cold-backup"
                class="">
                Cold Backup
            </a>
        </li>
        
        <li>
            <a href="/administration/meta-recovery"
                class="">
                Metadata Recovery
            </a>
        </li>
        
        <li>
            <a href="/administration/replica-recovery"
                class="">
                Replica Data Recovery
            </a>
        </li>
        
        <li>
            <a href="/administration/zk-migration"
                class="">
                Zookeeper Migration
            </a>
        </li>
        
        <li>
            <a href="/administration/table-migration"
                class="">
                Table Migration
            </a>
        </li>
        
        <li>
            <a href="/administration/table-soft-delete"
                class="">
                Table Soft-Delete
            </a>
        </li>
        
        <li>
            <a href="/administration/table-env"
                class="">
                Table Environment Variables
            </a>
        </li>
        
        <li>
            <a href="/administration/remote-commands"
                class="">
                Remote Command
            </a>
        </li>
        
        <li>
            <a href="/administration/partition-split"
                class="">
                Partition-Split
            </a>
        </li>
        
        <li>
            <a href="/administration/duplication"
                class="">
                Duplication
            </a>
        </li>
        
        <li>
            <a href="/administration/compression"
                class="">
                Data Compression
            </a>
        </li>
        
        <li>
            <a href="/administration/throttling"
                class="">
                Throttling
            </a>
        </li>
        
        <li>
            <a href="/administration/experiences"
                class="">
                Experiences
            </a>
        </li>
        
        <li>
            <a href="/administration/manual-compact"
                class="">
                Manual Compact
            </a>
        </li>
        
        <li>
            <a href="/administration/usage-scenario"
                class="">
                Usage Scenario
            </a>
        </li>
        
        <li>
            <a href="/administration/bad-disk"
                class="">
                Bad Disk Repair
            </a>
        </li>
        
        <li>
            <a href="/administration/whitelist"
                class="">
                Replica Server Whitelist
            </a>
        </li>
        
        <li>
            <a href="/administration/backup-request"
                class="">
                Backup Request
            </a>
        </li>
        
        <li>
            <a href="/administration/hotspot-detection"
                class="">
                Hotspot Detection
            </a>
        </li>
        
    </ul>
    
</aside>
            </div>
        </div>

        <!-- main section -->
        <div class="dashboard-main is-scrollable">
            <nav class="navbar is-hidden-desktop">
    <div class="navbar-brand">
        <a href="/" class="navbar-item">
            <!-- Pegasus Icon -->
            <img src="/assets/images/pegasus-square.png">
        </a>
        <div class="navbar-item">
            

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-light is-outlined is-inverted" href="/zh/clients/java-client"><strong>中</strong></a>

        </div>
        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
            <!-- Appears in mobile mode only -->
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>
    <div class="navbar-menu" id="navMenu">
        <div class="navbar-end">
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        The Pegasus documentation
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/downloads"
                        class="navbar-item ">
                        Downloads
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Building Pegasus
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/build/compile-by-docker"
                        class="navbar-item ">
                        Compile by docker (recommended)
                    </a>
                    
                    <a href="/docs/build/compile-from-source"
                        class="navbar-item ">
                        Compile from source
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Client Libs
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/clients/java-client"
                        class="navbar-item is-active">
                        Java Client
                    </a>
                    
                    <a href="/clients/cpp-client"
                        class="navbar-item ">
                        C++ Client
                    </a>
                    
                    <a href="https://github.com/apache/incubator-pegasus/tree/master/go-client"
                        class="navbar-item ">
                        Golang Client
                    </a>
                    
                    <a href="/clients/python-client"
                        class="navbar-item ">
                        Python Client
                    </a>
                    
                    <a href="/clients/node-client"
                        class="navbar-item ">
                        NodeJS Client
                    </a>
                    
                    <a href="/clients/scala-client"
                        class="navbar-item ">
                        Scala Client
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Tools
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/tools/shell"
                        class="navbar-item ">
                        Pegasus Shell
                    </a>
                    
                    <a href="https://github.com/pegasus-kv/admin-cli"
                        class="navbar-item ">
                        Admin CLI
                    </a>
                    
                    <a href="https://github.com/pegasus-kv/pegic"
                        class="navbar-item ">
                        Pegasus data access CLI
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        API
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/api/ttl"
                        class="navbar-item ">
                        TTL(Time To Live)
                    </a>
                    
                    <a href="/api/single-atomic"
                        class="navbar-item ">
                        Single-Atomic Operations
                    </a>
                    
                    <a href="/api/redis"
                        class="navbar-item ">
                        Redis Adaption
                    </a>
                    
                    <a href="/api/geo"
                        class="navbar-item ">
                        GEO Support
                    </a>
                    
                    <a href="/api/http"
                        class="navbar-item ">
                        HTTP API
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Admin
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/administration/deployment"
                        class="navbar-item ">
                        Deployment
                    </a>
                    
                    <a href="/administration/config"
                        class="navbar-item ">
                        Configurations
                    </a>
                    
                    <a href="/administration/rebalance"
                        class="navbar-item ">
                        Rebalance
                    </a>
                    
                    <a href="/administration/monitoring"
                        class="navbar-item ">
                        Monitoring
                    </a>
                    
                    <a href="/administration/rolling-update"
                        class="navbar-item ">
                        Rolling Restart and Upgrade
                    </a>
                    
                    <a href="/administration/scale-in-out"
                        class="navbar-item ">
                        Scale-in and Scale-out
                    </a>
                    
                    <a href="/administration/resource-management"
                        class="navbar-item ">
                        Resource Management
                    </a>
                    
                    <a href="/administration/cold-backup"
                        class="navbar-item ">
                        Cold Backup
                    </a>
                    
                    <a href="/administration/meta-recovery"
                        class="navbar-item ">
                        Metadata Recovery
                    </a>
                    
                    <a href="/administration/replica-recovery"
                        class="navbar-item ">
                        Replica Data Recovery
                    </a>
                    
                    <a href="/administration/zk-migration"
                        class="navbar-item ">
                        Zookeeper Migration
                    </a>
                    
                    <a href="/administration/table-migration"
                        class="navbar-item ">
                        Table Migration
                    </a>
                    
                    <a href="/administration/table-soft-delete"
                        class="navbar-item ">
                        Table Soft-Delete
                    </a>
                    
                    <a href="/administration/table-env"
                        class="navbar-item ">
                        Table Environment Variables
                    </a>
                    
                    <a href="/administration/remote-commands"
                        class="navbar-item ">
                        Remote Command
                    </a>
                    
                    <a href="/administration/partition-split"
                        class="navbar-item ">
                        Partition-Split
                    </a>
                    
                    <a href="/administration/duplication"
                        class="navbar-item ">
                        Duplication
                    </a>
                    
                    <a href="/administration/compression"
                        class="navbar-item ">
                        Data Compression
                    </a>
                    
                    <a href="/administration/throttling"
                        class="navbar-item ">
                        Throttling
                    </a>
                    
                    <a href="/administration/experiences"
                        class="navbar-item ">
                        Experiences
                    </a>
                    
                    <a href="/administration/manual-compact"
                        class="navbar-item ">
                        Manual Compact
                    </a>
                    
                    <a href="/administration/usage-scenario"
                        class="navbar-item ">
                        Usage Scenario
                    </a>
                    
                    <a href="/administration/bad-disk"
                        class="navbar-item ">
                        Bad Disk Repair
                    </a>
                    
                    <a href="/administration/whitelist"
                        class="navbar-item ">
                        Replica Server Whitelist
                    </a>
                    
                    <a href="/administration/backup-request"
                        class="navbar-item ">
                        Backup Request
                    </a>
                    
                    <a href="/administration/hotspot-detection"
                        class="navbar-item ">
                        Hotspot Detection
                    </a>
                    
                </div>
            </div>
            
        </div>
    </div>
</nav>

<nav class="navbar is-hidden-mobile">
    <div class="navbar-start w-full">
        <div class="navbar-item pl-0 w-full">
            <!--TODO(wutao): Given the limitation of docsearch that couldn't handle multiple input,
                I make searchbox only shown in desktop. Fix this issue when docsearch.js v3 released.
                Related issue: https://github.com/algolia/docsearch/issues/230-->
            <div id="docsearch"></div>
        </div>
    </div>
    <div class="navbar-end">
        <div class="navbar-item">
            

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-light is-outlined is-inverted" href="/zh/clients/java-client"><strong>中</strong></a>

        </div>
    </div>
</nav>

            <section class="hero is-info lg:mr-3">
                <div class="hero-body">
                    
                    <p class="title is-size-2 is-centered">Java Client</p>
                </div>
            </section>
            <section class="section" style="padding-top: 2rem;">
                <div class="content">
                    <h1 id="getting-the-java-client">Getting the Java Client</h1>

<p>Project repository: <a href="https://github.com/apache/incubator-pegasus/tree/master/java-client">Pegasus Java Client</a></p>

<p>Download:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/apache/incubator-pegasus.git
<span class="nb">cd </span>pegasus-java-client
</code></pre></div></div>

<p>Choose the version to use and build the client. It is recommended to use the <a href="https://github.com/xiaomi/pegasus-java-client/releases">latest release version</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout v2.0.0
mvn clean package <span class="nt">-DskipTests</span>
</code></pre></div></div>

<p>Install it into your local Maven repository for convenient use in your project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean <span class="nb">install</span> <span class="nt">-DskipTests</span>
</code></pre></div></div>

<p>Once the installation is complete, configure it via Maven to use th client:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.xiaomi.infra<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>pegasus-client<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p><strong>Note: Version 2.0.0 is only compatible with PegasusServer &gt;= 2.0. If your server version is older, please use the following version:</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.xiaomi.infra<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>pegasus-client<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.11.10-thrift-0.11.0-inlined<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h1 id="client-configuration">Client Configuration</h1>

<p>To create a Java client instance, it is necessary to configure relevant parameters. Users can choose between two methods of configuration: file-based configuration or parameter passing.</p>

<h2 id="file-based-configuration">File-based Configuration</h2>

<p>The Java client requires a configuration file to locate the Pegasus cluster, set default timeout values, and other parameters.</p>

<p>The configuration file is usually named <code class="language-plaintext highlighter-rouge">pegasus.properties</code>. Here is an example:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">meta_servers</span> <span class="p">=</span> <span class="s">127.0.0.1:34601,127.0.0.1:34602,127.0.0.1:34603</span>
<span class="py">operation_timeout</span> <span class="p">=</span> <span class="s">1000</span>
<span class="c"># Additional parameters can be added as needed; otherwise, default values will apply
</span><span class="py">async_workers</span> <span class="p">=</span> <span class="s">4</span>
<span class="py">enable_perf_counter</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">perf_counter_tags</span> <span class="p">=</span> <span class="s">cluster=onebox,app=unit_test</span>
<span class="py">push_counter_interval_secs</span> <span class="p">=</span> <span class="s">10</span>
<span class="py">meta_query_timeout</span> <span class="p">=</span> <span class="s">5000</span>
</code></pre></div></div>

<p>Where:</p>

<ul>
  <li><strong>meta_servers</strong>: mandatory, specifies a list of MetaServer addresses for the Pegasus cluster used to locate the cluster.</li>
  <li><strong>operation_timeout</strong>: optional, the default timeout for each operation in milliseconds. In general, each operation in the interface can have its own timeout. The default timeout is used if specified as 0. Default: 1000.</li>
  <li><strong>async_workers</strong>:optional, the number of backend worker threads that will internally handle RPC between the client and replica_server using Netty NIO. Default: 4.</li>
  <li><strong>enable_perf_counter</strong>: optional, specifies whether performance monitoring should be enabled. If enabled, the client will periodically report the monitoring data, currently only <a href="http://open-falcon.org/">Falcon</a> is supported. Default: true (prior to version 2.0.0, the default was false).</li>
  <li><strong>perf_counter_tags</strong>: optional, tags for Falcon counter data. If performance monitoring is enabled, it is recommended to set the tag name to easily distinguish between different services. Default: empty.</li>
  <li><strong>push_counter_interval_secs</strong>: optional, the interval of Falcon monitoring data reporting in seconds. Default: 10</li>
  <li><strong>meta_query_timeout</strong>: optional, the timeout for establishing a connection to the MetaServer in milliseconds. Typically, the initial connection takes more time; users can adjust this parameter based on their scenarios to mitigate query timeout issues on initial service startup. Default: 5000 (prior to version 2.0.0, this parameter did not exist and defaulted to operation_timeout).</li>
</ul>

<p>The configuration file is used when the client instance is created by passing the <code class="language-plaintext highlighter-rouge">configPath</code> parameter:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PegasusClientInterface</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">PegasusClientFactory</span><span class="o">.</span><span class="na">getSingletonClient</span><span class="o">(</span><span class="n">configPath</span><span class="o">);</span>
</code></pre></div></div>

<p>The format for <code class="language-plaintext highlighter-rouge">configPath</code> is <code class="language-plaintext highlighter-rouge">type://path</code>, with three supported types:</p>

<ul>
  <li><strong>Local File System</strong>
    <ul>
      <li>Format: file:///path/to/config</li>
      <li>Example 1: file://./pegasus.properties (indicating the local file ./pegasus.properties)</li>
      <li>Example 2: file:///home/work/pegasus.properties (indicating the local file /home/work/pegasus.properties)</li>
    </ul>
  </li>
  <li><strong>Java Resource</strong>
    <ul>
      <li>Format: resource:///path/to/config</li>
      <li>Example 1: resource:///pegasus.properties</li>
      <li>Example 2: resource:///com/xiaomi/xxx/pegasus.properties</li>
    </ul>
  </li>
  <li><strong>Zookeeper</strong>
    <ul>
      <li>Format: zk://host1:port1,host2:port2,host3:port3/path/to/config</li>
      <li>Example 1: zk://127.0.0.1:2181/databases/pegasus/pegasus.properties</li>
      <li>Example 2: zk://127.0.0.1:2181,127.0.0.1:2182/databases/pegasus/pegasus.properties</li>
    </ul>
  </li>
</ul>

<h2 id="parameter-passing">Parameter Passing</h2>

<p>Users can also create a <code class="language-plaintext highlighter-rouge">ClientOptions</code> instance as parameters for creating a client instance. <code class="language-plaintext highlighter-rouge">ClientOptions</code> includes the following parameters:</p>

<ul>
  <li><strong>metaServers</strong>: mandatory, the meta_servers addresses. Default: 127.0.0.1:34601,127.0.0.1:34602,127.0.0.1:34603</li>
  <li><strong>operationTimeout</strong>: optional, the timeout threshold for client requests. Default: 1000 ms.</li>
  <li><strong>asyncWorkers</strong>: optional, the number of backend worker threads that will internally handle RPC between the client and replica_server using Netty NIO. Default: 4</li>
  <li><strong>enablePerfCounter</strong>: optional, specifies whether performance monitoring should be enabled. If enabled, the client will periodically report the monitoring data, currently only <a href="http://open-falcon.org/">Falcon</a> is supported. Default: false</li>
  <li><strong>falconPerfCounterTags</strong>: optional, tags for Falcon counter data. If performance monitoring is enabled, it is recommended to set the tag name to easily distinguish between different services. Default: empty</li>
  <li><strong>falconPushInterval</strong>: optional, the interval of Falcon monitoring data reporting in seconds. Default: 10</li>
  <li><strong>metaQueryTimeout</strong>: optional, the timeout for establishing a connection to the MetaServer in milliseconds. Typically, the initial connection takes more time; users can adjust this parameter based on their scenarios to mitigate query timeout issues on initial service startup. Default: 5000 (prior to version 2.0.0, this parameter did not exist and defaulted to operation_timeout)</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">ClientOptions</code> instance can be created in two ways. You can use:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ClientOptions</span> <span class="n">clientOptions</span> <span class="o">=</span> <span class="nc">ClientOptions</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
</code></pre></div></div>

<p>to create a default <code class="language-plaintext highlighter-rouge">ClientOptions</code> instance. Alternatively, you may refer to the following example to create a customized instance:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ClientOptions</span> <span class="n">clientOptions</span> <span class="o">=</span>
      <span class="nc">ClientOptions</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">metaServers</span><span class="o">(</span><span class="s">"127.0.0.1:34601,127.0.0.1:34602,127.0.0.1:34603"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">operationTimeout</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">1000</span><span class="o">))</span>
          <span class="o">.</span><span class="na">asyncWorkers</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
          <span class="o">.</span><span class="na">enablePerfCounter</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
          <span class="o">.</span><span class="na">falconPerfCounterTags</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
          <span class="o">.</span><span class="na">falconPushInterval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<h1 id="interface-definition">Interface Definition</h1>

<p>The classes of the Java client are located in the <code class="language-plaintext highlighter-rouge">com.xiaomi.infra.pegasus.client</code> package, primarily providing three classes:</p>

<table>
  <thead>
    <tr>
      <th>Class Name</th>
      <th>Functionality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PegasusClientFactory</td>
      <td>A factory class for creating Client instances</td>
    </tr>
    <tr>
      <td>PegasusClientInterface</td>
      <td>An interface class for the client, encapsulating various <strong>synchronous APIs</strong>, which can also be used to create table instances.</td>
    </tr>
    <tr>
      <td>PegasusTableInterface</td>
      <td>An interface class for table, encapsulating both <strong>synchronous and asynchronous APIs</strong> for data access</td>
    </tr>
  </tbody>
</table>

<p>Users can choose to use either the Client interface (<code class="language-plaintext highlighter-rouge">PegasusClientInterface</code>) or the Table interface (<code class="language-plaintext highlighter-rouge">PegasusTableInterface</code>) for data access, with the following differences:</p>

<ul>
  <li>The Client interface allows the direct specification of the table name in parameters, eliminating the need to open a table, thus simplifying usage.</li>
  <li>The Table interface supports both <strong>synchronous and asynchronous APIs</strong>, whereas the Client interface supports  only <strong>synchronous APIs</strong>.</li>
  <li>The Table interface allows individual timeout settings for each operation, while the Client interface cannot specify timeouts individually, relying only on the default timeout defined in the configuration file.</li>
  <li>The Table interface introduces a <code class="language-plaintext highlighter-rouge">backupRequestDelayMs</code> parameter in version 2.0.0, enabling backup-request functionality to improve read performance; further details can be found in the <a href="/administration/backup-request">Backup-Request</a>.</li>
  <li>The Table interface provides more accurate timeout settings, while the Client interface may experience inaccuracies in timeout during initial read/write requests due to internal initialization of the Table object.</li>
  <li>It is recommended that users prioritize the Table interface.</li>
</ul>

<h2 id="creating-a-client-instance">Creating a Client Instance</h2>

<p>There are two methods for creating a Client instance: singleton and non-singleton.</p>

<h3 id="singleton">Singleton</h3>

<p>If the application requires access to a <strong>single cluster</strong>, utilizing a singleton is appropriate, as it allows for the sharing of various resources such as thread pools and connections.</p>

<p><strong>Note</strong>: If <code class="language-plaintext highlighter-rouge">getSingletonClient()</code> is called in multiple locations to retrieve the singleton object, it is essential to ensure that the <code class="language-plaintext highlighter-rouge">configPath</code> or <code class="language-plaintext highlighter-rouge">ClientOptions</code> object provided is consistent; otherwise, an exception will be thrown. This is to ensure that multiple calls retrieve the same instance.</p>

<p>Invoke the <code class="language-plaintext highlighter-rouge">PegasusClientFactory::getSingletonClient()</code> method to obtain the singleton object of <code class="language-plaintext highlighter-rouge">PegasusClientInterface</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
  * Get the singleton client instance with default config path of "resource:///pegasus.properties".
  * After used, should call PegasusClientFactory.closeSingletonClient() to release resource.
  *
  * @return PegasusClientInterface PegasusClientInterface.
  * @throws PException throws exception if any error occurs.
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">PegasusClientInterface</span> <span class="nf">getSingletonClient</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>

<span class="cm">/**
  * Get the singleton client instance with customized config path. After used, should call
  * PegasusClientFactory.closeSingletonClient() to release resource.
  *
  * @param configPath configPath could be:
  * - zookeeper path  : zk://host1:port1,host2:port2,host3:port3/path/to/config
  * - local file path : file:///path/to/config
  * - java resource   : resource:///path/to/config
  *
  * @return PegasusClientInterface PegasusClientInterface.
  * @throws PException throws exception if any error occurs.
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">PegasusClientInterface</span> <span class="nf">getSingletonClient</span><span class="o">(</span><span class="nc">String</span> <span class="n">configPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>

<span class="cm">/**
  * Get the singleton client instance instance with ClientOptions. After used, should call
  * PegasusClientFactory.closeSingletonClient() to release resource.
  *
  * @param options The client option
  * @return PegasusClientInterface PegasusClientInterface.
  * @throws PException throws exception if any error occurs.
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">PegasusClientInterface</span> <span class="nf">getSingletonClient</span><span class="o">(</span><span class="nc">ClientOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Remember to close the singleton after use to free up resources, for example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PegasusClientInterface</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">PegasusClientFactory</span><span class="o">.</span><span class="na">getSingletonClient</span><span class="o">(</span><span class="n">configPath</span><span class="o">);</span>

<span class="o">...</span> <span class="o">...</span>

<span class="nc">PegasusClientFactory</span><span class="o">.</span><span class="na">closeSingletonClient</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="non-singleton">Non-Singleton</h3>

<p>The singleton method cannot be used if the program needs to access multiple clusters. So we provide an interface for creating non-singleton instances, where a <code class="language-plaintext highlighter-rouge">configPath</code> or <code class="language-plaintext highlighter-rouge">ClientOptions</code>object must be passed at the time of creation. Different clusters should use different <code class="language-plaintext highlighter-rouge">configPath</code> or <code class="language-plaintext highlighter-rouge">ClientOptions</code> objects.</p>

<p><strong>Note</strong>: Each instance has its own independent resources and does not interfere with one another. So it is recommended to avoid creating redundant instances to avoid wasting resources. Additionally, remember to call <code class="language-plaintext highlighter-rouge">close()</code> to release resources after use.</p>

<p>Call the <code class="language-plaintext highlighter-rouge">PegasusClientFactory::createClient()</code> method to obtain a non-singleton client instance:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
  * Create a client instance. After use, be sure to call client.close() to release resources.
  *
  * @param configPath The client configuration path, which could be:
  * - Zookeeper path  : zk://host1:port1,host2:port2,host3:port3/path/to/config
  * - Local file path : file:///path/to/config
  * - Java resource   : resource:///path/to/config
  *
  * @return PegasusClientInterface.
  * @throws PException Throws an exception if any error occurs.
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">PegasusClientInterface</span> <span class="nf">createClient</span><span class="o">(</span><span class="nc">String</span> <span class="n">configPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>

<span class="cm">/**
  * Create a client instance using ClientOptions. After use, be sure to call
  * client.close() to release resources.
  *
  * @param options The client options.
  * @return PegasusClientInterface.
  * @throws PException Throws an exception if any error occurs.
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">PegasusClientInterface</span> <span class="nf">createClient</span><span class="o">(</span><span class="nc">ClientOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>For instance:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PegasusClientInterface</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">PegasusClientFactory</span><span class="o">.</span><span class="na">createClient</span><span class="o">(</span><span class="n">configPath</span><span class="o">);</span>

<span class="o">...</span> <span class="o">...</span>

<span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="pegasusclientinterface">PegasusClientInterface</h2>

<h3 id="get">get</h3>

<p>Read a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get value.
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition to get this k-v,
 *                if null or length == 0, means hash key is "".
 * @param sortKey all the k-v under hashKey will be sorted by sortKey,
 *                if null or length == 0, means sort key is "".
 * @return value; null if not found
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">get</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Must pass in <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, and <code class="language-plaintext highlighter-rouge">SortKey</code>.</li>
  <li>Return value: If null is returned, it indicates that the data corresponding to the key does not exist.</li>
  <li>Exception: If an exception occurs, such as a network error, timeout error, or server error, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="batchget">batchGet</h3>

<p>Reads a batch of data. This function is the encapsulation of the <code class="language-plaintext highlighter-rouge">get</code> function in bulk. This function sends asynchronous requests to the server concurrently and waits for the results. If any request fails, it will terminate immediately and throw an exception. If an exception is thrown, the results in the values list are undefined.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Batch get values of different keys.
 * Will terminate immediately if any error occurs.
 * @param tableName table name
 * @param keys hashKey and sortKey pair list.
 * @param values output values; should be created by caller; if succeed, the size of values will
 *               be same with keys; the value of keys[i] is stored in values[i]; if the value of
 *               keys[i] is not found, then values[i] will be set to null.
 * @throws PException throws exception if any error occurs.
 *
 * Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">keys</code>.</li>
      <li>Output parameters: <code class="language-plaintext highlighter-rouge">Values</code>. This variable should be created by the caller, if read successfully, <code class="language-plaintext highlighter-rouge">Values[i]</code> stores the result corresponding to <code class="language-plaintext highlighter-rouge">Keys[i]</code>. If the value does not exist, it will be null.</li>
    </ul>
  </li>
  <li>Return value: None.</li>
  <li>Exception: If an exception occurs, such as a network error, timeout error, or server error, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail; as long as one fails, an exception will be thrown.</li>
</ul>

<h3 id="batchget2">batchGet2</h3>

<p>Reads a batch of data. This function is the encapsulation of the <code class="language-plaintext highlighter-rouge">get</code> function in bulk. This function sends asynchronous requests to the server concurrently, but unlike the <code class="language-plaintext highlighter-rouge">batchGet</code> above, it will wait for all requests to finish regardless of success or failure.</p>

<p>Users can determine if the requests were successful or not based on whether the <code class="language-plaintext highlighter-rouge">PException</code> in the results is set, and they can choose to use only the successful results.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch get values of different keys.
* Will wait for all requests done even if some error occurs.
* @param tableName table name
* @param keys hashKey and sortKey pair list.
* @param results output results; should be created by caller; after call done, the size of results will
*                be same with keys; the results[i] is a Pair:
*                - if Pair.left != null : means query keys[i] failed, Pair.left is the exception.
*                - if Pair.left == null : means query keys[i] succeed, Pair.right is the result value.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchGet2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters: <code class="language-plaintext highlighter-rouge">ableName</code> , <code class="language-plaintext highlighter-rouge">keys</code>.</li>
      <li>Output parameters: Results. This variable should be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> stores the result corresponding to <code class="language-plaintext highlighter-rouge">Keys[i]</code>. If <code class="language-plaintext highlighter-rouge">results[i]</code>.left is not null (<code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates the request for <code class="language-plaintext highlighter-rouge">Keys[i]</code> failed.</li>
    </ul>
  </li>
  <li>Return value: The count of successful requests.</li>
  <li>Exception: If an exception occurs, such as parameter errors, table name does not exist, etc., a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail; users can choose to use only the successful results.</li>
</ul>

<h3 id="multiget">multiGet</h3>

<p>Read multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get multiple value under the same hash key.
 * @param tableName table name
 * @param hashKey used to decide which partition to put this k-v,
 *                should not be null or empty.
 * @param sortKeys all the k-v under hashKey will be sorted by sortKey,
 *                if null or empty, means fetch all sortKeys under the hashKey.
 * @param maxFetchCount max count of k-v pairs to be fetched.
 *                      max_fetch_count &lt;= 0 means no limit. default value is 100.
 * @param maxFetchSize max size of k-v pairs to be fetched.
 *                     max_fetch_size &lt;= 0 means no limit. default value is 1000000.
 * @param values output values; if sortKey is not found, then it will not appear in values.
 *               the returned sortKey is just the same one in incoming sortKeys.
 * @return true if all data is fetched; false if only partial data is fetched.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first interface allows specifying <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">axFetchSize</code>.</li>
  <li>Parameters:
    <ul>
      <li>Input parameters: Must pass in <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">SortKeys</code>; optionally pass <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
      <li>Output parameters: Data is returned through <code class="language-plaintext highlighter-rouge">values</code>, which should be created by the user before calling.</li>
      <li>If <code class="language-plaintext highlighter-rouge">SortKeys</code> are not empty, only the specified data will be read. An empty <code class="language-plaintext highlighter-rouge">SortKeys</code> means all data under the <code class="language-plaintext highlighter-rouge">hashKey</code> will be read.</li>
      <li><code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> are used to limit the amount of data read: <code class="language-plaintext highlighter-rouge">maxFetchCount</code> indicates the maximum number of data entries to read, while <code class="language-plaintext highlighter-rouge">maxFetchSize</code> indicates the maximum size of data in bytes to read. When either limit is reached, the read operation is stopped.</li>
    </ul>
  </li>
  <li>Return value: If <code class="language-plaintext highlighter-rouge">maxFetchCount</code> or <code class="language-plaintext highlighter-rouge">maxFetchSize</code> is specified, a single query may retrieve only part of the results. If all satisfying data has been retrieved, it returns true, otherwise it returns false.</li>
  <li>Exception: If an exception occurs, such as a network error, timeout error, or server error, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">multiGet</code> also has another version of the interface that supports <strong>range queries</strong> and <strong>conditional filtering</strong> for <code class="language-plaintext highlighter-rouge">SortKey</code>, only reading data that meets certain criteria. From version 1.8.0, the <code class="language-plaintext highlighter-rouge">MultiGetOptions</code> has a reverse parameter, supporting <strong>reverse scanning</strong> of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">FilterType</span> <span class="o">{</span>
    <span class="no">FT_NO_FILTER</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>
    <span class="no">FT_MATCH_ANYWHERE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="c1">// match filter string at any position</span>
    <span class="no">FT_MATCH_PREFIX</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>   <span class="c1">// match filter string at prefix</span>
    <span class="no">FT_MATCH_POSTFIX</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>  <span class="c1">// match filter string at postfix</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultiGetOptions</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// if the startSortKey is included</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// if the stopSortKey is included</span>
    <span class="kd">public</span> <span class="nc">FilterType</span> <span class="n">sortKeyFilterType</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">FT_NO_FILTER</span><span class="o">;</span> <span class="c1">// filter type for sort key</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKeyFilterPattern</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// filter pattern for sort key</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">noValue</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// only fetch hash_key and sort_key, but not fetch value</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// if search in reverse direction</span>
<span class="o">}</span>
 
<span class="cm">/**
* Get multiple key-values under the same hashKey with sortKey range limited.
* @param tableName table name
* @param hashKey used to decide which partition the key may exist
*                should not be null or empty.
* @param startSortKey the start sort key.
*                     null means "".
* @param stopSortKey the stop sort key.
*                    null or "" means fetch to the last sort key.
* @param options multi-get options.
* @param maxFetchCount max count of kv pairs to be fetched
*                      maxFetchCount &lt;= 0 means no limit. default value is 100
* @param maxFetchSize max size of kv pairs to be fetched.
*                     maxFetchSize &lt;= 0 means no limit. default value is 1000000.
* @param values output values; if sortKey is not found, then it will not appear in values.
*               the returned sortKey is just the same one in incoming sortKeys.
* @return true if all data is fetched; false if only partial data is fetched.
* @throws PException
*/</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="nc">MultiGetOptions</span> <span class="n">options</span><span class="o">,</span>
                    <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span>
                    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="nc">MultiGetOptions</span> <span class="n">options</span><span class="o">,</span>
                    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first interface allows specifying <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">axFetchSize</code>.</li>
  <li>Parameters:
    <ul>
      <li>Input parameters: Must pass in <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">SortKeys</code>; optionally pass <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
      <li>Output parameters: Data is returned through <code class="language-plaintext highlighter-rouge">values</code>, which should be created by the user before calling.</li>
      <li>If <code class="language-plaintext highlighter-rouge">StopSortKeys</code> is empty, regardless of the value of <code class="language-plaintext highlighter-rouge">stopInclusive</code>, all data under this <code class="language-plaintext highlighter-rouge">hashKey</code> will be read up to the end of <code class="language-plaintext highlighter-rouge">SortKey</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> are used to limit the amount of data read: <code class="language-plaintext highlighter-rouge">maxFetchCount</code> indicates the maximum number of data entries to read, while <code class="language-plaintext highlighter-rouge">maxFetchSize</code> indicates the maximum size of data in bytes to read. When either limit is reached, the read operation is stopped. Note that from version 1.12.3, PegasusServer limits the total number of data (including expired and conditionally filtered data) read at one time to 3000 entries, so the effective data read by this interface may be less than the expected value.</li>
      <li>Description of <code class="language-plaintext highlighter-rouge">MultiGetOptions</code>:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">startInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">StartSortKey</code>, default is true.</li>
          <li><code class="language-plaintext highlighter-rouge">stopInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">StopSortKey</code>, default is false.</li>
          <li><code class="language-plaintext highlighter-rouge">sortKeyFilterType</code>: Filter type for <code class="language-plaintext highlighter-rouge">SortKey</code>, including no filter, match anywhere, match prefix, and match postfix, default is no filter.</li>
          <li><code class="language-plaintext highlighter-rouge">sortKeyFilterPattern</code>: <code class="language-plaintext highlighter-rouge">SortKey</code> filter pattern, an empty string is equivalent to no filter.</li>
          <li><code class="language-plaintext highlighter-rouge">noValue</code>: Only fetch <code class="language-plaintext highlighter-rouge">hashKey</code> and <code class="language-plaintext highlighter-rouge">SortKey</code>, do not fetch any <code class="language-plaintext highlighter-rouge">Value</code> data, default is false.</li>
          <li><code class="language-plaintext highlighter-rouge">reverse</code>: Whether to scan in reverse, searching from back to front. However, the results found will still be stored in the list in ascending order of <code class="language-plaintext highlighter-rouge">SortKey</code>. Supported from Pegasus Server 1.8.0.</li>
        </ul>
      </li>
      <li>Return value: If all satisfying data has been read, it returns true. If only partially satisfying data has been read, it returns false.</li>
      <li>Exception: If an exception occurs, such as a network error, timeout error, or server error, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
      <li>Example: Retrieve all data under a specific <code class="language-plaintext highlighter-rouge">hashKey</code> (note that if the number of data entries is too large, it may easily timeout):
        <ul>
          <li><code class="language-plaintext highlighter-rouge">multiGet(hashKey, null, null, new MultiGetOptions(), -1, -1, values);</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="batchmultiget">batchMultiGet</h3>

<p>Batch encapsulation of the <code class="language-plaintext highlighter-rouge">multiGet</code> function. This function concurrently sends asynchronous requests to the server and waits for the results. If any request fails, it will abort and throw an exception. If an exception is thrown, the results in <code class="language-plaintext highlighter-rouge">values</code> are undefined.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch get multiple values under the same hash key.
* Will terminate immediately if any error occurs.
* @param tableName table name
* @param keys List{hashKey,List{sortKey}}; if List{sortKey} is null or empty, means fetch all
*             sortKeys under the hashKey.
* @param values output values; should be created by caller; if succeed, the size of values will
*               be same with keys; the data for keys[i] is stored in values[i].
* @throws PException throws exception if any error occurs.
*
* Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
*/</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchMultiGet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">HashKeyData</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">keys</code>. <code class="language-plaintext highlighter-rouge">keys</code> is a list of <code class="language-plaintext highlighter-rouge">Pair</code>, where the left value of the <code class="language-plaintext highlighter-rouge">Pair</code> is the <code class="language-plaintext highlighter-rouge">hashKey</code>, and the right value is the list of <code class="language-plaintext highlighter-rouge">sortKey</code>s. If the right value is null or an empty list, all data under the <code class="language-plaintext highlighter-rouge">hashKey</code> is fetched.</li>
      <li>Output parameters: <code class="language-plaintext highlighter-rouge">Values</code>. This <code class="language-plaintext highlighter-rouge">List</code> must be created by the caller; if the read is successful, <code class="language-plaintext highlighter-rouge">Values[i]</code> stores the result corresponding to <code class="language-plaintext highlighter-rouge">Keys[i]</code>.</li>
    </ul>
  </li>
  <li>Return value: None.</li>
  <li>Exception: A <code class="language-plaintext highlighter-rouge">PException</code> will be throw when an exception occurs, such as a network error, timeout error, server error, etc.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail. As long as any one fails, an exception will be thrown.</li>
</ul>

<h3 id="batchmultiget2">batchMultiGet2</h3>

<p>Batch encapsulation of the <code class="language-plaintext highlighter-rouge">multiGet</code> function. This function concurrently sends asynchronous requests to the server and waits for the results. However, unlike <code class="language-plaintext highlighter-rouge">batchMultiGet</code>, it waits for the completion of all requests, regardless of their success or failure.</p>

<p>Users can determine the success or failure of requests based on whether the <code class="language-plaintext highlighter-rouge">PException</code> is set in the results, and can choose to use only the successful results.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch get multiple values under the same hash key.
* Will wait for all requests done even if some error occurs.
* @param tableName table name
* @param keys List{hashKey,List{sortKey}}; if List{sortKey} is null or empty, means fetch all
*             sortKeys under the hashKey.
* @param results output results; should be created by caller; after call done, the size of results will
*                be same with keys; the results[i] is a Pair:
*                - if Pair.left != null : means query keys[i] failed, Pair.left is the exception.
*                - if Pair.left == null : means query keys[i] succeed, Pair.right is the result value.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchMultiGet2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">,</span> <span class="nc">HashKeyData</span><span class="o">&gt;&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">keys</code>. <code class="language-plaintext highlighter-rouge">keys</code> is a list of <code class="language-plaintext highlighter-rouge">Pair</code>, where the left value of the <code class="language-plaintext highlighter-rouge">Pair</code> is the <code class="language-plaintext highlighter-rouge">hashKey</code>, and the right value is the list of <code class="language-plaintext highlighter-rouge">sortKey</code>s. If the right value is null or an empty list, all data under the <code class="language-plaintext highlighter-rouge">hashKey</code> is fetched.</li>
      <li>Output parameters: <code class="language-plaintext highlighter-rouge">results</code>. This variable must be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> stores the result corresponding to <code class="language-plaintext highlighter-rouge">Keys[i]</code>. If <code class="language-plaintext highlighter-rouge">results[i].left</code> is not null (<code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates that the request for <code class="language-plaintext highlighter-rouge">Keys[i]</code> has failed.</li>
    </ul>
  </li>
  <li>Return value: The number of successful requests.</li>
  <li>Exception: A <code class="language-plaintext highlighter-rouge">PException</code> will be thrown when an exception occurs, such as a parameter error, table name does not exist, etc.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail, allowing users to choose to use only the successful results.</li>
</ul>

<h3 id="set">set</h3>

<p>Write a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Set value.
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition to put this k-v,
 *                if null or length == 0, means hash key is "".
 * @param sortKey all the k-v under hashKey will be sorted by sortKey,
 *                if null or length == 0, means sort key is "".
 * @param value should not be null
 * @param ttl_seconds time to live in seconds,
 *                    0 means no ttl. default value is 0.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttl_seconds</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Two versions of the interface are provided, where the first interface allows specifying the TTL time.</li>
  <li>Parameters: You need to pass TableName, HashKey, SortKey, value; optionally pass TTL, which must be &gt;= 0; when &lt; 0, a PException will be thrown.</li>
  <li>Return value: None.</li>
  <li>Exception: If an exception occurs, such as network errors, timeout errors, server errors, TTL &lt; 0, etc., a PException will be thrown.</li>
</ul>

<h3 id="batchset">batchSet</h3>

<p>Write a batch of data, batch encapsulation of the set function. This function concurrently sends asynchronous requests to the server and waits for results. If any request fails, it will terminate immediately and throws an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Batch set lots of values.
 * @param tableName TableHandler name
 * @param items list of items.
 * @throws PException throws exception if any error occurs.
 *
 * Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SetItem</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">items</code>.</li>
  <li>Return value: None.</li>
  <li>Exception: A <code class="language-plaintext highlighter-rouge">PException</code> is thrown when an exception occurs, such as network errors, timeout errors, server errors, etc.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail; as long as any one fails, an exception will be thrown.</li>
</ul>

<h3 id="batchset2">batchSet2</h3>

<p>Batch encapsulation of the set function. This function concurrently sends asynchronous requests to the server and waits for results. However, unlike <code class="language-plaintext highlighter-rouge">batchSet</code>, it waits for all requests, whether successful or not.</p>

<p>Users can determine the success or failure of requests based on whether the <code class="language-plaintext highlighter-rouge">PException</code> is set in the results, and can choose to use only the successful results.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch set lots of values.
* Will wait for all requests done even if some error occurs.
* @param tableName table name
* @param items list of items.
* @param results output results; should be created by caller; after call done, the size of results will
*                be same with items; the results[i] is a PException:
*                - if results[i] != null : means set items[i] failed, results[i] is the exception.
*                - if results[i] == null : means set items[i] succeed.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, that means, maybe some keys succeed but some keys failed.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchSet2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SetItem</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">items</code>.</li>
      <li>Output parameters: Results. This variable must be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> stores the result corresponding to <code class="language-plaintext highlighter-rouge">items[i]</code>; if <code class="language-plaintext highlighter-rouge">results[i]</code> is not null (<code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates that the request for <code class="language-plaintext highlighter-rouge">items[i]</code> has failed.</li>
    </ul>
  </li>
  <li>Return value: The number of successful requests.</li>
  <li>Exception: If an exception occurs, such as parameter errors, table name does not exist, etc., a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic, meaning some keys may succeed while others fail, allowing users to choose to use only the successful results.</li>
</ul>

<h3 id="multiset">multiSet</h3>

<p>Write multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Set multiple value under the same hash key.
 * @param tableName table name
 * @param hashKey used to decide which partition to put this k-v,
 *                should not be null or empty.
 * @param values all &lt;sortkey,value&gt; pairs to be set,
 *               should not be null or empty.
 * @param ttl_seconds time to live in seconds,
 *                    0 means no ttl. default value is 0.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">multiSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttl_seconds</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">multiSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Note:</p>

<ul>
  <li>Two versions of the interface are provided, where the first interface allows specifying the <code class="language-plaintext highlighter-rouge">TTL</code> time.</li>
  <li>Parameters: Pass <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">Values</code>; optionally pass <code class="language-plaintext highlighter-rouge">TTL</code>, which must be &gt;= 0; when <code class="language-plaintext highlighter-rouge">TTL</code> &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.
    <ul>
      <li>Values is a list of Pairs, where the first element of the Pair is <code class="language-plaintext highlighter-rouge">SortKey</code>, and the second element is <code class="language-plaintext highlighter-rouge">value</code>.</li>
    </ul>
  </li>
  <li>Return value: None.</li>
  <li>Exception: If an exception occurs, such as network errors, timeout errors, server errors, <code class="language-plaintext highlighter-rouge">TTL</code> &lt; 0, etc., a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="batchmultiset">batchMultiSet</h3>

<p>A batch wrapper for the <code class="language-plaintext highlighter-rouge">multiSet</code> function. This function concurrently sends asynchronous requests to the server and waits for results. If any request fails, it will terminate immediately and throws an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch set multiple values under the same hash key.
* Will terminate immediately if any error occurs.
* @param tableName TableHandler name
* @param items list of items.
* @param ttl_seconds time to live in seconds,
*                    0 means no TTL. Default value is 0.
* @throws PException throws exception if any error occurs.
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchMultiSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">HashKeyData</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttl_seconds</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchMultiSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">HashKeyData</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first allows specifying TTL.</li>
  <li>Parameters: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">items</code>. Optionally, TTL, which must be &gt;= 0. If &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, server errors, or TTL &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and any failure will throw an exception.</li>
</ul>

<h3 id="batchmultiset2">batchMultiSet2</h3>

<p>A batch wrapper for the <code class="language-plaintext highlighter-rouge">multiSet</code> function. This function concurrently sends asynchronous requests to the server and waits for results. However, unlike <code class="language-plaintext highlighter-rouge">batchMultiSet</code>, it waits for the completion of all requests, regardless of their success or failure.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch set multiple values under the same hash key.
* Will wait for all requests to complete even if some errors occur.
* @param tableName table name
* @param items list of items.
* @param ttl_seconds time to live in seconds,
*                    0 means no TTL. Default value is 0.
* @param results output results; should be created by the caller; after the call, the size of results will
*                be the same as items; results[i] is a PException:
*                - if results[i] != null: means setting items[i] failed, results[i] is the exception.
*                - if results[i] == null: means setting items[i] succeeded.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchMultiSet2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">HashKeyData</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttl_seconds</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchMultiSet2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">HashKeyData</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first allows specifying TTL.</li>
  <li>Parameters:
    <ul>
      <li>Input: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">items</code>; optionally, TTL, which must be &gt;= 0. If &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
      <li>Output: <code class="language-plaintext highlighter-rouge">results</code>. This variable should be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> contains the result for <code class="language-plaintext highlighter-rouge">items[i]</code>; if <code class="language-plaintext highlighter-rouge">results[i]</code> is not null (a <code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates a failure for <code class="language-plaintext highlighter-rouge">items[i]</code>.</li>
    </ul>
  </li>
  <li>Return value: The number of successful requests.</li>
  <li>Exceptions: If an exception occurs, such as parameter errors, non-existent table names, or TTL &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and users can choose to use only the successful results.</li>
</ul>

<h3 id="del">del</h3>

<p>Delete a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Delete value.
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition to put this k-v,
 *                if null or length == 0, means hash key is "".
 * @param sortKey all the k-v under hashKey will be sorted by sortKey,
 *                if null or length == 0, means sort key is "".
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">del</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, and <code class="language-plaintext highlighter-rouge">sortKey</code>.</li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="batchdel">batchDel</h3>

<p>Batch delete data, wrapping the <code class="language-plaintext highlighter-rouge">del</code> function. This function concurrently sends asynchronous requests to the server and waits for results. If any request fails, it will terminate immediately and throws an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch delete values of different keys.
* Will terminate immediately if any error occurs.
* @param tableName table name
* @param keys hashKey and sortKey pair list.
* @throws PException throws exception if any error occurs.
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchDel</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">keys</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code> and <code class="language-plaintext highlighter-rouge">keys</code>.</li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and any failure will throw an exception.</li>
</ul>

<h3 id="batchdel2">batchDel2</h3>

<p>A batch wrapper for the <code class="language-plaintext highlighter-rouge">del</code> function. This function concurrently sends asynchronous requests to the server and waits for results. However, unlike <code class="language-plaintext highlighter-rouge">batchDel</code>, it waits for all requests to finish regardless of success or failure.</p>

<p>Users can determine the success or failure of requests based on whether <code class="language-plaintext highlighter-rouge">PException</code> is set in the results, and can choose to use only successful results.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch delete values of different keys.
* Will wait for all requests to complete even if some errors occur.
* @param tableName table name
* @param keys hashKey and sortKey pair list.
* @param results output results; should be created by the caller; after the call, the size of results will
*                be the same as keys; results[i] is a PException:
*                - if results[i] != null: means deleting keys[i] failed, results[i] is the exception.
*                - if results[i] == null: means deleting keys[i] succeeded.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchDel2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">keys</code>.</li>
      <li>Output: <code class="language-plaintext highlighter-rouge">results</code>. This variable should be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> contains the result for <code class="language-plaintext highlighter-rouge">keys[i]</code>; if <code class="language-plaintext highlighter-rouge">results[i]</code> is not null (a <code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates a failure for <code class="language-plaintext highlighter-rouge">keys[i]</code>.</li>
    </ul>
  </li>
  <li>Return value: The number of successful requests.</li>
  <li>Exceptions: If an exception occurs, such as parameter errors or non-existent table names, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and users can choose to use only the successful results.</li>
</ul>

<h3 id="multidel">multiDel</h3>

<p>Delete multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Delete specified sort keys under the same hash key.
 * @param tableName table name
 * @param hashKey used to decide which partition to put this k-v,
 *                should not be null or empty.
 * @param sortKeys specify sort keys to be deleted.
 *                 should not be empty.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">multiDel</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, and <code class="language-plaintext highlighter-rouge">sortKeys</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sortKeys</code> must not be empty. If you don’t know what sort keys exist under the <code class="language-plaintext highlighter-rouge">hashKey</code>, you can use the <code class="language-plaintext highlighter-rouge">multiGetSortKeys</code> method to retrieve them.</li>
    </ul>
  </li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="batchmultidel">batchMultiDel</h3>

<p>A batch wrapper for the <code class="language-plaintext highlighter-rouge">multiDel</code> function. This function concurrently sends asynchronous requests to the server and waits for results. If any request fails, it will terminate immediately and throws an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch delete specified sort keys under the same hash key.
* Will terminate immediately if any error occurs.
* @param tableName table name
* @param keys List{hashKey,List{sortKey}}
* @throws PException throws exception if any error occurs.
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">batchMultiDel</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;&gt;&gt;</span> <span class="n">keys</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code> and <code class="language-plaintext highlighter-rouge">keys</code>. <code class="language-plaintext highlighter-rouge">keys</code> is a list of pairs, where the left value is the <code class="language-plaintext highlighter-rouge">hashKey</code>, and the right value is a non-empty list of <code class="language-plaintext highlighter-rouge">sortKeys</code>.</li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and any failure will throw an exception.</li>
</ul>

<h3 id="batchmultidel2">batchMultiDel2</h3>

<p>A batch wrapper for the <code class="language-plaintext highlighter-rouge">multidel</code> function. This function concurrently sends asynchronous requests to the server and waits for results. However, unlike <code class="language-plaintext highlighter-rouge">batchMultiDel</code>, it waits for all requests to finish regardless of success or failure.</p>

<p>Users can determine the success or failure of requests based on whether <code class="language-plaintext highlighter-rouge">PException</code> is set in the results, and can choose to use only successful results.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Batch delete specified sort keys under the same hash key.
* Will wait for all requests to complete even if some errors occur.
* @param tableName table name
* @param keys List{hashKey,List{sortKey}}
* @param results output results; should be created by the caller; after the call, the size of results will
*                be the same as keys; results[i] is a PException:
*                - if results[i] != null: means deleting keys[i] failed, results[i] is the exception.
*                - if results[i] == null: means deleting keys[i] succeeded.
* @return succeed count.
* @throws PException
*
* Notice: the method is not atomic, meaning some keys may succeed while others fail.
*/</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">batchMultiDel2</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;&gt;&gt;</span> <span class="n">keys</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PException</span><span class="o">&gt;</span> <span class="n">results</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input: <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">keys</code>. <code class="language-plaintext highlighter-rouge">keys</code> is a list of pairs, where the left value is the <code class="language-plaintext highlighter-rouge">hashKey</code>, and the right value is a non-empty list of <code class="language-plaintext highlighter-rouge">sortKeys</code>.</li>
      <li>Output: <code class="language-plaintext highlighter-rouge">results</code>. This variable should be created by the caller; <code class="language-plaintext highlighter-rouge">results[i]</code> contains the result for <code class="language-plaintext highlighter-rouge">keys[i]</code>; if <code class="language-plaintext highlighter-rouge">results[i]</code> is not null (a <code class="language-plaintext highlighter-rouge">PException</code> is set), it indicates a failure for <code class="language-plaintext highlighter-rouge">keys[i]</code>.</li>
    </ul>
  </li>
  <li>Return value: The number of successful requests.</li>
  <li>Exceptions: If an exception occurs, such as parameter errors or non-existent table names, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail, and users can choose to use only the successful results.</li>
</ul>

<h3 id="delrange">delRange</h3>

<p>Delete data under the same HashKey where SortKey values fall within the range of startSortKey and stopSortKey. If an error occurs during the deletion, it will not affect the already deleted data and will mark the first SortKey that was not deleted within the range.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
   * Delete key-values within the range of startSortKey and stopSortKey under hashKey. Will terminate
   * immediately if any error occurs.
   *
   * @param tableName table name
   * @param hashKey used to decide which partition the key may exist, should not be null or empty.
   * @param startSortKey the start sort key. null or "" means fetch to the first sort key.
   * @param stopSortKey the stop sort key. null or "" means fetch to the last sort key.
   * @param options del range options.
   * @throws PException throws exception if any error occurs.
   */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">delRange</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="nc">DelRangeOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DelRangeOptions</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">nextSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// whether the startSortKey is included</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// whether the stopSortKey is included</span>
    <span class="kd">public</span> <span class="nc">FilterType</span> <span class="n">sortKeyFilterType</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">FT_NO_FILTER</span><span class="o">;</span> <span class="c1">// filter type for sort key</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKeyFilterPattern</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// filter pattern for sort key</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters:
    <ul>
      <li>Input parameters:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">startSortKey</code> and <code class="language-plaintext highlighter-rouge">stopSortKey</code> are the start and end key values for the sort keys.</li>
          <li><code class="language-plaintext highlighter-rouge">DelRangeOptions</code>:
            <ul>
              <li><code class="language-plaintext highlighter-rouge">nextSortKey</code>: The first sort key value to be deleted, default is null. During deletion, it dynamically records the next key to delete. Notably, when an error occurs during deletion, this parameter can record the next sort key to continue deleting.</li>
              <li><code class="language-plaintext highlighter-rouge">startInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">startSortKey</code>, default is true.</li>
              <li><code class="language-plaintext highlighter-rouge">stopInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">stopSortKey</code>, default is false.</li>
              <li><code class="language-plaintext highlighter-rouge">sortKeyFilterType</code>: Filter type for sort keys, including no filter, any position matching, prefix matching, and suffix matching, default is no filter.</li>
              <li><code class="language-plaintext highlighter-rouge">sortKeyFilterPattern</code>: Sort key filter pattern string, an empty string is treated as no filter.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Output parameters: None.</li>
    </ul>
  </li>
  <li>Return value: None.</li>
  <li>Exceptions: If an exception occurs, such as parameter errors, non-existent table names, or timeouts, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
  <li>Note: This method is not atomic; some keys may succeed while others fail.</li>
</ul>

<h3 id="incr">incr</h3>

<p>Single-row atomic increment (or decrement) operation. For detailed instructions, refer to <a href="/api/single-atomic#atomic-increment-decrement">Single-row Atomic Operations</a>.</p>

<p>This operation first converts the byte string of the value pointed to by the key into an int64 type (similar to Java’s <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Long.html#parseLong(java.lang.String)">Long.parseLong()</a> function), then adds the increment, and converts the result back into a byte string as the new value.</p>

<p>It performs an atomic increment when the <code class="language-plaintext highlighter-rouge">increment</code> parameter is positive, and performs an atomic decrement when the <code class="language-plaintext highlighter-rouge">increment</code> parameter is negative.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Atomically increment value.
 *
 * @param tableName the table name.
 * @param hashKey   the hash key to increment.
 * @param sortKey   the sort key to increment.
 * @param increment the increment to be added to the old value.
 * @return the new value.
 * @throws PException throws exception if any error occurs.
 */</span>
<span class="kd">public</span> <span class="kt">long</span> <span class="nf">incr</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">long</span> <span class="n">increment</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, and <code class="language-plaintext highlighter-rouge">increment</code>.</li>
  <li>Return value: The new value after the operation succeeds.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown. Additionally, exceptions will be thrown in the following cases:
    <ul>
      <li>Error converting the old value to int64, such as invalid number format or exceeding the int64 range.</li>
      <li>The result of the old value plus <code class="language-plaintext highlighter-rouge">increment</code> exceeds the int64 range.</li>
    </ul>
  </li>
  <li>Other notes:
    <ul>
      <li>If the old value does not exist, it is treated as 0, meaning the new value equals <code class="language-plaintext highlighter-rouge">increment</code>.</li>
      <li>TTL semantics: If the old value exists, the new value retains the same TTL as the old value; if the old value does not exist, the new value will have no TTL.</li>
    </ul>
  </li>
</ul>

<p>Starting from Pegasus Server v1.11.1, modifying TTL during <code class="language-plaintext highlighter-rouge">incr</code> operations is supported. Use <a href="https://github.com/XiaoMi/pegasus-java-client/releases/tag/1.11.2-thrift-0.11.0-inlined-release">Pegasus Java Client 1.11.2-thrift-0.11.0-inlined-release</a> or later to utilize this feature.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Atomically increment value.
 *
 * @param tableName the table name.
 * @param hashKey   the hash key to increment.
 * @param sortKey   the sort key to increment.
 * @param increment the increment to be added to the old value.
 * @param ttlSeconds time to live in seconds for the new value.
 *                   should be no less than -1. for the second method, the ttlSeconds is 0.
 *                   - if ttlSeconds == 0, the semantic is the same as redis:
 *                     - normally, increment will preserve the original ttl.
 *                     - if old data is expired by ttl, then set initial value to 0 and set no ttl.
 *                   - if ttlSeconds &gt; 0, then update with the new ttl if increment succeed.
 *                   - if ttlSeconds == -1, then update to no ttl if increment succeed.
 * @return the new value.
 * @throws PException throws exception if any error occurs.
 */</span>
<span class="kd">public</span> <span class="kt">long</span> <span class="nf">incr</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">long</span> <span class="n">increment</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">long</span> <span class="nf">incr</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">long</span> <span class="n">increment</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Except for TTL, all other semantics are the same as above.</li>
  <li>TTL operations:
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">ttlSeconds == 0</code>, the semantics align with Redis: If the old value exists, the new value retains the same TTL; if the old value does not exist, the new value will have no TTL.</li>
      <li>If <code class="language-plaintext highlighter-rouge">ttlSeconds &gt; 0</code>, the TTL is set to the new value.</li>
      <li>If <code class="language-plaintext highlighter-rouge">ttlSeconds == -1</code>, the TTL is cleared, meaning the new value will have no TTL.</li>
      <li>If <code class="language-plaintext highlighter-rouge">ttlSeconds &lt; -1</code>, an exception is thrown.</li>
    </ul>
  </li>
</ul>

<h3 id="checkandset">checkAndSet</h3>

<p>Atomic CAS operation for single HashKey data (can be understood as <strong>single-row atomic operation</strong>). For detailed instructions, refer to <a href="/api/single-atomic#cas-operation">Single-row Atomic Operations</a>.</p>

<p>This operation first performs a conditional check on the value of a specific SortKey (referred to as <code class="language-plaintext highlighter-rouge">CheckSortKey</code>):</p>

<ul>
  <li>If the check condition is satisfied, the value of another SortKey (referred to as <code class="language-plaintext highlighter-rouge">SetSortKey</code>) is set to the new value.</li>
  <li>If the check condition is not satisfied, the set operation is skipped.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">CheckSortKey</code> and <code class="language-plaintext highlighter-rouge">SetSortKey</code> can be the same or different.</p>

<p>Users can also set <code class="language-plaintext highlighter-rouge">CheckAndSetOptions.returnCheckValue</code> to retrieve the value corresponding to <code class="language-plaintext highlighter-rouge">CheckSortKey</code>. By doing so, if <code class="language-plaintext highlighter-rouge">CheckSortKey</code> and <code class="language-plaintext highlighter-rouge">SetSortKey</code> are the same and the set operation succeeds, the old value before the set is returned.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">CheckType</span> <span class="o">{</span>
    <span class="no">CT_NO_CHECK</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>

    <span class="c1">// appearance</span>
    <span class="no">CT_VALUE_NOT_EXIST</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>          <span class="c1">// value is not exist</span>
    <span class="no">CT_VALUE_NOT_EXIST_OR_EMPTY</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="c1">// value is not exist or value is empty</span>
    <span class="no">CT_VALUE_EXIST</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>              <span class="c1">// value is exist</span>
    <span class="no">CT_VALUE_NOT_EMPTY</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span>          <span class="c1">// value is exist and not empty</span>

    <span class="c1">// match</span>
    <span class="no">CT_VALUE_MATCH_ANYWHERE</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="c1">// operand matches anywhere in value</span>
    <span class="no">CT_VALUE_MATCH_PREFIX</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span>   <span class="c1">// operand matches prefix in value</span>
    <span class="no">CT_VALUE_MATCH_POSTFIX</span><span class="o">(</span><span class="mi">7</span><span class="o">),</span>  <span class="c1">// operand matches postfix in value</span>

    <span class="c1">// bytes compare</span>
    <span class="no">CT_VALUE_BYTES_LESS</span><span class="o">(</span><span class="mi">8</span><span class="o">),</span>              <span class="c1">// bytes compare: value &lt; operand</span>
    <span class="no">CT_VALUE_BYTES_LESS_OR_EQUAL</span><span class="o">(</span><span class="mi">9</span><span class="o">),</span>     <span class="c1">// bytes compare: value &lt;= operand</span>
    <span class="no">CT_VALUE_BYTES_EQUAL</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span>            <span class="c1">// bytes compare: value == operand</span>
    <span class="no">CT_VALUE_BYTES_GREATER_OR_EQUAL</span><span class="o">(</span><span class="mi">11</span><span class="o">),</span> <span class="c1">// bytes compare: value &gt;= operand</span>
    <span class="no">CT_VALUE_BYTES_GREATER</span><span class="o">(</span><span class="mi">12</span><span class="o">),</span>          <span class="c1">// bytes compare: value &gt; operand</span>

    <span class="c1">// int compare: first transfer bytes to int64; then compare by int value</span>
    <span class="no">CT_VALUE_INT_LESS</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span>             <span class="c1">// int compare: value &lt; operand</span>
    <span class="no">CT_VALUE_INT_LESS_OR_EQUAL</span><span class="o">(</span><span class="mi">14</span><span class="o">),</span>    <span class="c1">// int compare: value &lt;= operand</span>
    <span class="no">CT_VALUE_INT_EQUAL</span><span class="o">(</span><span class="mi">15</span><span class="o">),</span>            <span class="c1">// int compare: value == operand</span>
    <span class="no">CT_VALUE_INT_GREATER_OR_EQUAL</span><span class="o">(</span><span class="mi">16</span><span class="o">),</span> <span class="c1">// int compare: value &gt;= operand</span>
    <span class="no">CT_VALUE_INT_GREATER</span><span class="o">(</span><span class="mi">17</span><span class="o">);</span>          <span class="c1">// int compare: value &gt; operand</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckAndSetOptions</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">setValueTTLSeconds</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// time to live in seconds of the set value, 0 means no ttl.</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">returnCheckValue</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// if return the check value in results.</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheckAndSetResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for checkAndSet
     *
     * @param setSucceed true if set value succeed.
     * @param checkValueReturned true if the check value is returned.
     * @param checkValueExist true if the check value is exist; can be used only when checkValueReturned is true.
     * @param checkValue return the check value if exist; can be used only when checkValueExist is true.
     */</span>
    <span class="kt">boolean</span> <span class="n">setSucceed</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">checkValueReturned</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">checkValueExist</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Atomically check and set value by key.
 * If the check condition is satisfied, then apply to set value.
 *
 * @param tableName    the table name.
 * @param hashKey      the hash key to check and set.
 * @param checkSortKey the sort key to check.
 * @param checkType    the check type.
 * @param checkOperand the check operand.
 * @param setSortKey   the sort key to set value if check condition is satisfied.
 * @param setValue     the value to set if check condition is satisfied.
 * @param options      the check-and-set options.
 * @return CheckAndSetResult
 * @throws PException throws exception if any error occurs.
 */</span>
<span class="kd">public</span> <span class="nc">PegasusTableInterface</span><span class="o">.</span><span class="na">CheckAndSetResult</span> <span class="nf">checkAndSet</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkSortKey</span><span class="o">,</span>
                                                           <span class="nc">CheckType</span> <span class="n">checkType</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkOperand</span><span class="o">,</span>
                                                           <span class="kt">byte</span><span class="o">[]</span> <span class="n">setSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">setValue</span><span class="o">,</span>
                                                           <span class="nc">CheckAndSetOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">checkSortKey</code>, <code class="language-plaintext highlighter-rouge">checkType</code>, <code class="language-plaintext highlighter-rouge">checkOperand</code>, <code class="language-plaintext highlighter-rouge">setSortKey</code>, <code class="language-plaintext highlighter-rouge">setValue</code>, and <code class="language-plaintext highlighter-rouge">options</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">checkSortKey</code>, <code class="language-plaintext highlighter-rouge">checkType</code>, <code class="language-plaintext highlighter-rouge">checkOperand</code>: Specify the condition to check.</li>
      <li><code class="language-plaintext highlighter-rouge">setSortKey</code>, <code class="language-plaintext highlighter-rouge">setValue</code>: Specify the new value to set if the check condition is satisfied.</li>
      <li><code class="language-plaintext highlighter-rouge">options</code>: Additional options, including:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">setValueTTLSeconds</code>: TTL for the new value; must be &gt;= 0, where 0 means no TTL. If &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> is thrown.</li>
          <li><code class="language-plaintext highlighter-rouge">returnCheckValue</code>: Whether to return the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">CheckAndSetResult</code>, including:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">setSucceed</code>: Whether the set operation succeeded.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValueReturned</code>: Whether the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code> is returned.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValueExist</code>: Whether the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code> exists; this field is meaningful only when <code class="language-plaintext highlighter-rouge">checkValueReturned=true</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValue</code>: The value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code>; this field is meaningful only when <code class="language-plaintext highlighter-rouge">checkValueExist=true</code>.</li>
    </ul>
  </li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, server errors, or invalid TTL, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown. Additionally, exceptions will be thrown in the following cases:
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">CheckType</code> is an <code class="language-plaintext highlighter-rouge">int compare</code> operation and <code class="language-plaintext highlighter-rouge">checkOperand</code> or <code class="language-plaintext highlighter-rouge">checkValue</code> fails to convert to int64 (e.g., invalid number format or exceeding the int64 range).</li>
    </ul>
  </li>
</ul>

<h3 id="checkandmutate">checkAndMutate</h3>

<p><code class="language-plaintext highlighter-rouge">checkAndMutate</code> is an extended version of <a href="#checkandset"><code class="language-plaintext highlighter-rouge">checkAndSet</code></a>: While <code class="language-plaintext highlighter-rouge">checkAndSet</code> only allows setting a single value, <code class="language-plaintext highlighter-rouge">checkAndMutate</code> enables setting or deleting multiple values in a single atomic operation. This interface has been available since <a href="https://github.com/XiaoMi/pegasus-java-client/releases/tag/1.11.0-thrift-0.11.0-inlined-release">Pegasus Java Client 1.11.0-thrift-0.11.0-inlined-release</a>.</p>

<p>To support this, we provide a wrapper class <a href="https://github.com/XiaoMi/pegasus-java-client/blob/thrift-0.11.0-inlined/src/main/java/com/xiaomi/infra/pegasus/client/Mutations.java"><code class="language-plaintext highlighter-rouge">Mutations</code></a>, allowing users to predefine the set or delete operations to be performed.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">CheckAndMutateResult</span> <span class="o">{</span>
<span class="cm">/**
 * return value for checkAndMutate
 *
 * @param mutateSucceed true if mutate succeed.
 * @param checkValueReturned true if the check value is returned.
 * @param checkValueExist true if the check value is exist; can be used only when
 *     checkValueReturned is true.
 * @param checkValue return the check value if exist; can be used only when checkValueExist is
 *     true.
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">mutateSucceed</span><span class="o">;</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">checkValueReturned</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">checkValueExist</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
* atomically check and mutate by key, async version. if the check condition is satisfied, then
* apply to mutate.
*
* @param hashKey the hash key to check and mutate.
* @param checkSortKey the sort key to check.
* @param checkType the check type.
* @param checkOperand the check operand.
* @param mutations the list of mutations to perform if check condition is satisfied.
* @param options the check-and-mutate options.
* @param timeout how long will the operation timeout in milliseconds. if timeout &gt; 0, it is a
*     timeout value for current op, else the timeout value in the configuration file will be
*     used.
* @return the future for current op
*     &lt;p&gt;Future return: On success: return CheckAndMutateResult. On failure: a throwable, which
*     is an instance of PException
*     &lt;p&gt;Thread safety: All the listeners for the same table are guaranteed to be dispatched in
*     the same thread, so all the listeners for the same future are guaranteed to be executed as
*     the same order as the listeners added. But listeners for different tables are not
*     guaranteed to be dispatched in the same thread.
*/</span>
<span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CheckAndMutateResult</span><span class="o">&gt;</span> <span class="nf">asyncCheckAndMutate</span><span class="o">(</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkSortKey</span><span class="o">,</span>
  <span class="nc">CheckType</span> <span class="n">checkType</span><span class="o">,</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkOperand</span><span class="o">,</span>
  <span class="nc">Mutations</span> <span class="n">mutations</span><span class="o">,</span>
  <span class="nc">CheckAndMutateOptions</span> <span class="n">options</span><span class="o">,</span>
  <span class="kt">int</span> <span class="n">timeout</span> <span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">checkSortKey</code>, <code class="language-plaintext highlighter-rouge">checkType</code>, <code class="language-plaintext highlighter-rouge">checkOperand</code>, <code class="language-plaintext highlighter-rouge">mutations</code>, and <code class="language-plaintext highlighter-rouge">options</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">checkSortKey</code>, <code class="language-plaintext highlighter-rouge">checkType</code>, <code class="language-plaintext highlighter-rouge">checkOperand</code>: Specify the condition to check.</li>
      <li><code class="language-plaintext highlighter-rouge">mutations</code>: Define the set or delete operations to perform if the check condition is satisfied.</li>
      <li><code class="language-plaintext highlighter-rouge">options</code>: Additional options, including:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">returnCheckValue</code>: Whether to return the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">CheckAndMutateResult</code>, including:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mutateSucceed</code>: Whether the mutation succeeded.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValueReturned</code>: Whether the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code> is returned.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValueExist</code>: Whether the value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code> exists, meaningful only when <code class="language-plaintext highlighter-rouge">checkValueReturned=true</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">checkValue</code>: The value corresponding to <code class="language-plaintext highlighter-rouge">checkSortKey</code>, meaningful only when <code class="language-plaintext highlighter-rouge">checkValueExist=true</code>.</li>
    </ul>
  </li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown. Additionally, exceptions will be thrown in the following cases:
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">CheckType</code> is an <code class="language-plaintext highlighter-rouge">int compare</code> operation and <code class="language-plaintext highlighter-rouge">checkOperand</code> or <code class="language-plaintext highlighter-rouge">checkValue</code> fails to convert to int64 (e.g., invalid number format or exceeding the int64 range).</li>
    </ul>
  </li>
</ul>

<h3 id="compareexchange">compareExchange</h3>

<p><code class="language-plaintext highlighter-rouge">compareExchange</code> is a specialized version of <a href="#checkandset"><code class="language-plaintext highlighter-rouge">checkAndSet</code></a>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">CheckSortKey</code> and <code class="language-plaintext highlighter-rouge">SetSortKey</code> are the same.</li>
  <li><code class="language-plaintext highlighter-rouge">CheckType</code> is <code class="language-plaintext highlighter-rouge">CT_VALUE_BYTES_EQUAL</code>.</li>
</ul>

<p>The semantics of this method are: If the value corresponding to the <code class="language-plaintext highlighter-rouge">SortKey</code> exists and equals the expected value, it will be set to the new value. For details, refer to <a href="/api/single-atomic#cas-operation">Single-row Atomic Operations</a>.</p>

<p>This method aligns with the semantics of the commonly used <a href="https://en.cppreference.com/w/cpp/atomic/atomic_compare_exchange"><code class="language-plaintext highlighter-rouge">atomic_compare_exchange</code></a> in C++ libraries.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CompareExchangeResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for CompareExchange
     *
     * @param setSucceed true if set value succeed.
     * @param actualValue return the actual value if set value failed; null means the actual value is not exist.
     */</span>
    <span class="kt">boolean</span> <span class="n">setSucceed</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">actualValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Atomically compare and exchange value by key.
 * &lt;p&gt;
 * - if the original value for the key is equal to the expected value, then update it with the desired value,
 *   set CompareExchangeResult.setSucceed to true, and set CompareExchangeResult.actualValue to null because
 *   the actual value must be equal to the desired value.
 * - if the original value for the key is not exist or not equal to the expected value, then set
 *   CompareExchangeResult.setSucceed to false, and set the actual value in CompareExchangeResult.actualValue.
 * &lt;p&gt;
 * This method is very like the C++ function in {https://en.cppreference.com/w/cpp/atomic/atomic_compare_exchange}.
 *
 * @param tableName     the table name.
 * @param hashKey       the hash key to compare and exchange.
 * @param sortKey       the sort key to compare and exchange.
 * @param expectedValue the value expected to be found for the key.
 * @param desiredValue  the desired value to set if the original value for the key is equal to the expected value.
 * @param ttlSeconds    time to live in seconds of the desired value, 0 means no ttl.
 * @return CompareExchangeResult
 * @throws PException throws exception if any error occurs.
 */</span>
<span class="kd">public</span> <span class="nc">PegasusTableInterface</span><span class="o">.</span><span class="na">CompareExchangeResult</span> <span class="nf">compareExchange</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span>
                                                                   <span class="kt">byte</span><span class="o">[]</span> <span class="n">expectedValue</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">desiredValue</span><span class="o">,</span>
                                                                   <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, <code class="language-plaintext highlighter-rouge">expectedValue</code>, <code class="language-plaintext highlighter-rouge">desiredValue</code>, and <code class="language-plaintext highlighter-rouge">ttlSeconds</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>: Specify the key of the data.</li>
      <li><code class="language-plaintext highlighter-rouge">expectedValue</code>: The expected old value.</li>
      <li><code class="language-plaintext highlighter-rouge">desiredValue</code>: The new value to set if the old value equals <code class="language-plaintext highlighter-rouge">expectedValue</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">ttlSeconds</code>: TTL for the new value, must be &gt;= 0, where 0 means no TTL. If <code class="language-plaintext highlighter-rouge">ttlSeconds &lt; 0</code>, a <code class="language-plaintext highlighter-rouge">PException</code> is thrown.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">CompareExchangeResult</code>, including:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">setSucceed</code>: Whether the set operation succeeded. If the old data does not exist, the set fails.</li>
      <li><code class="language-plaintext highlighter-rouge">actualValue</code>: If the set fails, returns the actual value of the data; <code class="language-plaintext highlighter-rouge">null</code> means the data does not exist.</li>
    </ul>
  </li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, server errors, or TTL&lt;0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="ttl">ttl</h3>

<p>Get the TTL (Time To Live) of a single-row data. TTL indicates how long the data can survive. Once the TTL expires, the data becomes unreadable.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get ttl time.
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition to put this k-v,
 *                if null or length == 0, means hash key is "".
 * @param sortKey all the k-v under hashKey will be sorted by sortKey,
 *                if null or length == 0, means sort key is "".
 * @return ttl time in seconds; -1 if no ttl set; -2 if not exist.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">ttl</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, and <code class="language-plaintext highlighter-rouge">sortKey</code>.</li>
  <li>Return value: TTL time in seconds. Returns <code class="language-plaintext highlighter-rouge">-1</code> if no TTL is set; returns <code class="language-plaintext highlighter-rouge">-2</code> if the data does not exist.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="exist">exist</h3>

<p>Check if data exists.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Check value exist by key from the cluster
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition the key may exist.
 * @param sortKey all keys under the same hashKey will be sorted by sortKey
 *
 * @return true if exist, false if not exist
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">exist</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, and <code class="language-plaintext highlighter-rouge">sortKey</code>.</li>
  <li>Return value: Returns <code class="language-plaintext highlighter-rouge">true</code> if the data exists; otherwise, returns <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="sortkeycount">sortKeyCount</h3>

<p>Get the count of all <code class="language-plaintext highlighter-rouge">SortKey</code>s under a specific <code class="language-plaintext highlighter-rouge">HashKey</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition the key may exist.
 * @return the count result for the hashKey
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">long</span> <span class="nf">sortKeyCount</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code> and <code class="language-plaintext highlighter-rouge">hashKey</code>.</li>
  <li>Return value: The count of all <code class="language-plaintext highlighter-rouge">SortKey</code>s under the <code class="language-plaintext highlighter-rouge">HashKey</code>.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="multigetsortkeys">multiGetSortKeys</h3>

<p>Get the list of <code class="language-plaintext highlighter-rouge">SortKey</code>s under a specific <code class="language-plaintext highlighter-rouge">HashKey</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get multiple sort keys under the same hash key.
 * @param tableName table name
 * @param hashKey used to decide which partition to put this k-v,
 *                should not be null or empty.
 * @param maxFetchCount max count of k-v pairs to be fetched.
 *                      max_fetch_count &lt;= 0 means no limit. default value is 100.
 * @param maxFetchSize max size of k-v pairs to be fetched.
 *                     max_fetch_size &lt;= 0 means no limit. default value is 1000000.
 * @param sortKeys output sort keys.
 * @return true if all data is fetched; false if only partial data is fetched.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGetSortKeys</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">multiGetSortKeys</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, with the first allowing specification of <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
  <li>Parameters:
    <ul>
      <li>Input: Requires <code class="language-plaintext highlighter-rouge">tableName</code> and <code class="language-plaintext highlighter-rouge">hashKey</code>; optionally, <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
      <li>Output: Data is returned via <code class="language-plaintext highlighter-rouge">sortKeys</code>, which must be initialized by the caller.</li>
      <li><code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> limit the amount of data fetched. <code class="language-plaintext highlighter-rouge">maxFetchCount</code> specifies the maximum number of entries, and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> specifies the maximum byte size. Fetching stops when either limit is reached.</li>
    </ul>
  </li>
  <li>Return value: If <code class="language-plaintext highlighter-rouge">maxFetchCount</code> or <code class="language-plaintext highlighter-rouge">maxFetchSize</code> is specified, a single query may retrieve only partial results. Returns <code class="language-plaintext highlighter-rouge">true</code> if all matching data is fetched; otherwise, returns <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="getscanner">getScanner</h3>

<p>Get an iterator to traverse all data under a specific <code class="language-plaintext highlighter-rouge">HashKey</code> for partial scanning.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">FilterType</span> <span class="o">{</span>
    <span class="no">FT_NO_FILTER</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>
    <span class="no">FT_MATCH_ANYWHERE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="c1">// match filter string at any position</span>
    <span class="no">FT_MATCH_PREFIX</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>   <span class="c1">// match filter string at prefix</span>
    <span class="no">FT_MATCH_POSTFIX</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>  <span class="c1">// match filter string at postfix</span>
<span class="o">}</span>
 
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanOptions</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">timeoutMillis</span> <span class="o">=</span> <span class="mi">5000</span><span class="o">;</span> <span class="c1">// operation timeout in milli-seconds.</span>
                                     <span class="c1">// if timeoutMillis &gt; 0, it is a timeout value for current op,</span>
                                     <span class="c1">// else the timeout value in the configuration file will be used.</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span> <span class="c1">// internal buffer batch size</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// if the startSortKey is included</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// if the stopSortKey is included</span>
    <span class="kd">public</span> <span class="nc">FilterType</span> <span class="n">hashKeyFilterType</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">FT_NO_FILTER</span><span class="o">;</span> <span class="c1">// filter type for hash key</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKeyFilterPattern</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// filter pattern for hash key</span>
    <span class="kd">public</span> <span class="nc">FilterType</span> <span class="n">sortKeyFilterType</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">FT_NO_FILTER</span><span class="o">;</span> <span class="c1">// filter type for sort key</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKeyFilterPattern</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// filter pattern for sort key</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">noValue</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// only fetch hash_key and sort_key, but not fetch value</span>
<span class="o">}</span>
 
 
<span class="cm">/**
 * Get Scanner for {startSortKey, stopSortKey} within hashKey
 * @param tableName TableHandler name
 * @param hashKey used to decide which partition to put this k-v,
 * @param startSortKey start sort key scan from
 *                     if null or length == 0, means start from begin
 * @param stopSortKey stop sort key scan to
 *                    if null or length == 0, means stop to end
 * @param options scan options like endpoint inclusive/exclusive
 * @return scanner              
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="nc">PegasusScannerInterface</span> <span class="nf">getScanner</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="nc">ScanOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">startSortKey</code>, <code class="language-plaintext highlighter-rouge">stopSortKey</code>, and <code class="language-plaintext highlighter-rouge">ScanOptions</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">startSortKey</code> and <code class="language-plaintext highlighter-rouge">stopSortKey</code> define the scan range, with inclusivity/exclusivity specified in <code class="language-plaintext highlighter-rouge">ScanOptions</code>.</li>
      <li>If <code class="language-plaintext highlighter-rouge">startSortKey</code> is <code class="language-plaintext highlighter-rouge">null</code>, scanning starts from the beginning; if <code class="language-plaintext highlighter-rouge">stopSortKey</code> is <code class="language-plaintext highlighter-rouge">null</code>, scanning continues to the end.</li>
      <li><code class="language-plaintext highlighter-rouge">ScanOptions</code> details:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">timeoutMillis</code>: Timeout for reading data from the server, in milliseconds (default: 5000).</li>
          <li><code class="language-plaintext highlighter-rouge">batchSize</code>: Number of entries per batch when fetching data from the server (default: 1000).</li>
          <li><code class="language-plaintext highlighter-rouge">startInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">startSortKey</code> (default: <code class="language-plaintext highlighter-rouge">true</code>).</li>
          <li><code class="language-plaintext highlighter-rouge">stopInclusive</code>: Whether to include <code class="language-plaintext highlighter-rouge">stopSortKey</code> (default: <code class="language-plaintext highlighter-rouge">false</code>).</li>
          <li><code class="language-plaintext highlighter-rouge">hashKeyFilterType</code>: Filter type for <code class="language-plaintext highlighter-rouge">hashKey</code> (no filter, match anywhere, prefix, or postfix; default: no filter).</li>
          <li><code class="language-plaintext highlighter-rouge">hashKeyFilterPattern</code>: Filter pattern for <code class="language-plaintext highlighter-rouge">hashKey</code>; empty string means no filter.</li>
          <li><code class="language-plaintext highlighter-rouge">sortKeyFilterType</code>: Filter type for <code class="language-plaintext highlighter-rouge">sortKey</code> (no filter, match anywhere, prefix, or postfix; default: no filter).</li>
          <li><code class="language-plaintext highlighter-rouge">sortKeyFilterPattern</code>: Filter pattern for <code class="language-plaintext highlighter-rouge">sortKey</code>; empty string means no filter.</li>
          <li><code class="language-plaintext highlighter-rouge">noValue</code>: Fetch only <code class="language-plaintext highlighter-rouge">hashKey</code> and <code class="language-plaintext highlighter-rouge">sortKey</code>, excluding values (default: <code class="language-plaintext highlighter-rouge">false</code>).</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Return value: Returns an iterator <code class="language-plaintext highlighter-rouge">PegasusScannerInterface</code>.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h3 id="getunorderedscanner">getUnorderedScanner</h3>

<p>Get iterators to traverse all data in the entire table for global scanning.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get Scanners for all data in database
 * @param tableName TableHandler name
 * @param maxSplitCount how many scanner expected
 * @param options scan options like batchSize
 * @return scanners, count of which would be no more than maxSplitCount
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PegasusScannerInterface</span><span class="o">&gt;</span> <span class="nf">getUnorderedScanners</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxSplitCount</span><span class="o">,</span> <span class="nc">ScanOptions</span> <span class="n">options</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">tableName</code>, <code class="language-plaintext highlighter-rouge">maxSplitCount</code>, and <code class="language-plaintext highlighter-rouge">ScanOptions</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">maxSplitCount</code>: Determines the number of iterators returned. Multiple iterators allow concurrent scanning or use in MapReduce. Set to <code class="language-plaintext highlighter-rouge">1</code> if only one iterator is needed.</li>
      <li><code class="language-plaintext highlighter-rouge">ScanOptions</code>: As described above.</li>
    </ul>
  </li>
  <li>Return value: Returns a list of <code class="language-plaintext highlighter-rouge">PegasusScannerInterface</code> iterators.</li>
  <li>Exceptions: If an exception occurs, such as network errors, timeout errors, or server errors, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
</ul>

<h2 id="creating-table-instances">Creating Table Instances</h2>

<p>Use the <code class="language-plaintext highlighter-rouge">PegasusClientInterface::openTable()</code> method to obtain an instance of <code class="language-plaintext highlighter-rouge">PegasusTableInterface</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* Open a table. Please notice that pegasus support two kinds of API:
*     1. the client-interface way, which is provided in this class.
*     2. the table-interface way, which is provided by {@link PegasusTableInterface}.
* With the client-interface, you don't need to create PegasusTableInterface by openTable, so
* you can access the pegasus cluster conveniently. However, the client-interface's api also has
* some restrictions:
*     1. we don't provide async methods in client-interface.
*     2. the timeout in client-interface isn't as accurate as the table-interface.
*     3. the client-interface may throw an exception when open table fails. It means that
*        you may need to handle this exception in every data access operation, which is annoying.
*     4. You can't specify a per-operation timeout.
* So we recommend you to use the table-interface.
* 
* @param tableName the table should be exist on the server, which is created before by
*                  the system administrator
* @return the table handler
* @throws PException
*/</span>
<span class="kd">public</span> <span class="nc">PegasusTableInterface</span> <span class="nf">openTable</span><span class="o">(</span><span class="nc">String</span> <span class="n">tableName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Exceptions will be thrown for network timeouts or if the table does not exist.</li>
</ul>

<p>Example usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PegasusTableInterface</span> <span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">openTable</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">PegasusTableInterface</code> provides both synchronous and asynchronous APIs.</p>

<p>The synchronous APIs are similar to <code class="language-plaintext highlighter-rouge">PegasusClientInterface</code>, with the following differences:</p>

<ul>
  <li>No need to specify the <code class="language-plaintext highlighter-rouge">tableName</code> parameter.</li>
  <li>Timeout can be specified individually.</li>
</ul>

<p>Additionally, <code class="language-plaintext highlighter-rouge">openTable</code> includes a warmup feature to address slow first RPC calls for a table. Refer to the best practices section for details.</p>

<h3 id="future-based-asynchronous-apis">Future-Based Asynchronous APIs</h3>

<p>The asynchronous APIs use the Future pattern, specifically <code class="language-plaintext highlighter-rouge">io.netty.util.concurrent.Future</code> (see https://netty.io/4.1/api/index.html). Each async API returns a <code class="language-plaintext highlighter-rouge">Future&lt;T&gt;</code>, where <code class="language-plaintext highlighter-rouge">T</code> is the result type of the operation. Features of <code class="language-plaintext highlighter-rouge">Future</code>:</p>

<ul>
  <li>Listeners callbacks can be added via <code class="language-plaintext highlighter-rouge">addListener()</code>. Callbacks are invoked when the operation completes. If the operation is already complete when adding, the callback is invoked immediately. Callbacks are executed in the order they are added.</li>
  <li>The <code class="language-plaintext highlighter-rouge">await()</code> method blocks until the operation completes. Note that <code class="language-plaintext highlighter-rouge">await()</code> only ensures the operation is finished and the following three methods are available, not that callbacks have been executed.</li>
  <li>After completion:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">isSuccess()</code> checks if the operation succeeded.</li>
      <li><code class="language-plaintext highlighter-rouge">getNow()</code> retrieves the result if successful.</li>
      <li><code class="language-plaintext highlighter-rouge">cause()</code> retrieves the exception if failed.</li>
    </ul>
  </li>
</ul>

<p><strong>Note</strong>: The first async API call for a table may have additional latency (~10ms) due to fetching table metadata and routing info from the meta-server.</p>

<p>Example async usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Get table instance</span>
<span class="nc">PegasusTableInterface</span> <span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">openTable</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
  
<span class="c1">// Initiate async call</span>
<span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">asyncExist</span><span class="o">(</span><span class="n">hashKey</span><span class="o">,</span> <span class="n">sortKey</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
  
<span class="c1">// Set callback</span>
<span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">ExistListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">future</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
                    <span class="nc">Boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">getNow</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">else</span> <span class="o">{</span>
                    <span class="n">future</span><span class="o">.</span><span class="na">cause</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">);</span>
  
<span class="c1">// Wait for completion</span>
<span class="n">future</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</code></pre></div></div>

<h2 id="pegasustableinterface-apis">PegasusTableInterface APIs</h2>

<h3 id="asyncget">asyncGet</h3>

<p>Asynchronously read a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">GetListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncGet future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * Get value for a specific (hashKey, sortKey) pair, async version
 * @param hashKey used to decide which partition the key may exist
 *                if null or empty, means hash key is "".
 * @param sortKey all keys under the same hashKey will be sorted by sortKey
 *                if null or empty, means sort key is "".
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: the got value
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      The api is thread safe.
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="nf">asyncGet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, <code class="language-plaintext highlighter-rouge">timeout</code> (ms). Timeout &lt;=0 uses the default timeout from the configuration file.</li>
  <li>Returns: <code class="language-plaintext highlighter-rouge">Future&lt;byte[]&gt;</code>.</li>
</ul>

<h3 id="asyncmultiget">asyncMultiGet</h3>

<p>Asynchronously read multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MultiGetResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for multiGet
     * @param allFetched true if all data on the server are fetched; false if only partial data are fetched.
     * @param values the got values. If sortKey in the input sortKeys is not found, it won't be in values.
     *               The output values are ordered by the sortKey.
     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">allFetched</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">MultiGetListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncMultiGet future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * get multiple key-values under the same hashKey, async version
 * @param hashKey used to decide which partition the key may exist
 *                should not be null or empty.
 * @param sortKeys try to get values of sortKeys under the hashKey
 *                 if null or empty, try to get all (sortKey,value) pairs under hashKey
 * @param maxFetchCount max count of kv pairs to be fetched
 *                      maxFetchCount &lt;= 0 means no limit. default value is 100
 * @param maxFetchSize max size of kv pairs to be fetched.
 *                     maxFetchSize &lt;= 0 means no limit. default value is 1000000.
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: An object of type MultiGetResult
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first one allows specifying <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKeys</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>; optionally includes <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">sortKeys</code> is non-empty, only the specified data will be read. If empty, all data under the <code class="language-plaintext highlighter-rouge">hashKey</code> will be read.</li>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
      <li><code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> limit the amount of data to be read. <code class="language-plaintext highlighter-rouge">maxFetchCount</code> specifies the maximum number of data entries, and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> specifies the maximum data size in bytes. Reading stops when either limit is reached.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;MultiGetResult&gt;</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">allFetched</code>: If the user specifies <code class="language-plaintext highlighter-rouge">maxFetchCount</code> or <code class="language-plaintext highlighter-rouge">maxFetchSize</code>, a single query may only retrieve partial results. If all matching data has been fetched, this is set to <code class="language-plaintext highlighter-rouge">true</code>; otherwise, it is set to <code class="language-plaintext highlighter-rouge">false</code>.</li>
    </ul>
  </li>
</ul>

<p>Another version of <code class="language-plaintext highlighter-rouge">asyncMultiGet</code> supports <strong>range queries</strong> and <strong>conditional filtering</strong> for <code class="language-plaintext highlighter-rouge">SortKey</code>, allowing only data that meets specific conditions to be read. Starting from version 1.8.0, the <code class="language-plaintext highlighter-rouge">MultiGetOptions</code> includes a <code class="language-plaintext highlighter-rouge">reverse</code> parameter to support <strong>reverse scanning</strong> of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * get multiple key-values under the same hashKey with sortKey range limited, async version
     * @param hashKey used to decide which partition the key may exist
     *                should not be null or empty.
     * @param startSortKey the start sort key.
     *                     null means "".
     * @param stopSortKey the stop sort key.
     *                    null or "" means fetch to the last sort key.
     * @param options multi-get options.
     * @param maxFetchCount max count of kv pairs to be fetched
     *                      maxFetchCount &lt;= 0 means no limit. default value is 100
     * @param maxFetchSize max size of kv pairs to be fetched.
     *                     maxFetchSize &lt;= 0 means no limit. default value is 1000000.
     * @param timeout how long will the operation timeout in milliseconds.
     *                if timeout &gt; 0, it is a timeout value for current op,
     *                else the timeout value in the configuration file will be used.
     *
     * @return the future for current op
     *
     * Future return:
     *      On success: An object of type MultiGetResult
     *      On failure: a throwable, which is an instance of PException
     *
     * Thread safety:
     *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
     *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
     *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
     */</span>
    <span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span>
                                                <span class="nc">MultiGetOptions</span> <span class="n">options</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span>
                                                <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span><span class="o">,</span>
                                                <span class="nc">MultiGetOptions</span> <span class="n">options</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters are the same as <a href="#multiget"><code class="language-plaintext highlighter-rouge">multiGet</code></a>.</li>
</ul>

<h3 id="asyncset">asyncSet</h3>

<p>Asynchronously write a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">SetListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncSet future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * Set value for a specific (hashKey, sortKey) pair, async version
 * @param hashKey used to decide which partition the key may exist
 *                if null or empty, means hash key is "".
 * @param sortKey all keys under the same hashKey will be sorted by sortKey
 *                if null or empty, means sort key is "".
 * @param value should not be null
 * @param ttlSeconds time to live in seconds
 *                   0 means no ttl, default value is 0
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: no return
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      The api is thread safe.
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncSet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncSet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first one allows specifying the TTL time.</li>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, <code class="language-plaintext highlighter-rouge">value</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>; optionally includes <code class="language-plaintext highlighter-rouge">ttlSeconds</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
      <li><code class="language-plaintext highlighter-rouge">ttlSeconds</code> is the TTL time for the data, in seconds. TTL must be &gt;= 0; 0 means no TTL is set. If TTL &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Void&gt;</code>.</li>
</ul>

<h3 id="asyncmultiset">asyncMultiSet</h3>

<p>Asynchronously write multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">MultiSetListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="o">{</span>  
    <span class="cm">/**  
     * This function will be called when listened asyncMultiSet future is done.  
     * @param future the listened future  
     * @throws Exception  
     *  
     * Notice: User shouldn't do any operations that may block or time-consuming  
     */</span>  
    <span class="nd">@Override</span>  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>  
<span class="o">}</span>  

<span class="cm">/**  
 * Set key-values for a specific hashKey, async version  
 * @param hashKey used to decide which partition the key may exist  
 *                if null or empty, means hash key is "".  
 * @param values all (sortKey, value) pairs  
 *               should not be null or empty  
 * @param ttlSeconds time to live in seconds  
 *                   0 means no ttl, default value is 0  
 * @param timeout how long will the operation timeout in milliseconds.  
 *                if timeout &gt; 0, it is a timeout value for current op,  
 *                else the timeout value in the configuration file will be used.  
 *  
 * @return the future for current op  
 *  
 * Future return:  
 *      On success: no return  
 *      On failure: a throwable, which is an instance of PException  
 *  
 * Thread safety:  
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the  
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.  
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.  
 */</span>  
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncMultiSet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>  
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncMultiSet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>  
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first one allows specifying the TTL time.</li>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">values</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>; optionally includes <code class="language-plaintext highlighter-rouge">ttlSeconds</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">values</code> is a list of pairs, where the first element is the <code class="language-plaintext highlighter-rouge">sortKey</code> and the second is the <code class="language-plaintext highlighter-rouge">value</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
      <li><code class="language-plaintext highlighter-rouge">ttlSeconds</code> is the TTL time for the data, in seconds. TTL must be &gt;= 0; 0 means no TTL is set. If TTL &lt; 0, a <code class="language-plaintext highlighter-rouge">PException</code> will be thrown.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Void&gt;</code>.</li>
</ul>

<h3 id="asyncdel">asyncDel</h3>

<p>Asynchronously delete a single row of data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">DelListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="o">{</span>  
    <span class="cm">/**  
     * This function will be called when listened asyncDel future is done.  
     * @param future the listened future  
     * @throws Exception  
     *  
     * Notice: User shouldn't do any operations that may block or time-consuming  
     */</span>  
    <span class="nd">@Override</span>  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>  
<span class="o">}</span>  

<span class="cm">/**  
 * Delete value for a specific (hashKey, sortKey) pair, async version  
 * @param hashKey used to decide which partition the key may exist  
 *                if null or empty, means hash key is "".  
 * @param sortKey all keys under the same hashKey will be sorted by sortKey  
 *                if null or empty, means sort key is "".  
 * @param timeout how long will the operation timeout in milliseconds.  
 *                if timeout &gt; 0, it is a timeout value for current op,  
 *                else the timeout value in the configuration file will be used.  
 *  
 * @return the future for current op  
 *  
 * Future return:  
 *      On success: no return  
 *      On failure: a throwable, which is an instance of PException  
 *  
 * Thread safety:  
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the  
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.  
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.  
 */</span>  
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncDel</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>  
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Void&gt;</code>.</li>
</ul>

<h3 id="asyncmultidel">asyncMultiDel</h3>

<p>Asynchronously delete multiple rows of data under the same HashKey.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">MultiDelListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="o">{</span>  
    <span class="cm">/**  
     * This function will be called when listened asyncMultiDel future is done.  
     * @param future the listened future  
     * @throws Exception  
     *  
     * Notice: User shouldn't do any operations that may block or time-consuming  
     */</span>  
    <span class="nd">@Override</span>  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>  
<span class="o">}</span>  

<span class="cm">/**  
 * Delete multiple values for a specific hashKey, async version  
 * @param hashKey used to decide which partition the key may exist  
 *                if null or empty, means hash key is "".  
 * @param sortKeys all the sortKeys need to be deleted  
 *                 should not be null or empty  
 * @param timeout how long will the operation timeout in milliseconds.  
 *                if timeout &gt; 0, it is a timeout value for current op,  
 *                else the timeout value in the configuration file will be used.  
 *  
 * @return the future for current op  
 *  
 * Future return:  
 *      On success: no return  
 *      On failure: a throwable, which is an instance of PException  
 *  
 * Thread safety:  
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the  
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.  
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.  
 */</span>  
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">asyncMultiDel</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">sortKeys</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>  
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKeys</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sortKeys</code> must not be empty. If you don’t know what sort keys exist under the <code class="language-plaintext highlighter-rouge">hashKey</code>, you can use the <code class="language-plaintext highlighter-rouge">multiGetSortKeys</code> method to retrieve them.</li>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Void&gt;</code>.</li>
</ul>

<h3 id="asyncincr">asyncIncr</h3>

<p>Asynchronous atomic increment (or decrement) operation. The async version of <a href="#incr">incr</a>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">IncrListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncIncr future is done.
     *
     * @param future the listened future
     * @throws Exception throw exception if any error occurs.
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * atomically increment value by key, async version
 *
 * @param hashKey   the hash key to increment.
 * @param sortKey   the sort key to increment.
 * @param increment the increment to be added to the old value.
 * @param timeout   how long will the operation timeout in milliseconds.
 *                  if timeout &gt; 0, it is a timeout value for current op,
 *                  else the timeout value in the configuration file will be used.
 * @return the future for current op
 * &lt;p&gt;
 * Future return:
 * On success: return new value.
 * On failure: a throwable, which is an instance of PException
 * &lt;p&gt;
 * Thread safety:
 * All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 * listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 * But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">asyncIncr</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">long</span> <span class="n">increment</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters and return value: See synchronous <a href="#incr">incr</a> interface.</li>
</ul>

<h3 id="asynccheckandset">asyncCheckAndSet</h3>

<p>Atomic CAS operation for single HashKey, async version of <a href="#checkandset">checkAndSet</a>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CheckAndSetResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for checkAndSet
     *
     * @param setSucceed true if set value succeed.
     * @param checkValueReturned true if the check value is returned.
     * @param checkValueExist true if the check value is exist; can be used only when checkValueReturned is true.
     * @param checkValue return the check value if exist; can be used only when checkValueExist is true.
     */</span>
    <span class="kt">boolean</span> <span class="n">setSucceed</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">checkValueReturned</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">checkValueExist</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">CheckAndSetListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CheckAndSetResult</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncCheckAndSet future is done.
     *
     * @param future the listened future
     * @throws Exception throw exception if any error occurs.
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CheckAndSetResult</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * atomically check and set value by key, async version.
 * if the check condition is satisfied, then apply to set value.
 *
 * @param hashKey      the hash key to check and set.
 * @param checkSortKey the sort key to check.
 * @param checkType    the check type.
 * @param checkOperand the check operand.
 * @param setSortKey   the sort key to set value if check condition is satisfied.
 * @param setValue     the value to set if check condition is satisfied.
 * @param options      the check-and-set options.
 * @param timeout      how long will the operation timeout in milliseconds.
 *                     if timeout &gt; 0, it is a timeout value for current op,
 *                     else the timeout value in the configuration file will be used.
 * @return the future for current op
 * &lt;p&gt;
 * Future return:
 * On success: return CheckAndSetResult.
 * On failure: a throwable, which is an instance of PException
 * &lt;p&gt;
 * Thread safety:
 * All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 * listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 * But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CheckAndSetResult</span><span class="o">&gt;</span> <span class="nf">asyncCheckAndSet</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkSortKey</span><span class="o">,</span> <span class="nc">CheckType</span> <span class="n">checkType</span><span class="o">,</span>
                                                  <span class="kt">byte</span><span class="o">[]</span> <span class="n">checkOperand</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">setSortKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">setValue</span><span class="o">,</span>
                                                  <span class="nc">CheckAndSetOptions</span> <span class="n">options</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters and return value: See synchronous <a href="#checkandset">checkAndSet</a> interface.</li>
</ul>

<h3 id="asynccompareexchange">asyncCompareExchange</h3>

<p>Atomic compare-and-exchange for single <code class="language-plaintext highlighter-rouge">HashKey</code>, async version of <a href="#compareexchange">compareExchange</a>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CompareExchangeResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for CompareExchange
     *
     * @param setSucceed true if set value succeed.
     * @param actualValue return the actual value if set value failed; null means the actual value is not exist.
     */</span>
    <span class="kt">boolean</span> <span class="n">setSucceed</span><span class="o">;</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">actualValue</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">CompareExchangeListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CompareExchangeResult</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncCompareExchange future is done.
     *
     * @param future the listened future
     * @throws Exception throw exception if any error occurs.
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CompareExchangeResult</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * atomically compare and exchange value by key, async version.
 * &lt;p&gt;
 * - if the original value for the key is equal to the expected value, then update it with the desired value,
 *   set CompareExchangeResult.setSucceed to true, and set CompareExchangeResult.actualValue to null because
 *   the actual value must be equal to the desired value.
 * - if the original value for the key is not exist or not equal to the expected value, then set
 *   CompareExchangeResult.setSucceed to false, and set the actual value in CompareExchangeResult.actualValue.
 * &lt;p&gt;
 * this method is very like the C++ function in {https://en.cppreference.com/w/cpp/atomic/atomic_compare_exchange}.
 *
 * @param hashKey       the hash key to compare and exchange.
 * @param sortKey       the sort key to compare and exchange.
 * @param expectedValue the value expected to be found for the key.
 * @param desiredValue  the desired value to set if the original value for the key is equal to the expected value.
 * @param ttlSeconds    time to live in seconds of the desired value, 0 means no ttl.
 * @param timeout       how long will the operation timeout in milliseconds.
 *                      if timeout &gt; 0, it is a timeout value for current op,
 *                      else the timeout value in the configuration file will be used.
 * @return the future for current op
 * &lt;p&gt;
 * Future return:
 * On success: return CompareExchangeResult.
 * On failure: a throwable, which is an instance of PException
 * &lt;p&gt;
 * Thread safety:
 * All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 * listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 * But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">CompareExchangeResult</span><span class="o">&gt;</span> <span class="nf">asyncCompareExchange</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span>
                                                          <span class="kt">byte</span><span class="o">[]</span> <span class="n">expectedValue</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">desiredValue</span><span class="o">,</span>
                                                          <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters and return value: See synchronous <a href="#compareexchange">compareExchange</a> interface.</li>
</ul>

<h3 id="asyncttl">asyncTTL</h3>

<p>Asynchronously get TTL (time-to-live) for a key-value pair in seconds.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">TTLListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncTTL future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * get TTL value for a specific (hashKey, sortKey) pair, async version
 * @param hashKey used to decide which partition the key may exist
 *                if null or empty, means hash key is "".
 * @param sortKey all keys under the same hashKey will be sorted by sortKey
 *                if null or empty, means sort key is "".
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: ttl time in seconds; -1 if no ttl set; -2 if not exist.
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">asyncTTL</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="asyncexist">asyncExist</h3>

<p>Asynchronously check if data exists.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">ExistListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncExist future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * Check value existence for a specific (hashKey, sortKey) pair of current table, async version
 * @param hashKey used to decide which partition the key may exist
 *                if null or length == 0, means hash key is "".
 * @param sortKey all keys under the same hashKey will be sorted by sortKey
 *                if null or length == 0, means sort key is "".
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return A future for current op.
 *
 * Future return:
 *      On success: true if exist, false if not exist
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      The api is thread safe.
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Boolean</span><span class="o">&gt;</span> <span class="nf">asyncExist</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">sortKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code>, <code class="language-plaintext highlighter-rouge">sortKey</code>, and <code class="language-plaintext highlighter-rouge">timeout</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Boolean&gt;</code>.
    <ul>
      <li>The result is a boolean value. Returns <code class="language-plaintext highlighter-rouge">true</code> if the data exists, otherwise <code class="language-plaintext highlighter-rouge">false</code>.</li>
    </ul>
  </li>
</ul>

<h3 id="asyncsortkeycount">asyncSortKeyCount</h3>

<p>Asynchronously get the count of all <code class="language-plaintext highlighter-rouge">sortKeys</code> under a specific <code class="language-plaintext highlighter-rouge">hashKey</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">SortKeyCountListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncSortKeyCount future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * Count the sortkeys for a specific hashKey, async version
 * @param hashKey used to decide which partition the key may exist
 *                should not be null or empty
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: the count result for the hashKey
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      The api is thread safe.
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">asyncSortKeyCount</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">HashKey</code> and <code class="language-plaintext highlighter-rouge">timeout</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;Long&gt;</code>.
    <ul>
      <li>The result is the count of all sortKeys under the specified hashKey.</li>
    </ul>
  </li>
</ul>

<h3 id="asyncmultigetsortkeys">asyncMultiGetSortKeys</h3>

<p>Asynchronously get the list of <code class="language-plaintext highlighter-rouge">sortKeys</code> under a specific <code class="language-plaintext highlighter-rouge">hashKey</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MultiGetSortKeysResult</span> <span class="o">{</span>
    <span class="cm">/**
     * return value for multiGetSortkeys
     * @param allFetched true if all data on the server are fetched; false if only partial data are fetched.
     * @param keys the got keys.
     *             The output keys are in order.
     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">allFetched</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">keys</span><span class="o">;</span>
<span class="o">};</span>
 
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">MultiGetSortKeysListener</span> <span class="kd">extends</span> <span class="nc">GenericFutureListener</span><span class="o">&lt;</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetSortKeysResult</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="cm">/**
     * This function will be called when listened asyncMultiGetSortKeys future is done.
     * @param future the listened future
     * @throws Exception
     *
     * Notice: User shouldn't do any operations that may block or time-consuming
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operationComplete</span><span class="o">(</span><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetSortKeysResult</span><span class="o">&gt;</span> <span class="n">future</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="cm">/**
 * get all the sortKeys for the same hashKey
 * @param hashKey used to decide which partition the key may exist
 *                should not be null or empty.
 * @param maxFetchCount max count of kv pairs to be fetched
 *                      maxFetchCount &lt;= 0 means no limit. default value is 100
 * @param maxFetchSize max size of kv pairs to be fetched.
 *                     maxFetchSize &lt;= 0 means no limit. default value is 1000000.
 * @param timeout how long will the operation timeout in milliseconds.
 *                if timeout &gt; 0, it is a timeout value for current op,
 *                else the timeout value in the configuration file will be used.
 *
 * @return the future for current op
 *
 * Future return:
 *      On success: An object of type MultiGetSortKeysResult
 *      On failure: a throwable, which is an instance of PException
 *
 * Thread safety:
 *      All the listeners for the same table are guaranteed to be dispatched in the same thread, so all the
 *      listeners for the same future are guaranteed to be executed as the same order as the listeners added.
 *      But listeners for different tables are not guaranteed to be dispatched in the same thread.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetSortKeysResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGetSortKeys</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchCount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">MultiGetSortKeysResult</span><span class="o">&gt;</span> <span class="nf">asyncMultiGetSortKeys</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">hashKey</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="cm">/*ms*/</span><span class="o">);</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Two versions of the interface are provided, where the first one allows specifying <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.</li>
  <li>Parameters: Requires <code class="language-plaintext highlighter-rouge">hashKey</code> and <code class="language-plaintext highlighter-rouge">timeout</code>; optionally accepts <code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">timeout</code> is in milliseconds. If &lt;= 0, the default timeout from the configuration file will be used.</li>
      <li><code class="language-plaintext highlighter-rouge">maxFetchCount</code> and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> limit the amount of data fetched. <code class="language-plaintext highlighter-rouge">maxFetchCount</code> specifies the maximum number of items, and <code class="language-plaintext highlighter-rouge">maxFetchSize</code> specifies the maximum data size in bytes. Fetching stops when either limit is reached.</li>
    </ul>
  </li>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Future&lt;MultiGetSortKeysResult&gt;</code>.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">allFetched</code>: If the user specifies <code class="language-plaintext highlighter-rouge">maxFetchCount</code> or <code class="language-plaintext highlighter-rouge">maxFetchSize</code>, a single query may only retrieve partial results. If all matching data has been fetched, this is set to <code class="language-plaintext highlighter-rouge">true</code>; otherwise, it is set to <code class="language-plaintext highlighter-rouge">false</code>.</li>
    </ul>
  </li>
</ul>

<h2 id="pegasusscannerinterface">PegasusScannerInterface</h2>

<h3 id="next">next</h3>

<p>Synchronously fetches the next item during scan operation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get the next item.
 * @return item like &lt;&lt;hashKey, sortKey&gt;, value&gt;; null returned if scan completed.
 * @throws PException
 */</span>
<span class="kd">public</span> <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="nf">next</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">PException</span><span class="o">;</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Return value: <code class="language-plaintext highlighter-rouge">Pair&lt;Pair&lt;byte[], byte[]&gt;, byte[]&gt;</code>.
    <ul>
      <li>Returns the next kv-pair; returns null if scan operation completes.</li>
    </ul>
  </li>
</ul>

<h3 id="asyncnext">asyncNext</h3>

<p>Asynchronously fetches the next item during scan operation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Get the next item asynchronously.
 * @return A future for current op.
 *
 * Future return:
 *      On success: if scan hasn't reached the end then return the kv-pair, else return null.
 *      On failure: a throwable, which is an instance of PException.
 */</span>
<span class="kd">public</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;,</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="nf">asyncNext</span><span class="o">();</span>
</code></pre></div></div>

<p>Notes:</p>

<ul>
  <li>Return value: Future&lt;Pair&lt;Pair&lt;byte[], byte[]&gt;, byte[]&gt;&gt;.</li>
  <li>Returns the required kv-pair before scan completes; returns null after scan completes.</li>
</ul>

<h2 id="common-exceptions">Common Exceptions</h2>

<h3 id="err_object_not_found">ERR_OBJECT_NOT_FOUND</h3>

<p>Table does not exist. Possible causes:</p>

<ul>
  <li>Table not created in the cluster.</li>
  <li>Accessed wrong cluster. Search for <code class="language-plaintext highlighter-rouge">meta_servers</code> in logs to verify cluster configuration.</li>
  <li>Table name misspelled. Check table name in code, search for <code class="language-plaintext highlighter-rouge">initialize table handler</code> in logs to verify table name.</li>
</ul>

<h3 id="err_timeout">ERR_TIMEOUT</h3>

<p>Request timeout. Possible causes:</p>

<ul>
  <li>Network connection error.</li>
  <li>Read/write latency exceeds timeout threshold.</li>
  <li>Service jitter.</li>
</ul>

<h3 id="err_session_reset">ERR_SESSION_RESET</h3>

<p>Server-side state error. Possible causes:</p>

<ul>
  <li>Server is undergoing replica migration with state transition.</li>
  <li>Server node failure causes insufficient replicas, leading to service degradation for data consistency.</li>
  <li>If this error occurs during client initialization, check meta configuration for correctness.</li>
</ul>

<h3 id="err_busy">ERR_BUSY</h3>

<p>Server-side flow control limit reached. Causes:</p>

<ul>
  <li>Cluster server has enabled <a href="/administration/throttling#server-side-flow-control">table-level write flow control</a>.</li>
  <li>Instantaneous write operations per second (QPS) exceeded threshold, triggering reject flow control with <code class="language-plaintext highlighter-rouge">ERR_BUSY</code>.</li>
</ul>

<h1 id="best-practices">Best Practices</h1>

<h2 id="flow-control">Flow Control</h2>

<p>In scenarios where businesses frequently perform bulk data ingestion (either single-machine or distributed, such as using Spark for processing before writing to Pegasus), it’s common to encounter high QPS spikes during writes. Without flow control, these spikes can impose significant pressure on the Pegasus system:</p>

<ul>
  <li>Extremely high write QPS can degrade read performance, increasing latency for read operations.</li>
  <li>Extremely high write QPS may overwhelm the cluster, causing service interruptions.</li>
</ul>

<p>Thus, it is strongly recommended that business sides implement write QPS flow control during bulk data ingestion.</p>

<p>The client-side flow control approach involves:</p>

<ol>
  <li>Determining the total QPS limit (e.g., 10,000/s) and the number of concurrent client threads (e.g., 50), then calculating the per-thread QPS limit (e.g., 10,000/50 = 200).</li>
  <li>For each client thread, use a flow control tool to restrict QPS within the desired range. If the QPS limit is exceeded, a simple <code class="language-plaintext highlighter-rouge">sleep</code> mechanism is applied to wait. We provide a flow control utility class, <a href="https://github.com/XiaoMi/pegasus-java-client/blob/thrift-0.11.0-inlined/src/main/java/com/xiaomi/infra/pegasus/tools/FlowController.java"><code class="language-plaintext highlighter-rouge">com.xiaomi.infra.pegasus.tools.FlowController</code></a>, which encapsulates the QPS calculation and <code class="language-plaintext highlighter-rouge">sleep</code> logic for ease of use.</li>
</ol>

<p><strong>Usage of <code class="language-plaintext highlighter-rouge">FlowController</code>:</strong></p>

<ul>
  <li>The constructor accepts a QPS parameter to specify the flow limit (e.g., 200/s for a single thread).</li>
  <li>Before each write operation, call <code class="language-plaintext highlighter-rouge">cntl.getToken()</code>. This method behaves as follows:
    <ul>
      <li>If the flow limit hasn’t been reached, it returns immediately, allowing the write operation to proceed.</li>
      <li>If the flow limit is exceeded, the method blocks (via <code class="language-plaintext highlighter-rouge">sleep</code>) for a period to enforce the limit.</li>
    </ul>
  </li>
  <li>This tool works best with synchronous interfaces; its effectiveness with asynchronous interfaces may be limited.</li>
</ul>

<p>Example usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">FlowController</span> <span class="n">cntl</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FlowController</span><span class="o">(</span><span class="n">qps</span><span class="o">);</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Call getToken before operation</span>
    <span class="n">cntl</span><span class="o">.</span><span class="na">getToken</span><span class="o">();</span>
    <span class="n">client</span><span class="o">.</span><span class="na">set</span><span class="o">(...);</span>
<span class="o">}</span>
<span class="n">cntl</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</code></pre></div></div>

<p>For distributed bulk data ingestion, determine the total concurrent tasks, then divide the total QPS limit by the number of tasks to get the per-task QPS limit, and apply <code class="language-plaintext highlighter-rouge">FlowController</code> accordingly.</p>

<h2 id="paginated-queries">Paginated Queries</h2>

<p>Similar to implementing pagination for web lists, a typical use case involves displaying a fixed number of <code class="language-plaintext highlighter-rouge">SortKey</code> values per page under a single <code class="language-plaintext highlighter-rouge">HashKey</code>, with subsequent pages showing the next set of <code class="language-plaintext highlighter-rouge">SortKey</code> values.</p>

<p>Pegasus supports multiple approaches for paginated queries:</p>

<ol>
  <li>Fetch all data under the <code class="language-plaintext highlighter-rouge">HashKey</code> in one time, cache and implement pagination logic on the client side.</li>
  <li><strong>Forward pagination</strong>: Use <a href="#multiget"><code class="language-plaintext highlighter-rouge">multiGet()</code></a> or <a href="#getscanner"><code class="language-plaintext highlighter-rouge">getScanner()</code></a>, both of which support range queries on <code class="language-plaintext highlighter-rouge">SortKey</code>.</li>
  <li><strong>Reverse pagination</strong>: Use <a href="#multiget"><code class="language-plaintext highlighter-rouge">multiGet()</code></a>, which supports reverse-order queries on <code class="language-plaintext highlighter-rouge">SortKey</code>.</li>
</ol>

<h3 id="forward-pagination">Forward Pagination</h3>

<p>Using the <code class="language-plaintext highlighter-rouge">getScanner</code> interface:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ScanOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ScanOptions</span><span class="o">();</span>
<span class="n">options</span><span class="o">.</span><span class="na">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">batchSize</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span> <span class="c1">// Limit page size to 20</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">PegasusScannerInterface</span> <span class="n">scanner</span> <span class="o">=</span>
  <span class="n">client</span><span class="o">.</span><span class="na">getScanner</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">hashKey</span><span class="o">,</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="n">options</span><span class="o">);</span>

<span class="c1">// Synchronous retrieval</span>
<span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">item</span><span class="o">;</span>
<span class="k">while</span> <span class="o">((</span><span class="n">item</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// ... //</span>
<span class="o">}</span>

<span class="c1">// Asynchronous retrieval</span>
<span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;,</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">item</span><span class="o">;</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">item</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">asyncNext</span><span class="o">();</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="nc">Pair</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">pair</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// ... //</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If using <code class="language-plaintext highlighter-rouge">multiGet</code>, set <code class="language-plaintext highlighter-rouge">maxFetchCount</code> in <code class="language-plaintext highlighter-rouge">MultiGetOptions</code> to limit the number of items per page:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Fetch first page</span>
<span class="nc">MultiGetOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MultiGetOptions</span><span class="o">();</span>
<span class="n">options</span><span class="o">.</span><span class="na">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">maxFetchCount</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span> <span class="c1">// Limit page size to 20</span>
<span class="kt">int</span> <span class="n">maxFetchSize</span> <span class="o">=</span> <span class="mi">20000</span><span class="o">;</span> <span class="c1">// Limit total bytes per page to 20,000</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">startSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">stopSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Pair</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="kt">boolean</span> <span class="n">allFetched</span> <span class="o">=</span>
    <span class="n">client</span><span class="o">.</span><span class="na">multiGet</span><span class="o">(</span>
        <span class="n">tableName</span><span class="o">,</span> <span class="n">hashKey</span><span class="o">,</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="n">options</span><span class="o">,</span>
        <span class="n">maxFetchCount</span><span class="o">,</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">allFetched</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// ... //</span>

<span class="c1">// Fetch next page</span>
<span class="n">options</span><span class="o">.</span><span class="na">startInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">startSortKey</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">values</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// Use the last (max) value from the previous page as the start for the next</span>
<span class="n">stopSortKey</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">allFetched</span> <span class="o">=</span>
    <span class="n">client</span><span class="o">.</span><span class="na">multiGet</span><span class="o">(</span>
        <span class="n">tableName</span><span class="o">,</span> <span class="n">hashKey</span><span class="o">,</span> <span class="n">startSortKey</span><span class="o">,</span> <span class="n">stopSortKey</span><span class="o">,</span> <span class="n">options</span><span class="o">,</span>
        <span class="n">maxFetchCount</span><span class="o">,</span> <span class="n">maxFetchSize</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">allFetched</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="reverse-pagination">Reverse Pagination</h3>

<p>For reverse pagination, use the <code class="language-plaintext highlighter-rouge">multiGet</code> interface with <code class="language-plaintext highlighter-rouge">reverse=true</code> in the options:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">MultiGetOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MultiGetOptions</span><span class="o">();</span>
<span class="n">options</span><span class="o">.</span><span class="na">startInclusive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">stopInclusive</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">options</span><span class="o">.</span><span class="na">reverse</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</code></pre></div></div>

<h2 id="data-serialization">Data Serialization</h2>

<p>Pegasus stores keys and values as raw byte arrays (<code class="language-plaintext highlighter-rouge">byte[]</code> in Java), while user data is typically structured as classes or objects. Thus, <strong>serialization</strong> is required to convert user data into byte arrays before storage, and <strong>deserialization</strong> is needed to reconstruct the data when reading from Pegasus. These processes are typically paired, so we focus on serialization here.</p>

<p>Common serialization methods include:</p>

<ul>
  <li><strong>JSON</strong>: Human-readable but space-inefficient (not recommended).</li>
  <li><strong>Thrift</strong>: Offers multiple compact protocols (e.g., binary). We recommend <code class="language-plaintext highlighter-rouge">tcompact</code> for higher compression.</li>
  <li><strong>Protocol Buffers</strong>: Similar to thrift; recommend binary format serialization.</li>
</ul>

<p>Example for Thrift serialization using <code class="language-plaintext highlighter-rouge">tcompact</code> protocol:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.thrift.TSerializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.protocol.TCompactProtocol</span><span class="o">;</span>

<span class="nc">TSerializer</span> <span class="n">serializer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TSerializer</span><span class="o">(</span><span class="k">new</span> <span class="nc">TCompactProtocol</span><span class="o">.</span><span class="na">Factory</span><span class="o">());</span> 
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="data-compression">Data Compression</h2>

<p>For applications with large values (≥2KB), we recommend using <a href="https://github.com/facebook/zstd">Facebook’s Zstandard (Zstd)</a> compression on the client side to reduce value size, improving Pegasus stability and performance. Zstd offers a good balance between compression ratio and speed.</p>

<p>Starting with Java Client v1.11.3, we provide <a href="https://github.com/XiaoMi/pegasus-java-client/blob/thrift-0.11.0-inlined/src/main/java/com/xiaomi/infra/pegasus/tools/ZstdWrapper.java"><code class="language-plaintext highlighter-rouge">com.xiaomi.infra.pegasus.tools.ZstdWrapper</code></a> for easy compression.</p>

<p>Example usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"xxx"</span><span class="o">;</span>

    <span class="c1">// write the record into pegasus</span>
    <span class="n">table</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"h"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"s"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="nc">ZstdWrapper</span><span class="o">.</span><span class="na">compress</span><span class="o">(</span><span class="n">value</span><span class="o">),</span> <span class="mi">1000</span><span class="o">);</span>

    <span class="c1">// read the record from pegasus</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">compressedBuf</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"h"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"s"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="mi">1000</span><span class="o">);</span>

    <span class="c1">// decompress the value</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">orginalValue</span> <span class="o">=</span> <span class="nc">ZstdWrapper</span><span class="o">.</span><span class="na">decompress</span><span class="o">(</span><span class="n">compressedBuf</span><span class="o">);</span>
</code></pre></div></div>

<p>Refer to the test case <a href="https://github.com/XiaoMi/pegasus-java-client/blob/thrift-0.11.0-inlined/src/test/java/com/xiaomi/infra/pegasus/tools/TestZstdWrapper.java"><code class="language-plaintext highlighter-rouge">TestZstdWrapper.java</code></a> for more details.</p>

<p>Both optimizations—<a href="#data-serialization">data serialization</a> and <a href="#data-compression">data compression</a>—trade client-side CPU for improved cluster stability and performance, which is generally worthwhile.</p>

<p>For existing tables without client-side compression, follow these steps to adopt compression:</p>

<ol>
  <li><strong><a href="#evaluating-compression-benefits">Evaluate Compression Benefits</a></strong>: Assess potential compression ratios.</li>
  <li><strong><a href="#using-compatibility-compression">Use Compatibility Mode</a></strong>: Upgrade client logic to support compression while maintaining backward compatibility.</li>
</ol>

<h3 id="evaluating-compression-benefits">Evaluating Compression Benefits</h3>

<p>For existing tables that originally did not use client-side compression, how to quickly evaluate the potential benefits after enabling client-side compression?</p>

<p>Prerequisites:</p>

<ul>
  <li>Production cluster: <code class="language-plaintext highlighter-rouge">user_cluster</code> with meta server address <code class="language-plaintext highlighter-rouge">${user_cluster_meta_list}</code>, containing user table <code class="language-plaintext highlighter-rouge">user_table</code>.</li>
  <li>Test cluster: <code class="language-plaintext highlighter-rouge">test_cluster</code> with meta server address <code class="language-plaintext highlighter-rouge">${test_cluster_meta_list}</code>.</li>
  <li><a href="/overview/shell">Shell tool</a>: Version 1.11.3 or higher; modify the configuration file <code class="language-plaintext highlighter-rouge">src/shell/config.ini</code> to add access configuration for <code class="language-plaintext highlighter-rouge">test_cluster</code>.</li>
  <li><a href="#getting-the-java-client">Java client tool</a>: Version 1.11.4 or higher; modify the configuration file <code class="language-plaintext highlighter-rouge">pegasus.properties</code> to set <code class="language-plaintext highlighter-rouge">meta_servers = ${test_cluster_meta_list}</code>.</li>
</ul>

<p>Steps:</p>

<ol>
  <li>Use the shell tool’s <code class="language-plaintext highlighter-rouge">create</code> command to create test tables <code class="language-plaintext highlighter-rouge">user_table_no_compress</code> and <code class="language-plaintext highlighter-rouge">user_table_zstd_compress</code> in the test cluster:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./run.sh shell --cluster ${test_cluster_meta_list}
&gt;&gt;&gt; create user_table_no_compress -p 8 -r 3
&gt;&gt;&gt; create user_table_zstd_compress -p 8 -r 3
</code></pre></div></div>

<ol>
  <li>Use the shell tool’s <code class="language-plaintext highlighter-rouge">copy_data</code> command to copy partial data from the production cluster’s <code class="language-plaintext highlighter-rouge">user_table</code> to the test cluster’s <code class="language-plaintext highlighter-rouge">user_table_no_compress</code> (interrupt with Ctrl-C after sufficient data is copied):</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./run.sh shell --cluster ${user_cluster_meta_list}
&gt;&gt;&gt; use user_table
&gt;&gt;&gt; copy_data -c test_cluster -a user_table_no_compress
</code></pre></div></div>

<ol>
  <li>Use the Java client tool’s <code class="language-plaintext highlighter-rouge">copy_data</code> command to copy data from <code class="language-plaintext highlighter-rouge">user_table_no_compress</code> to <code class="language-plaintext highlighter-rouge">user_table_zstd_compress</code> with zstd compression enabled for writing:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./PegasusCli file://./pegasus.properties user_table_no_compress \
    copy_data file://./pegasus.properties user_table_zstd_compress none zstd
</code></pre></div></div>

<ol>
  <li>Use the shell tool’s <code class="language-plaintext highlighter-rouge">count_data</code> command to compare data sizes between the two test tables and calculate compression ratio:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./run.sh shell --cluster ${test_cluster_meta_list}
&gt;&gt;&gt; use user_table_no_compress 
&gt;&gt;&gt; count_data -a
&gt;&gt;&gt; use user_table_zstd_compress 
&gt;&gt;&gt; count_data -a
</code></pre></div></div>

<h3 id="using-compatibility-compression">Using Compatibility Compression</h3>

<p>When a business table contains existing uncompressed data and client-side compression is later enabled, newly written compressed data will coexist with old uncompressed data (having the same hashKey and sortKey), resulting in a mixed state where:</p>

<ul>
  <li>Some values store uncompressed data</li>
  <li>Some values store compressed data</li>
</ul>

<p>This requires the client to maintain compatibility when reading data - being able to handle both compressed and uncompressed values.</p>

<p>Based on the fact that zstd decompression will almost always fail when applied to uncompressed data, the client-side reading logic should:</p>

<ol>
  <li>First attempt to decompress the retrieved value. If successful, the data is compressed.</li>
  <li>If decompression fails, treat the data as uncompressed.</li>
</ol>

<p>Sample code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// decompress the value</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">decompressedValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">decompressedValue</span> <span class="o">=</span> <span class="nc">ZstdWrapper</span><span class="o">.</span><span class="na">decompress</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">PException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// decompress fail</span>
        <span class="n">decompressedValue</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Meanwhile, background tools can gradually replace uncompressed data with compressed versions while maintaining consistency:</p>

<ul>
  <li>Scan the table record by record</li>
  <li>For uncompressed data, convert it to compressed format</li>
  <li>Use check-and-set atomic operations for replacement</li>
</ul>

<h2 id="client-connection-warm-up">Client Connection Warm-Up</h2>

<p>We provide connection warm-up functionality that prefetches routing tables and establishes connections during <code class="language-plaintext highlighter-rouge">openTable</code>, preventing slow first RPC calls caused by these initialization steps.</p>

<p>Sample code:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">PegasusTableInterface</span> <span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">openTable</span><span class="o">(</span><span class="n">tableName</span><span class="o">);</span>
</code></pre></div></div>

<h1 id="frequently-asked-questions">Frequently Asked Questions</h1>

                </div>
            </section>
            <footer class="footer">
    <div class="container">
        <div class="content is-small has-text-centered">
            <div style="margin-bottom: 20px;">
                <a href="http://incubator.apache.org">
                    <img src="/assets/images/egg-logo.png"
                         width="15%"
                         alt="Apache Incubator"/>
                </a>
            </div>
            Copyright &copy; 2023 <a href="http://www.apache.org">The Apache Software Foundation</a>.
            Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
            2.0</a>.
            <br><br>
            
            Apache Pegasus is an effort undergoing incubation at The Apache Software Foundation (ASF),
            sponsored by the Apache Incubator. Incubation is required of all newly accepted projects
            until a further review indicates that the infrastructure, communications, and decision making process
            have stabilized in a manner consistent with other successful ASF projects. While incubation status is
            not necessarily a reflection of the completeness or stability of the code, it does indicate that the
            project has yet to be fully endorsed by the ASF.
            
            <br><br>
            Apache Pegasus, Pegasus, Apache, the Apache feather logo, and the Apache Pegasus project logo are either
            registered trademarks or trademarks of The Apache Software Foundation in the United States and other
            countries.
        </div>
    </div>
</footer>
        </div>

        <!-- right panel -->
        <div class="dashboard-panel is-small is-scrollable is-hidden-mobile">
            <p class="menu-label">
    <span class="icon">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </span>
    Table of contents
</p>
<ul class="menu-list">
  <li><a href="#getting-the-java-client">Getting the Java Client</a></li>
  <li><a href="#client-configuration">Client Configuration</a>
    <ul>
      <li><a href="#file-based-configuration">File-based Configuration</a></li>
      <li><a href="#parameter-passing">Parameter Passing</a></li>
    </ul>
  </li>
  <li><a href="#interface-definition">Interface Definition</a>
    <ul>
      <li><a href="#creating-a-client-instance">Creating a Client Instance</a>
        <ul>
          <li><a href="#singleton">Singleton</a></li>
          <li><a href="#non-singleton">Non-Singleton</a></li>
        </ul>
      </li>
      <li><a href="#pegasusclientinterface">PegasusClientInterface</a>
        <ul>
          <li><a href="#get">get</a></li>
          <li><a href="#batchget">batchGet</a></li>
          <li><a href="#batchget2">batchGet2</a></li>
          <li><a href="#multiget">multiGet</a></li>
          <li><a href="#batchmultiget">batchMultiGet</a></li>
          <li><a href="#batchmultiget2">batchMultiGet2</a></li>
          <li><a href="#set">set</a></li>
          <li><a href="#batchset">batchSet</a></li>
          <li><a href="#batchset2">batchSet2</a></li>
          <li><a href="#multiset">multiSet</a></li>
          <li><a href="#batchmultiset">batchMultiSet</a></li>
          <li><a href="#batchmultiset2">batchMultiSet2</a></li>
          <li><a href="#del">del</a></li>
          <li><a href="#batchdel">batchDel</a></li>
          <li><a href="#batchdel2">batchDel2</a></li>
          <li><a href="#multidel">multiDel</a></li>
          <li><a href="#batchmultidel">batchMultiDel</a></li>
          <li><a href="#batchmultidel2">batchMultiDel2</a></li>
          <li><a href="#delrange">delRange</a></li>
          <li><a href="#incr">incr</a></li>
          <li><a href="#checkandset">checkAndSet</a></li>
          <li><a href="#checkandmutate">checkAndMutate</a></li>
          <li><a href="#compareexchange">compareExchange</a></li>
          <li><a href="#ttl">ttl</a></li>
          <li><a href="#exist">exist</a></li>
          <li><a href="#sortkeycount">sortKeyCount</a></li>
          <li><a href="#multigetsortkeys">multiGetSortKeys</a></li>
          <li><a href="#getscanner">getScanner</a></li>
          <li><a href="#getunorderedscanner">getUnorderedScanner</a></li>
        </ul>
      </li>
      <li><a href="#creating-table-instances">Creating Table Instances</a>
        <ul>
          <li><a href="#future-based-asynchronous-apis">Future-Based Asynchronous APIs</a></li>
        </ul>
      </li>
      <li><a href="#pegasustableinterface-apis">PegasusTableInterface APIs</a>
        <ul>
          <li><a href="#asyncget">asyncGet</a></li>
          <li><a href="#asyncmultiget">asyncMultiGet</a></li>
          <li><a href="#asyncset">asyncSet</a></li>
          <li><a href="#asyncmultiset">asyncMultiSet</a></li>
          <li><a href="#asyncdel">asyncDel</a></li>
          <li><a href="#asyncmultidel">asyncMultiDel</a></li>
          <li><a href="#asyncincr">asyncIncr</a></li>
          <li><a href="#asynccheckandset">asyncCheckAndSet</a></li>
          <li><a href="#asynccompareexchange">asyncCompareExchange</a></li>
          <li><a href="#asyncttl">asyncTTL</a></li>
          <li><a href="#asyncexist">asyncExist</a></li>
          <li><a href="#asyncsortkeycount">asyncSortKeyCount</a></li>
          <li><a href="#asyncmultigetsortkeys">asyncMultiGetSortKeys</a></li>
        </ul>
      </li>
      <li><a href="#pegasusscannerinterface">PegasusScannerInterface</a>
        <ul>
          <li><a href="#next">next</a></li>
          <li><a href="#asyncnext">asyncNext</a></li>
        </ul>
      </li>
      <li><a href="#common-exceptions">Common Exceptions</a>
        <ul>
          <li><a href="#err_object_not_found">ERR_OBJECT_NOT_FOUND</a></li>
          <li><a href="#err_timeout">ERR_TIMEOUT</a></li>
          <li><a href="#err_session_reset">ERR_SESSION_RESET</a></li>
          <li><a href="#err_busy">ERR_BUSY</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#best-practices">Best Practices</a>
    <ul>
      <li><a href="#flow-control">Flow Control</a></li>
      <li><a href="#paginated-queries">Paginated Queries</a>
        <ul>
          <li><a href="#forward-pagination">Forward Pagination</a></li>
          <li><a href="#reverse-pagination">Reverse Pagination</a></li>
        </ul>
      </li>
      <li><a href="#data-serialization">Data Serialization</a></li>
      <li><a href="#data-compression">Data Compression</a>
        <ul>
          <li><a href="#evaluating-compression-benefits">Evaluating Compression Benefits</a></li>
          <li><a href="#using-compatibility-compression">Using Compatibility Compression</a></li>
        </ul>
      </li>
      <li><a href="#client-connection-warm-up">Client Connection Warm-Up</a></li>
    </ul>
  </li>
  <li><a href="#frequently-asked-questions">Frequently Asked Questions</a></li>
</ul>

        </div>
    </div>

    <script src="/assets/js/app.js" type="text/javascript"></script>
     <script>
     docsearch({
         container: '#docsearch',
         appId: 'QRN30RBW0S',
         indexName: 'pegasus-apache',
         apiKey: 'd3a3252fa344359766707a106c4ed88f',
         debug: true
     });
 </script>

</body>

</html>