<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pegasus | Architecture</title>
    <link rel="stylesheet" href="/zh/assets/css/app.css">
    <link rel="shortcut icon" href="/zh/assets/images/favicon.ico">
    <link href="https://cdn.bootcdn.net/ajax/libs/tailwindcss/1.8.10/utilities.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Architecture | Pegasus</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Architecture" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="整体架构" />
<meta property="og:description" content="整体架构" />
<meta property="og:site_name" content="Pegasus" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-02T06:03:01+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Architecture" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-02T06:03:01+00:00","datePublished":"2023-11-02T06:03:01+00:00","description":"整体架构","headline":"Architecture","mainEntityOfPage":{"@type":"WebPage","@id":"/overview/architecture"},"url":"/overview/architecture"}</script>
<!-- End Jekyll SEO tag -->
</head>

  <body>
    



<nav class="navbar is-primary">
    <div class="container">
        <!--container will be unwrapped when it's in docs-->
        <div class="navbar-brand">
            <a href="/zh/" class="navbar-item ">
                <!-- Pegasus Icon -->
                <img src="/assets/images/pegasus.svg">
            </a>
            <div class="navbar-item">
                <a href="/zh/docs" class="button is-primary is-outlined is-inverted">
                    <span class="icon"><i class="fas fa-book"></i></span>
                    <span>Docs</span>
                </a>
            </div>
            <div class="navbar-item is-hidden-desktop">
                  

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<!--If you don't want a url to be relativized, you can add a space explicitly into the href to 
    prevents a url from being relativized by polyglot.-->
<a class="button is-primary is-outlined is-inverted" href=" /overview/architecture"><strong>En</strong></a>

            </div>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <!-- Appears in mobile mode only -->
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-end">
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href=""
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-users"></i>
                        </span>
                        
                        <span>
                            ASF
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="https://www.apache.org/"
                            class="navbar-item ">
                            Foundation
                        </a>
                        
                        <a href="https://www.apache.org/licenses/"
                            class="navbar-item ">
                            License
                        </a>
                        
                        <a href="https://www.apache.org/events/current-event.html"
                            class="navbar-item ">
                            Events
                        </a>
                        
                        <a href="https://www.apache.org/foundation/sponsorship.html"
                            class="navbar-item ">
                            Sponsorship
                        </a>
                        
                        <a href="https://www.apache.org/security/"
                            class="navbar-item ">
                            Security
                        </a>
                        
                        <a href="https://privacy.apache.org/policies/privacy-policy-public.html"
                            class="navbar-item ">
                            Privacy
                        </a>
                        
                        <a href="https://www.apache.org/foundation/thanks.html"
                            class="navbar-item ">
                            Thanks
                        </a>
                        
                    </div>
                </div>
                
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href="/zh/community"
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-user-plus"></i>
                        </span>
                        
                        <span>
                            开源社区
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="/zh/community/#contact-us"
                            class="navbar-item ">
                            联系我们
                        </a>
                        
                        <a href="/zh/community/#contribution"
                            class="navbar-item ">
                            参与贡献
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/PEGASUS/Coding+guides"
                            class="navbar-item ">
                            编码指引
                        </a>
                        
                        <a href="https://github.com/apache/incubator-pegasus/issues?q=is%3Aissue+is%3Aopen+label%3Atype%2Fbug"
                            class="navbar-item ">
                            Bug追踪
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/INCUBATOR/PegasusProposal"
                            class="navbar-item ">
                            Apache提案
                        </a>
                        
                    </div>
                </div>
                
                
                
                <a href="/zh/blogs"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-rss"></i>
                    </span>
                    
                    <span>Blog</span>
                </a>
                
                
                
                <a href="/zh/docs/downloads"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-fire"></i>
                    </span>
                    
                    <span>版本发布</span>
                </a>
                
                
            </div>
            <div class="navbar-item is-hidden-mobile">
                

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<!--If you don't want a url to be relativized, you can add a space explicitly into the href to 
    prevents a url from being relativized by polyglot.-->
<a class="button is-primary is-outlined is-inverted" href=" /overview/architecture"><strong>En</strong></a>

            </div>
        </div>
    </div>
</nav>

    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                <div class="column is-one-fourth">
                    
                    

<aside class="menu">
    
    <p class="menu-label"></p>
    <ul class="menu-list">
        
        <li>
            <a href="/zh/overview"
                class="">
                概览
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/background"
                class="">
                项目背景
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/architecture"
                class="is-active">
                系统架构
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/data-model"
                class="">
                数据模型
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/benchmark"
                class="">
                性能测试
            </a>
        </li>
        
        <li>
            <a href="/zh/docs/build/compile-by-docker"
                class="">
                安装构建
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/onebox"
                class="">
                体验Onebox集群
            </a>
        </li>
        
    </ul>
    
</aside>
                    
                </div>
                <div class="column is-half">
                    
                    

<div class="content">
    <h1 id="系统架构">系统架构</h1>
    <h2 id="整体架构">整体架构</h2>

<p>Pegasus系统的整体架构如下图所示，一共分为四个部分：</p>

<ul>
  <li><strong>ClientLib</strong>：负责屏蔽数据到存储服务器的映射规则，以及和存储服务器的通信细节，而提供一个简洁的Key-Value存储接口供用户使用</li>
  <li><strong>ReplicaServer</strong>：负责数据的存储和备份，接收客户端发来的数据存储请求</li>
  <li><strong>MetaServer</strong>：负责ReplicaServer的存活检测、Replica分配、负载均衡等，采用一主多备模式</li>
  <li><strong>Zookeeper</strong>：负责对MetaServer进行选主，以实现Master节点的高可用，并存储系统的各种元数据</li>
</ul>

<p><img src="/assets/images/pegasus-architecture-components.png" alt="pegasus-architecture-components" class="img-responsive" /></p>

<h2 id="replicaserver">ReplicaServer</h2>

<p>ReplicaServer主要负责数据存储和存取，以replica为单位进行服务：</p>

<ul>
  <li>服务的replica既可能是PrimaryReplica，也可能是SecondaryReplica</li>
  <li>底层使用RocksDB来存储数据</li>
  <li>管理commit log，并实现replication协议，提供数据一致性保证</li>
</ul>

<h2 id="metaserver">MetaServer</h2>

<p>MetaServer采用一主多备模式（one master, multiple backups），所有的状态都会持久化到Zookeeper上；同时通过Zookeeper进行选主。当master故障后，另一台backup立即抢到锁，然后从Zookeeper上恢复状态，成为新的master。MetaServer负责的功能包括：</p>

<ul>
  <li>系统初始化</li>
  <li>ReplicaServer的管理</li>
  <li>Replica的分配、管理和负载均衡调度</li>
  <li>Table的创建与删除</li>
  <li>响应Client请求，向Client提供最新的路由表</li>
</ul>

<h2 id="zookeeper">Zookeeper</h2>

<p>Zookeeper主要有两个功能：</p>

<ul>
  <li>系统元信息存储</li>
  <li>MetaServer选主</li>
</ul>

<h2 id="clientlib">ClientLib</h2>

<p>ClientLib对用户提供数据存储接口，特点：</p>

<ul>
  <li>接口简洁：对用户提供最简单的接口，将寻址和容错等细节封装在内部</li>
  <li>配置简单：用户只需通过配置文件指定MetaServer地址列表，就可以访问集群，类似于Zookeeper</li>
  <li>尽量直接与ReplicaServer进行交互，尽量少地访问MetaServer以避免热点问题，不依赖Zookeeper</li>
</ul>

</div>
                </div>
                <div class="column is-one-fourth is-hidden-mobile" style="padding-left: 3rem">
                    
                    <p class="menu-label">
    <span class="icon">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </span>
    本页导航
</p>
<ul class="menu-list">
  <li><a href="#系统架构">系统架构</a>
    <ul>
      <li><a href="#整体架构">整体架构</a></li>
      <li><a href="#replicaserver">ReplicaServer</a></li>
      <li><a href="#metaserver">MetaServer</a></li>
      <li><a href="#zookeeper">Zookeeper</a></li>
      <li><a href="#clientlib">ClientLib</a></li>
    </ul>
  </li>
</ul>

                    
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="content is-small has-text-centered">
            <div style="margin-bottom: 20px;">
                <a href="http://incubator.apache.org">
                    <img src="/assets/images/egg-logo.png"
                         width="15%"
                         alt="Apache Incubator"/>
                </a>
            </div>
            Copyright &copy; 2023 <a href="http://www.apache.org">The Apache Software Foundation</a>.
            Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
            2.0</a>.
            <br><br>
            
            Apache Pegasus is an effort undergoing incubation at The Apache Software Foundation (ASF),
            sponsored by the Apache Incubator. Incubation is required of all newly accepted projects
            until a further review indicates that the infrastructure, communications, and decision making process
            have stabilized in a manner consistent with other successful ASF projects. While incubation status is
            not necessarily a reflection of the completeness or stability of the code, it does indicate that the
            project has yet to be fully endorsed by the ASF.
            
            <br><br>
            Apache Pegasus, Pegasus, Apache, the Apache feather logo, and the Apache Pegasus project logo are either
            registered trademarks or trademarks of The Apache Software Foundation in the United States and other
            countries.
        </div>
    </div>
</footer>
    <script src="/assets/js/app.js" type="text/javascript"></script>
  </body>
</html>
