<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pegasus | Benchmark</title>
    <link rel="stylesheet" href="/zh/assets/css/app.css">
    <link rel="shortcut icon" href="/zh/assets/images/favicon.ico">
    <link rel="stylesheet" href="/zh/assets/css/utilities.min.css">
    <link rel="stylesheet" href="/zh/assets/css/docsearch.v3.css">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/all.min.js"></script>
    <script src="/assets/js/docsearch.v3.js"></script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Benchmark | Pegasus</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Benchmark" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="测试环境" />
<meta property="og:description" content="测试环境" />
<meta property="og:site_name" content="Pegasus" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-18T06:59:14+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Benchmark" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-12-18T06:59:14+00:00","datePublished":"2023-12-18T06:59:14+00:00","description":"测试环境","headline":"Benchmark","mainEntityOfPage":{"@type":"WebPage","@id":"/overview/benchmark/"},"url":"/overview/benchmark/"}</script>
<!-- End Jekyll SEO tag -->
</head>

  <body>
    



<nav class="navbar is-primary">
    <div class="container">
        <!--container will be unwrapped when it's in docs-->
        <div class="navbar-brand">
            <a href="/zh/" class="navbar-item ">
                <!-- Pegasus Icon -->
                <img src="/assets/images/pegasus.svg">
            </a>
            <div class="navbar-item">
                <a href="/zh/docs" class="button is-primary is-outlined is-inverted">
                    <span class="icon"><i class="fas fa-book"></i></span>
                    <span>Docs</span>
                </a>
            </div>
            <div class="navbar-item is-hidden-desktop">
                  

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<!--If you don't want a url to be relativized, you can add a space explicitly into the href to 
    prevents a url from being relativized by polyglot.-->
<a class="button is-primary is-outlined is-inverted" href=" /overview/benchmark/"><strong>En</strong></a>

            </div>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <!-- Appears in mobile mode only -->
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-end">
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href=""
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-users"></i>
                        </span>
                        
                        <span>
                            ASF
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="https://www.apache.org/"
                            class="navbar-item ">
                            Foundation
                        </a>
                        
                        <a href="https://www.apache.org/licenses/"
                            class="navbar-item ">
                            License
                        </a>
                        
                        <a href="https://www.apache.org/events/current-event.html"
                            class="navbar-item ">
                            Events
                        </a>
                        
                        <a href="https://www.apache.org/foundation/sponsorship.html"
                            class="navbar-item ">
                            Sponsorship
                        </a>
                        
                        <a href="https://www.apache.org/security/"
                            class="navbar-item ">
                            Security
                        </a>
                        
                        <a href="https://privacy.apache.org/policies/privacy-policy-public.html"
                            class="navbar-item ">
                            Privacy
                        </a>
                        
                        <a href="https://www.apache.org/foundation/thanks.html"
                            class="navbar-item ">
                            Thanks
                        </a>
                        
                    </div>
                </div>
                
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href="/zh/community"
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-user-plus"></i>
                        </span>
                        
                        <span>
                            开源社区
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="/zh/community/#contact-us"
                            class="navbar-item ">
                            联系我们
                        </a>
                        
                        <a href="/zh/community/#contribution"
                            class="navbar-item ">
                            参与贡献
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/PEGASUS/Coding+guides"
                            class="navbar-item ">
                            编码指引
                        </a>
                        
                        <a href="https://github.com/apache/incubator-pegasus/issues?q=is%3Aissue+is%3Aopen+label%3Atype%2Fbug"
                            class="navbar-item ">
                            Bug追踪
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/INCUBATOR/PegasusProposal"
                            class="navbar-item ">
                            Apache提案
                        </a>
                        
                    </div>
                </div>
                
                
                
                <a href="/zh/blogs"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-rss"></i>
                    </span>
                    
                    <span>Blog</span>
                </a>
                
                
                
                <a href="/zh/docs/downloads"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-fire"></i>
                    </span>
                    
                    <span>版本发布</span>
                </a>
                
                
            </div>
            <div class="navbar-item is-hidden-mobile">
                

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<!--If you don't want a url to be relativized, you can add a space explicitly into the href to 
    prevents a url from being relativized by polyglot.-->
<a class="button is-primary is-outlined is-inverted" href=" /overview/benchmark/"><strong>En</strong></a>

            </div>
        </div>
    </div>
</nav>

    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                <div class="column is-one-fourth">
                    
                    

<aside class="menu">
    
    <p class="menu-label"></p>
    <ul class="menu-list">
        
        <li>
            <a href="/zh/overview"
                class="">
                概览
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/background"
                class="">
                项目背景
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/architecture"
                class="">
                系统架构
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/data-model"
                class="">
                数据模型
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/benchmark"
                class="">
                性能测试
            </a>
        </li>
        
        <li>
            <a href="/zh/docs/build/compile-by-docker"
                class="">
                安装构建
            </a>
        </li>
        
        <li>
            <a href="/zh/overview/onebox"
                class="">
                体验Onebox集群
            </a>
        </li>
        
    </ul>
    
</aside>
                    
                </div>
                <div class="column is-half">
                    
                    

<div class="content">
    <h1 id="性能测试">性能测试</h1>
    <h2 id="测试环境">测试环境</h2>

<p><strong>机器配置：</strong></p>

<ul>
  <li>CPU：Intel(R) Xeon(R) CPU E5-2620 v3 @ 2.40GHz （24 cores）</li>
  <li>内存​：128GB</li>
  <li>存储：480G RAID0 SSD *8</li>
  <li>网卡：10Gb</li>
</ul>

<p><strong>集群配置：</strong></p>

<ul>
  <li>节点数：5个replica server节点</li>
  <li>测试表的Partition数：64个</li>
</ul>

<p><strong>测试工具：</strong></p>

<ul>
  <li><a href="https://github.com/xiaomi/pegasus-ycsb">YCSB</a> (使用Pegasus Java Client)</li>
  <li>读写请求的数据分布特征：zipfian，可以理解为遵守80/20原则的数据分布，即80%的访问都集中在20%的内容上。</li>
</ul>

<p><strong>备注：</strong></p>

<ul>
  <li>运行时长单位：小时。</li>
  <li>QPS单位：条/秒。</li>
  <li>延迟单位：微秒。</li>
</ul>

<h2 id="测试结果">测试结果</h2>

<h3 id="1123">1.12.3</h3>

<ul>
  <li>延迟单位: 微秒</li>
  <li>pegasu-client: 1.11.10-thrift-0.11.0-inlined-release</li>
  <li>客户端节点数: 3</li>
</ul>

<h4 id="单条数据大小320b">单条数据大小：320B</h4>

<table>
  <thead>
    <tr>
      <th>测试case</th>
      <th>RW Ratio</th>
      <th>R-QPS</th>
      <th>R-AVG-Lat</th>
      <th>R-P99-Lat</th>
      <th>W-QPS</th>
      <th>W-AVG-Lat</th>
      <th>W-P99-Lat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>0:1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>41068</td>
      <td>728</td>
      <td>3439</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>1:3</td>
      <td>16011</td>
      <td>242</td>
      <td>686</td>
      <td>48036</td>
      <td>851</td>
      <td>4027</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*30线程</td>
      <td>30:1</td>
      <td>279818</td>
      <td>295</td>
      <td>873</td>
      <td>9326</td>
      <td>720</td>
      <td>3355</td>
    </tr>
  </tbody>
</table>

<h4 id="单条数据大小1kb">单条数据大小：1KB</h4>

<table>
  <thead>
    <tr>
      <th>测试case</th>
      <th>RW Ratio</th>
      <th>R-QPS</th>
      <th>R-AVG-Lat</th>
      <th>R-P99-Lat</th>
      <th>W-QPS</th>
      <th>W-AVG-Lat</th>
      <th>W-P99-Lat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>0:1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>40732</td>
      <td>1102</td>
      <td>4216</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>1:3</td>
      <td>14355</td>
      <td>476</td>
      <td>2855</td>
      <td>38547</td>
      <td>1016</td>
      <td>4135</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*20线程</td>
      <td>3:1</td>
      <td>87480</td>
      <td>368</td>
      <td>4170</td>
      <td>29159</td>
      <td>940</td>
      <td>4170</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*50线程</td>
      <td>1:0</td>
      <td>312244</td>
      <td>479</td>
      <td>1178</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="1122">1.12.2</h3>

<ul>
  <li>延迟单位: 微秒</li>
  <li>pegasu-client: 1.11.10-thrift-0.11.0-inlined-release</li>
  <li>客户端节点数: 3</li>
  <li>单条数据大小：320B</li>
</ul>

<table>
  <thead>
    <tr>
      <th>测试case</th>
      <th>RW Ratio</th>
      <th>R-QPS</th>
      <th>R-AVG-Lat</th>
      <th>R-P99-Lat</th>
      <th>W-QPS</th>
      <th>W-AVG-Lat</th>
      <th>W-P99-Lat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>0:1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>40439</td>
      <td>739</td>
      <td>2995</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*15线程</td>
      <td>1:3</td>
      <td>16022</td>
      <td>309</td>
      <td>759</td>
      <td>48078</td>
      <td>830</td>
      <td>3995</td>
    </tr>
    <tr>
      <td>读写同时: 3客户端*30线程</td>
      <td>30:1</td>
      <td>244392</td>
      <td>346</td>
      <td>652</td>
      <td>8137</td>
      <td>731</td>
      <td>2995</td>
    </tr>
  </tbody>
</table>

<h3 id="1116multi_getbatch_set">1.11.6(multi_get/batch_set)</h3>

<p>特别注意：测试环境和参数以此为准</p>

<ul>
  <li>测试case：读使用multi_get，写使用batch_set，1QPS的batch_set等于3QPS的set操作</li>
  <li>数据大小：单条数据3KB，sort_key数量为3</li>
  <li>测试表的Partition数：128个</li>
  <li>rocksdb_block_cache_capacity = 40G</li>
  <li>pegasu-client = 1.11.7-thrift-0.11.0-inlined-release</li>
</ul>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>Max缓存命中率</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>读P999延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
      <th>写P999延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3客户端*15线程</td>
      <td>​20:1</td>
      <td>1h</td>
      <td>10%</td>
      <td>150K</td>
      <td>263</td>
      <td>808</td>
      <td>12615</td>
      <td>8k</td>
      <td>1474</td>
      <td>7071</td>
      <td>26342</td>
    </tr>
    <tr>
      <td>​3客户端*7线程</td>
      <td>​20:1</td>
      <td>2h</td>
      <td>17%</td>
      <td>75K</td>
      <td>226</td>
      <td>641</td>
      <td>5331</td>
      <td>4K</td>
      <td>1017</td>
      <td>4583</td>
      <td>14983</td>
    </tr>
  </tbody>
</table>

<h3 id="1111">1.11.1</h3>

<h4 id="单条数据大小20kb">单条数据大小：20KB</h4>

<p>测试时间：2018/11/9</p>

<h5 id="2备份">2备份</h5>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(1)数据加载: 3客户端*10线程</td>
      <td>0:1</td>
      <td>0.98</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>8439</td>
      <td>3557</td>
      <td>32223</td>
    </tr>
    <tr>
      <td>(2)​读写同时: 3客户端*15线程</td>
      <td>​1:3</td>
      <td>0.66</td>
      <td>3159</td>
      <td>4428</td>
      <td>34495</td>
      <td>9472</td>
      <td>3251</td>
      <td>25071</td>
    </tr>
    <tr>
      <td>​(3)读写同时: 3客户端*30线程</td>
      <td>​30:1</td>
      <td>1.25</td>
      <td>64358</td>
      <td>1330</td>
      <td>13975</td>
      <td>2145</td>
      <td>1699</td>
      <td>6467</td>
    </tr>
    <tr>
      <td>(4)数据只读: 6客户端*100线程</td>
      <td>1:0​</td>
      <td>​0.91</td>
      <td>30491</td>
      <td>3274</td>
      <td>12167</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<h5 id="3备份">3备份</h5>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(1)数据加载: 3客户端*10线程</td>
      <td>0:1</td>
      <td>1.40</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>5919</td>
      <td>5063</td>
      <td>40639</td>
    </tr>
    <tr>
      <td>(2)​读写同时: 3客户端*15线程</td>
      <td>​1:3</td>
      <td>1.11</td>
      <td>1876</td>
      <td>6927</td>
      <td>44639</td>
      <td>5632</td>
      <td>5612</td>
      <td>76095</td>
    </tr>
    <tr>
      <td>​(3)读写同时: 3客户端*30线程</td>
      <td>​30:1</td>
      <td>1.63</td>
      <td>49341</td>
      <td>1751</td>
      <td>21615</td>
      <td>1644</td>
      <td>1935</td>
      <td>11159</td>
    </tr>
    <tr>
      <td>(4)数据只读: 6客户端*100线程</td>
      <td>1:0​</td>
      <td>​0.91</td>
      <td>25456</td>
      <td>3923</td>
      <td>15679</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<h4 id="单条数据大小10kb">单条数据大小：10KB</h4>

<p>测试时间：2018/11/5</p>

<h5 id="2备份-1">2备份</h5>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(1)数据加载: 3客户端*10线程</td>
      <td>0:1</td>
      <td>0.78</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>14181</td>
      <td>2110</td>
      <td>15468</td>
    </tr>
    <tr>
      <td>(2)​读写同时: 3客户端*15线程</td>
      <td>​1:3</td>
      <td>0.52</td>
      <td>4024</td>
      <td>5209</td>
      <td>41247</td>
      <td>12069</td>
      <td>1780</td>
      <td>14495</td>
    </tr>
    <tr>
      <td>​(3)读写同时: 3客户端*30线程</td>
      <td>​30:1</td>
      <td>0.76</td>
      <td>105841</td>
      <td>816</td>
      <td>9613</td>
      <td>3527</td>
      <td>1107</td>
      <td>4155</td>
    </tr>
    <tr>
      <td>(4)数据只读: 6客户端*100线程</td>
      <td>1:0​</td>
      <td>​​1.04</td>
      <td>162150</td>
      <td>1868</td>
      <td>6733</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<h5 id="3备份-1">3备份</h5>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(1)数据加载: 3客户端*10线程</td>
      <td>0:1</td>
      <td>1.16</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>9603</td>
      <td>3115</td>
      <td>20468</td>
    </tr>
    <tr>
      <td>(2)​读写同时: 3客户端*15线程</td>
      <td>​1:3</td>
      <td>0.69</td>
      <td>3043</td>
      <td>5657</td>
      <td>38783</td>
      <td>9126</td>
      <td>3140</td>
      <td>27956</td>
    </tr>
    <tr>
      <td>​(3)读写同时: 3客户端*30线程</td>
      <td>​30:1</td>
      <td>0.89</td>
      <td>90135</td>
      <td>937</td>
      <td>13324</td>
      <td>3002</td>
      <td>1185</td>
      <td>4816</td>
    </tr>
    <tr>
      <td>(4)数据只读: 6客户端*100线程</td>
      <td>1:0​</td>
      <td>1.08</td>
      <td>154869</td>
      <td>1945</td>
      <td>7757</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<p><strong>RocsDB配置：</strong></p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="py">rocksdb_abnormal_get_time_threshold_ns</span> <span class="p">=</span> <span class="s">10000000</span>
    <span class="py">rocksdb_abnormal_get_size_threshold</span> <span class="p">=</span> <span class="s">1000000</span>
    <span class="py">rocksdb_abnormal_multi_get_time_threshold_ns</span> <span class="p">=</span> <span class="s">100000000</span>
    <span class="py">rocksdb_abnormal_multi_get_size_threshold</span> <span class="p">=</span> <span class="s">10000000</span>
    <span class="py">rocksdb_abnormal_multi_get_iterate_count_threshold</span> <span class="p">=</span> <span class="s">1000</span>

    <span class="py">rocksdb_write_buffer_size</span> <span class="p">=</span> <span class="s">67108864</span>
    <span class="py">rocksdb_max_write_buffer_number</span> <span class="p">=</span> <span class="s">6</span>
    <span class="py">rocksdb_max_background_flushes</span> <span class="p">=</span> <span class="s">4</span>
    <span class="py">rocksdb_max_background_compactions</span> <span class="p">=</span> <span class="s">12</span>
    <span class="py">rocksdb_num_levels</span> <span class="p">=</span> <span class="s">6</span>
    <span class="py">rocksdb_target_file_size_base</span> <span class="p">=</span> <span class="s">67108864</span>
    <span class="py">rocksdb_target_file_size_multiplier</span> <span class="p">=</span> <span class="s">1</span>
    <span class="py">rocksdb_max_bytes_for_level_base</span> <span class="p">=</span> <span class="s">671088640</span>
    <span class="py">rocksdb_max_bytes_for_level_multiplier</span> <span class="p">=</span> <span class="s">10</span>
    <span class="py">rocksdb_level0_file_num_compaction_trigger</span> <span class="p">=</span> <span class="s">4</span>
    <span class="py">rocksdb_level0_slowdown_writes_trigger</span> <span class="p">=</span> <span class="s">30</span>
    <span class="py">rocksdb_level0_stop_writes_trigger</span> <span class="p">=</span> <span class="s">60</span>
    <span class="py">rocksdb_disable_table_block_cache</span> <span class="p">=</span> <span class="s">false</span>
    <span class="py">rocksdb_compression_type</span> <span class="p">=</span> <span class="s">snappy none</span>
</code></pre></div></div>

<h3 id="1110">1.11.0</h3>

<ul>
  <li>单条数据大小：320字节</li>
  <li>测试时间：2018/07/27</li>
</ul>

<table>
  <thead>
    <tr>
      <th>测试Case</th>
      <th>读写比</th>
      <th>运行时长</th>
      <th>读QPS</th>
      <th>读Avg延迟</th>
      <th>读P99延迟</th>
      <th>写QPS</th>
      <th>写Avg延迟</th>
      <th>写P99延迟</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>(1)数据加载: 3客户端*10线程</td>
      <td>0:1</td>
      <td>1.89</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>44039</td>
      <td>679</td>
      <td>3346</td>
    </tr>
    <tr>
      <td>(2)​读写同时: 3客户端*15线程</td>
      <td>​1:3</td>
      <td>1.24</td>
      <td>16690</td>
      <td>311</td>
      <td>892</td>
      <td>50076</td>
      <td>791</td>
      <td>4396</td>
    </tr>
    <tr>
      <td>​(3)读写同时: 3客户端*30线程</td>
      <td>​30:1</td>
      <td>1.04</td>
      <td>311633</td>
      <td>264</td>
      <td>511</td>
      <td>10388</td>
      <td>619</td>
      <td>2468</td>
    </tr>
    <tr>
      <td>(4)数据只读: 6客户端*100线程</td>
      <td>1:0​</td>
      <td>​0.17</td>
      <td>​978884</td>
      <td>623</td>
      <td>​1671</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>(5)数据只读: 12客户端*100线程</td>
      <td>1:0​</td>
      <td>​0.28</td>
      <td>​1194394</td>
      <td>1003</td>
      <td>​2933</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>

<h2 id="不同参数下的性能">不同参数下的性能</h2>

<p>如无特殊说明：</p>

<ul>
  <li>延迟单位：微妙</li>
  <li>单条数据大小：1KB</li>
  <li>客户端节点数：3，版本号：1.11.10-thrift-0.11.0-inlined-release</li>
  <li>服务端节点数：5，版本号：1.12.3，表分片数：64，开启rocksdb限速：max_rate=500MB, auto_tune=true</li>
</ul>

<h3 id="客户端线程数">客户端线程数</h3>

<p>该项测试旨在观察在默认配置下（注意：未开启RocksDB限速），不同线程（仅读和仅写）对QPS和延迟的影响。</p>

<p><img src="/assets/images/benchmark/5-node-write.png" alt="5-node-write" /></p>

<p><img src="/assets/images/benchmark/5-node-read.png" alt="5-node-read" /></p>

<p>由上图可以看到，在该测试场景下，写最大QPS≈43K，读最大QPS≈370K，你也可以根据QPS的大小合理估算对应的延迟。</p>

<h3 id="rocksdb限速">RocksDB限速</h3>

<p>Pegasus底层采用RocksDB做存储引擎，当数据写入增多，会触发compaction操作，占用较多磁盘IO，出现较多的毛刺现象。该项测试展示了开启<a href="http://10.232.52.164:4000/overview/benchmark">RocksDB的限速</a>后，可以降低compaction负载，从而显著的降低毛刺现象。</p>

<p>下图分别展示了无限速、500MB限速、500MB限速同时开启auto-tune功能，三种场景的IO使用率和写P99延迟(注意：测试场景为：3client*20thread，QPS≈44K)：</p>

<p>磁盘IO占用：
<img src="/assets/images/benchmark/io-no-limit.png" alt="io-no-limit" />
<img src="/assets/images/benchmark/io-limit-500MB.png" alt="io-limit-500MB" />
<img src="/assets/images/benchmark/io-limit-500MB-auto.png" alt="io-limit-500MB-auto" /></p>

<p>P99延迟：
<img src="/assets/images/benchmark/no-limit-set.png" alt="no-limit-set" />
<img src="/assets/images/benchmark/500-limit-set.png" alt="500-limit-set" />
<img src="/assets/images/benchmark/500-limit-auto-set.png" alt="500-limit-auto-set" /></p>

<p>可以发现，磁盘IO使用率被降低，相应的写延迟的毛刺现象也被大大缓解。</p>

<p>我们从YCSB的测试结果：
<img src="/assets/images/benchmark/limit.png" alt="limit" />
也可以看到：</p>

<ul>
  <li>开启限速、开启限速并开启auto-tune后，QPS吞吐分别约提升了5%，20%</li>
  <li>开启限速后，仅对极端情况下的延迟(P999/P9999)有显著改善作用，对于大部分请求来说，改善并不明显</li>
</ul>

<p>但是<strong>需要注意</strong>的是：</p>

<p>auto-tune功能在单条数据较大的场景下可能会引发<a href="https://github.com/facebook/rocksdb/wiki/Write-Stalls">write stall</a>（在我们的测试中，当单条value=10KB，QPS=10K时，发生write stall，关闭Auto-Tune后不会产生write stall），所以请合理评估是否开启auto-tune</p>

<h3 id="服务端机器数">服务端机器数</h3>
<p>该项测试旨在观察，不同机器数量对读写性能(只读和只写场景)的影响。
<img src="/assets/images/benchmark/node-qps-write.png" alt="node-write" /></p>

<p><img src="/assets/images/benchmark/node-qps-read.png" alt="node-read" /></p>

<p>由图中可以看到</p>

<ul>
  <li>扩容对写性能的提升要优于读性能的提升</li>
  <li>扩容带来的性能提升并不是线性增加的</li>
</ul>

<p>你可以根据该项测试合理估计不同机器下所能承载的请求负载</p>

<h3 id="表分片数">表分片数</h3>

<p>该项测试旨在观察，表的不同分片对性能的影响。测试场景为：</p>

<p>仅读：3client*50thread</p>

<p>仅写：3client*40thread</p>

<p><img src="/assets/images/benchmark/partition.png" alt="partition" /></p>

<p>由图中可以看到，增加分片可以提高读性能，但是降低了写性能，所以请合理评估你的业务需求。除此之外，若分片数过小，可能会导致单分片过大，磁盘分布不均的问题，在实际的线上业务中，如无特别需求，我们建议单分片维持在10GB以内是合理的</p>

</div>
                </div>
                <div class="column is-one-fourth is-hidden-mobile" style="padding-left: 3rem">
                    
                    <p class="menu-label">
    <span class="icon">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </span>
    本页导航
</p>
<ul class="menu-list">
  <li><a href="#性能测试">性能测试</a>
    <ul>
      <li><a href="#测试环境">测试环境</a></li>
      <li><a href="#测试结果">测试结果</a>
        <ul>
          <li><a href="#1123">1.12.3</a>
            <ul>
              <li><a href="#单条数据大小320b">单条数据大小：320B</a></li>
              <li><a href="#单条数据大小1kb">单条数据大小：1KB</a></li>
            </ul>
          </li>
          <li><a href="#1122">1.12.2</a></li>
          <li><a href="#1116multi_getbatch_set">1.11.6(multi_get/batch_set)</a></li>
          <li><a href="#1111">1.11.1</a>
            <ul>
              <li><a href="#单条数据大小20kb">单条数据大小：20KB</a>
                <ul>
                  <li><a href="#2备份">2备份</a></li>
                  <li><a href="#3备份">3备份</a></li>
                </ul>
              </li>
              <li><a href="#单条数据大小10kb">单条数据大小：10KB</a>
                <ul>
                  <li><a href="#2备份-1">2备份</a></li>
                  <li><a href="#3备份-1">3备份</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#1110">1.11.0</a></li>
        </ul>
      </li>
      <li><a href="#不同参数下的性能">不同参数下的性能</a>
        <ul>
          <li><a href="#客户端线程数">客户端线程数</a></li>
          <li><a href="#rocksdb限速">RocksDB限速</a></li>
          <li><a href="#服务端机器数">服务端机器数</a></li>
          <li><a href="#表分片数">表分片数</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

                    
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="content is-small has-text-centered">
            <div style="margin-bottom: 20px;">
                <a href="http://incubator.apache.org">
                    <img src="/assets/images/egg-logo.png"
                         width="15%"
                         alt="Apache Incubator"/>
                </a>
            </div>
            Copyright &copy; 2023 <a href="http://www.apache.org">The Apache Software Foundation</a>.
            Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
            2.0</a>.
            <br><br>
            
            Apache Pegasus is an effort undergoing incubation at The Apache Software Foundation (ASF),
            sponsored by the Apache Incubator. Incubation is required of all newly accepted projects
            until a further review indicates that the infrastructure, communications, and decision making process
            have stabilized in a manner consistent with other successful ASF projects. While incubation status is
            not necessarily a reflection of the completeness or stability of the code, it does indicate that the
            project has yet to be fully endorsed by the ASF.
            
            <br><br>
            Apache Pegasus, Pegasus, Apache, the Apache feather logo, and the Apache Pegasus project logo are either
            registered trademarks or trademarks of The Apache Software Foundation in the United States and other
            countries.
        </div>
    </div>
</footer>
    <script src="/assets/js/app.js" type="text/javascript"></script>
  </body>
</html>
