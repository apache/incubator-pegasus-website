<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pegasus | Background</title>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" href="/assets/css/utilities.min.css">
    <link rel="stylesheet" href="/assets/css/docsearch.v3.css">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/all.min.js"></script>
    <script src="/assets/js/docsearch.v3.js"></script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Background | Pegasus</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Background" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Design Goals" />
<meta property="og:description" content="Design Goals" />
<meta property="og:site_name" content="Pegasus" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-10T11:55:24+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Background" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-10T11:55:24+00:00","datePublished":"2024-01-10T11:55:24+00:00","description":"Design Goals","headline":"Background","mainEntityOfPage":{"@type":"WebPage","@id":"/overview/background/"},"url":"/overview/background/"}</script>
<!-- End Jekyll SEO tag -->
</head>

  <body>
    



<nav class="navbar is-primary">
    <div class="container">
        <!--container will be unwrapped when it's in docs-->
        <div class="navbar-brand">
            <a href="/" class="navbar-item ">
                <!-- Pegasus Icon -->
                <img src="/assets/images/pegasus.svg">
            </a>
            <div class="navbar-item">
                <a href="/docs" class="button is-primary is-outlined is-inverted">
                    <span class="icon"><i class="fas fa-book"></i></span>
                    <span>Docs</span>
                </a>
            </div>
            <div class="navbar-item is-hidden-desktop">
                  

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-primary is-outlined is-inverted" href="/zh/overview/background/"><strong>中</strong></a>

            </div>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                <!-- Appears in mobile mode only -->
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-end">
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href=""
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-users"></i>
                        </span>
                        
                        <span>
                            ASF
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="https://www.apache.org/"
                            class="navbar-item ">
                            Foundation
                        </a>
                        
                        <a href="https://www.apache.org/licenses/"
                            class="navbar-item ">
                            License
                        </a>
                        
                        <a href="https://www.apache.org/events/current-event.html"
                            class="navbar-item ">
                            Events
                        </a>
                        
                        <a href="https://www.apache.org/foundation/sponsorship.html"
                            class="navbar-item ">
                            Sponsorship
                        </a>
                        
                        <a href="https://www.apache.org/security/"
                            class="navbar-item ">
                            Security
                        </a>
                        
                        <a href="https://privacy.apache.org/policies/privacy-policy-public.html"
                            class="navbar-item ">
                            Privacy
                        </a>
                        
                        <a href="https://www.apache.org/foundation/thanks.html"
                            class="navbar-item ">
                            Thanks
                        </a>
                        
                    </div>
                </div>
                
                
                 <!--dropdown-->
                <div class="navbar-item has-dropdown is-hoverable ">
                    <a href="/community"
                        class="navbar-link ">
                        
                        <span class="icon" style="margin-right: .25em">
                            <i class="fas fa-user-plus"></i>
                        </span>
                        
                        <span>
                            Community
                        </span>
                    </a>
                    <div class="navbar-dropdown">
                        
                        <a href="/community/#contact-us"
                            class="navbar-item ">
                            Contact Us
                        </a>
                        
                        <a href="/community/#contribution"
                            class="navbar-item ">
                            Contribution
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/PEGASUS/Coding+guides"
                            class="navbar-item ">
                            Coding Guides
                        </a>
                        
                        <a href="https://github.com/apache/incubator-pegasus/issues?q=is%3Aissue+is%3Aopen+label%3Atype%2Fbug"
                            class="navbar-item ">
                            Bug Tracking
                        </a>
                        
                        <a href="https://cwiki.apache.org/confluence/display/INCUBATOR/PegasusProposal"
                            class="navbar-item ">
                            Apache Proposal
                        </a>
                        
                    </div>
                </div>
                
                
                
                <a href="/blogs"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-rss"></i>
                    </span>
                    
                    <span>Blog</span>
                </a>
                
                
                
                <a href="/docs/downloads"
                    class="navbar-item ">
                    
                    <span class="icon" style="margin-right: .25em">
                        <i class="fas fa-fire"></i>
                    </span>
                    
                    <span>Releases</span>
                </a>
                
                
            </div>
            <div class="navbar-item is-hidden-mobile">
                

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-primary is-outlined is-inverted" href="/zh/overview/background/"><strong>中</strong></a>

            </div>
        </div>
    </div>
</nav>

    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                <div class="column is-one-fourth">
                    
                    

<aside class="menu">
    
    <p class="menu-label"></p>
    <ul class="menu-list">
        
        <li>
            <a href="/overview"
                class="">
                Overview
            </a>
        </li>
        
        <li>
            <a href="/overview/background"
                class="">
                Background
            </a>
        </li>
        
        <li>
            <a href="/overview/architecture"
                class="">
                Architecture
            </a>
        </li>
        
        <li>
            <a href="/overview/data-model"
                class="">
                Data Model
            </a>
        </li>
        
        <li>
            <a href="/overview/benchmark"
                class="">
                Benchmark
            </a>
        </li>
        
        <li>
            <a href="/docs/build/compile-by-docker"
                class="">
                Installation
            </a>
        </li>
        
        <li>
            <a href="/overview/onebox"
                class="">
                Onebox
            </a>
        </li>
        
    </ul>
    
</aside>
                    
                </div>
                <div class="column is-half">
                    
                    

<div class="content">
    <h1 id="Background">Background</h1>
    <h1 id="design-goals">Design Goals</h1>

<ul>
  <li>High availability: The system must be highly available. Even if some servers go down, the Pegasus cluster can recover services in an extremely short time (in several seconds), minimizing the impact on the Pegasus users and requiring service reliability to reach 99.99% or higher.</li>
  <li>High performance: The system must provide high-performance read and write services, with P99 latency required in milliseconds.</li>
  <li>Strong consistency: The system provides users with strong consistency semantics, making it easier for the Pegasus users to develop applications.</li>
  <li>Scalable: The system must easily scale in and scale out to cope with changes in application throughput loads.</li>
  <li>Easy to use: The system provides Pegasus users with simple and easy-to-use client libraries and interfaces, making it convenient for users to use.</li>
</ul>

<h1 id="implementation">Implementation</h1>

<p>When designing Pegasus, we make some trade-offs in terms of design goals, implementation difficulty, and development efficiency. Overall, including these aspects:</p>
<ul>
  <li>Development language: Based on performance considerations, we have chosen C++.</li>
  <li>Data model: Using a simple Key-Value data model. This not only simplifies development, but also meets most application development needs. Furthermore, we split the Key into two levels: HashKey and SortKey, enhancing its expressive power.</li>
  <li>Data distribution: Using a fixed hash distribution. Compared to Range distribution and Consistent Hash distribution, Fixed Hash distribution is simpler to implement, and data skewing and scalability can be solved through measures such as reasonable design of hash keys and preset more data shards. We also support <a href="https://pegasus.apache.org/en/administration/partition-split">Partition Split</a> Function to expand the number of shards.</li>
  <li>Storage medium: It is recommended to choose SSD (Solid State Drive). The performance and cost of SSDs are between memory and HDD (Hard Disk Drive), and considering both application requirements and costs, choosing SSDs is a more appropriate option.</li>
  <li>Local storage engine: Select <a href="https://github.com/facebook/rocksdb">RocksDB</a>. RocksDB has made many optimizations on the basis of LevelDB, which can fully utilize the IOPS performance on SSDs and the performance on multi-core servers.</li>
  <li>Consistency Protocol: Select <a href="https://www.microsoft.com/en-us/research/publication/pacifica-replication-in-log-based-distributed-storage-systems/">PacificA</a>. Compared to <a href="https://raft.github.io/">Raft</a>, the PacificA protocol has its own characteristics and advantages.</li>
  <li>Fault detection: Unlike the HBase, Pegasus does not use Zookeeper for fault detection, but implements a lease-based fault detection mechanism between MetaServer and ReplicaServer.</li>
</ul>

<h1 id="compare-to-apache-hbase">Compare to Apache HBase</h1>

<p>The original purpose of the Pegasus system was to compensate for the shortcomings of HBase. Here, we compare the differences between the two from the user’s perspective:</p>
<ul>
  <li>Data model: HBase is a tabular model that uses Range sharding, while Pegasus is a Key Value model that uses Hash sharding.</li>
  <li>Interface: Although HBase’s API interface features are rich, its usage is also more complex. The interfaces of Pegasus are simple to understand and use.</li>
  <li>Reliability: Due to architecture and implementation reasons (such as the use of local storage, fault detection, and implementation in C++ language), the reliability of Pegasus is usually better than that of HBase.</li>
  <li>Performance: Due to the layered architecture, the read and write performance of HBase is not very good, P99 latency is usually in the tens or even hundreds of milliseconds, and GC issues can bring glitches. Pegasus’s P99 latency can meet sensitive online application requirements in just a few milliseconds.</li>
</ul>

<h1 id="compare-to-redis">Compare to Redis</h1>

<p>If only compare on read/write latency and single-machine throughput, Redis is clearly superior to Pegasus. But if compared comprehensively in terms of read/write latency, availability, scalability, cost, etc., Pegasus also has its own advantages.</p>

<p>The main differences compared to Redis are as follows:</p>
<ul>
  <li>Data model: Both are Key Value models, but Pegasus supports secondary keys (HashKey + SortKey).</li>
  <li>Interface: Redis has richer interfaces and supports container features such as List, Set, Map, etc. The interfaces of Pegasus are simple to understand and use, and its functions are more singular.</li>
  <li>Read/write latency: Redis performs better than Pegasus.</li>
  <li>Scalability: Pegasus has better scalability, making it easier to scale in and scale out, and supporting automatic load balancing. Redis’s distributed solution can be quite cumbersome when adding or removing instances.</li>
  <li>Reliability: Pegasus is always persistent application data to disk, and the system architecture ensures its high data integrity. Redis takes a long time to recover after an instance crash, its availability is not good enough, and it may also lose the last period of data.</li>
  <li>Cost: Pegasus uses SSD to store full data, while Redis requires memory to store full data, resulting in lower cost for Pegasus.</li>
</ul>

<h1 id="comprehensive-comparison">Comprehensive comparison</h1>

<p>When selecting Key-Value storage systems, application developers often encounter these issues:</p>
<ul>
  <li>Although HBase has high availability and is easy to scale, its performance is not good enough.</li>
  <li>Although Redis has good performance, it requires a large amount of memory, resulting in higher hardware costs. If the data volume is too large, use <a href="https://redis.io/topics/cluster-tutorial">Redis Cluster</a>, the availability of the solution is insufficient in the event of machine failure.</li>
  <li>The HBase+Redis solution uses HBase for underlying storage and Redis for upper level caching. The disadvantage of this solution is that it involves two systems, and the user’s read and write logic will be relatively complex. Writing two systems simultaneously can lead to consistency issues. A piece of data needs to be stored in both HBase and Redis simultaneously, which is relatively costly. After the Redis machine crashed, it caused partial cache loss, and at this time, the performance of reading from HBase decreased significantly.</li>
</ul>

<p>Pegasus combines the advantages of HBase and Redis, ensuring high reliability, good scalability, and excellent performance.</p>

</div>
                </div>
                <div class="column is-one-fourth is-hidden-mobile" style="padding-left: 3rem">
                    
                    <p class="menu-label">
    <span class="icon">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </span>
    Table of contents
</p>
<ul class="menu-list">
  <li><a href="#Background">Background</a></li>
  <li><a href="#design-goals">Design Goals</a></li>
  <li><a href="#implementation">Implementation</a></li>
  <li><a href="#compare-to-apache-hbase">Compare to Apache HBase</a></li>
  <li><a href="#compare-to-redis">Compare to Redis</a></li>
  <li><a href="#comprehensive-comparison">Comprehensive comparison</a></li>
</ul>

                    
                </div>
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="content is-small has-text-centered">
            <div style="margin-bottom: 20px;">
                <a href="http://incubator.apache.org">
                    <img src="/assets/images/egg-logo.png"
                         width="15%"
                         alt="Apache Incubator"/>
                </a>
            </div>
            Copyright &copy; 2023 <a href="http://www.apache.org">The Apache Software Foundation</a>.
            Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
            2.0</a>.
            <br><br>
            
            Apache Pegasus is an effort undergoing incubation at The Apache Software Foundation (ASF),
            sponsored by the Apache Incubator. Incubation is required of all newly accepted projects
            until a further review indicates that the infrastructure, communications, and decision making process
            have stabilized in a manner consistent with other successful ASF projects. While incubation status is
            not necessarily a reflection of the completeness or stability of the code, it does indicate that the
            project has yet to be fully endorsed by the ASF.
            
            <br><br>
            Apache Pegasus, Pegasus, Apache, the Apache feather logo, and the Apache Pegasus project logo are either
            registered trademarks or trademarks of The Apache Software Foundation in the United States and other
            countries.
        </div>
    </div>
</footer>
    <script src="/assets/js/app.js" type="text/javascript"></script>
  </body>
</html>
