<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pegasus | Rebalance</title>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="stylesheet" href="/assets/css/utilities.min.css">
    <link rel="stylesheet" href="/assets/css/docsearch.v3.css">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/all.min.js"></script>
    <script src="/assets/js/docsearch.v3.js"></script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Rebalance | Pegasus</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Rebalance" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This document mainly introduces the concepts, usage, and design of rebalance in Pegasus." />
<meta property="og:description" content="This document mainly introduces the concepts, usage, and design of rebalance in Pegasus." />
<meta property="og:site_name" content="Pegasus" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-17T04:25:03+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Rebalance" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-17T04:25:03+00:00","datePublished":"2025-04-17T04:25:03+00:00","description":"This document mainly introduces the concepts, usage, and design of rebalance in Pegasus.","headline":"Rebalance","mainEntityOfPage":{"@type":"WebPage","@id":"/administration/rebalance"},"url":"/administration/rebalance"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
    <div class="dashboard is-full-height">
        <!-- left panel -->
        <div class="dashboard-panel is-medium is-hidden-mobile pl-0">
            <div class="dashboard-panel-header has-text-centered">
                <a href="/">
                    <img src="/assets/images/pegasus-logo-inv.png" style="width: 80%;">
                </a>
                
            </div>
            <div class="dashboard-panel-main is-scrollable pl-6">
                

<aside class="menu">
    
    <p class="menu-label">The Pegasus documentation</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/downloads"
                class="">
                Downloads
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Building Pegasus</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/build/compile-by-docker"
                class="">
                Compile by docker (recommended)
            </a>
        </li>
        
        <li>
            <a href="/docs/build/compile-from-source"
                class="">
                Compile from source
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Client Libs</p>
    <ul class="menu-list">
        
        <li>
            <a href="/clients/java-client"
                class="">
                Java Client
            </a>
        </li>
        
        <li>
            <a href="/clients/cpp-client"
                class="">
                C++ Client
            </a>
        </li>
        
        <li>
            <a href="https://github.com/apache/incubator-pegasus/tree/master/go-client"
                class="">
                Golang Client
            </a>
        </li>
        
        <li>
            <a href="/clients/python-client"
                class="">
                Python Client
            </a>
        </li>
        
        <li>
            <a href="/clients/node-client"
                class="">
                NodeJS Client
            </a>
        </li>
        
        <li>
            <a href="/clients/scala-client"
                class="">
                Scala Client
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Tools</p>
    <ul class="menu-list">
        
        <li>
            <a href="/docs/tools/shell"
                class="">
                Pegasus Shell
            </a>
        </li>
        
        <li>
            <a href="https://github.com/pegasus-kv/admin-cli"
                class="">
                Admin CLI
            </a>
        </li>
        
        <li>
            <a href="https://github.com/pegasus-kv/pegic"
                class="">
                Pegasus data access CLI
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">API</p>
    <ul class="menu-list">
        
        <li>
            <a href="/api/ttl"
                class="">
                TTL(Time To Live)
            </a>
        </li>
        
        <li>
            <a href="/api/single-atomic"
                class="">
                Single-Atomic Operations
            </a>
        </li>
        
        <li>
            <a href="/api/redis"
                class="">
                Redis Adaption
            </a>
        </li>
        
        <li>
            <a href="/api/geo"
                class="">
                GEO Support
            </a>
        </li>
        
        <li>
            <a href="/api/http"
                class="">
                HTTP API
            </a>
        </li>
        
    </ul>
    
    <p class="menu-label">Admin</p>
    <ul class="menu-list">
        
        <li>
            <a href="/administration/deployment"
                class="">
                Deployment
            </a>
        </li>
        
        <li>
            <a href="/administration/config"
                class="">
                Configurations
            </a>
        </li>
        
        <li>
            <a href="/administration/rebalance"
                class="is-active">
                Rebalance
            </a>
        </li>
        
        <li>
            <a href="/administration/monitoring"
                class="">
                Monitoring
            </a>
        </li>
        
        <li>
            <a href="/administration/rolling-update"
                class="">
                Rolling Restart and Upgrade
            </a>
        </li>
        
        <li>
            <a href="/administration/scale-in-out"
                class="">
                Scale-in and Scale-out
            </a>
        </li>
        
        <li>
            <a href="/administration/resource-management"
                class="">
                Resource Management
            </a>
        </li>
        
        <li>
            <a href="/administration/cold-backup"
                class="">
                Cold Backup
            </a>
        </li>
        
        <li>
            <a href="/administration/meta-recovery"
                class="">
                Metadata Recovery
            </a>
        </li>
        
        <li>
            <a href="/administration/replica-recovery"
                class="">
                Replica Data Recovery
            </a>
        </li>
        
        <li>
            <a href="/administration/zk-migration"
                class="">
                Zookeeper Migration
            </a>
        </li>
        
        <li>
            <a href="/administration/table-migration"
                class="">
                Table Migration
            </a>
        </li>
        
        <li>
            <a href="/administration/table-soft-delete"
                class="">
                Table Soft-Delete
            </a>
        </li>
        
        <li>
            <a href="/administration/table-env"
                class="">
                Table Environment Variables
            </a>
        </li>
        
        <li>
            <a href="/administration/remote-commands"
                class="">
                Remote Command
            </a>
        </li>
        
        <li>
            <a href="/administration/partition-split"
                class="">
                Partition-Split
            </a>
        </li>
        
        <li>
            <a href="/administration/duplication"
                class="">
                Duplication
            </a>
        </li>
        
        <li>
            <a href="/administration/compression"
                class="">
                Data Compression
            </a>
        </li>
        
        <li>
            <a href="/administration/throttling"
                class="">
                Throttling
            </a>
        </li>
        
        <li>
            <a href="/administration/experiences"
                class="">
                Experiences
            </a>
        </li>
        
        <li>
            <a href="/administration/manual-compact"
                class="">
                Manual Compact
            </a>
        </li>
        
        <li>
            <a href="/administration/usage-scenario"
                class="">
                Usage Scenario
            </a>
        </li>
        
        <li>
            <a href="/administration/bad-disk"
                class="">
                Bad Disk Repair
            </a>
        </li>
        
        <li>
            <a href="/administration/whitelist"
                class="">
                Replica Server Whitelist
            </a>
        </li>
        
        <li>
            <a href="/administration/backup-request"
                class="">
                Backup Request
            </a>
        </li>
        
        <li>
            <a href="/administration/hotspot-detection"
                class="">
                Hotspot Detection
            </a>
        </li>
        
    </ul>
    
</aside>
            </div>
        </div>

        <!-- main section -->
        <div class="dashboard-main is-scrollable">
            <nav class="navbar is-hidden-desktop">
    <div class="navbar-brand">
        <a href="/" class="navbar-item">
            <!-- Pegasus Icon -->
            <img src="/assets/images/pegasus-square.png">
        </a>
        <div class="navbar-item">
            

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-light is-outlined is-inverted" href="/zh/administration/rebalance"><strong>中</strong></a>

        </div>
        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
            <!-- Appears in mobile mode only -->
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>
    <div class="navbar-menu" id="navMenu">
        <div class="navbar-end">
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        The Pegasus documentation
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/downloads"
                        class="navbar-item ">
                        Downloads
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Building Pegasus
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/build/compile-by-docker"
                        class="navbar-item ">
                        Compile by docker (recommended)
                    </a>
                    
                    <a href="/docs/build/compile-from-source"
                        class="navbar-item ">
                        Compile from source
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Client Libs
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/clients/java-client"
                        class="navbar-item ">
                        Java Client
                    </a>
                    
                    <a href="/clients/cpp-client"
                        class="navbar-item ">
                        C++ Client
                    </a>
                    
                    <a href="https://github.com/apache/incubator-pegasus/tree/master/go-client"
                        class="navbar-item ">
                        Golang Client
                    </a>
                    
                    <a href="/clients/python-client"
                        class="navbar-item ">
                        Python Client
                    </a>
                    
                    <a href="/clients/node-client"
                        class="navbar-item ">
                        NodeJS Client
                    </a>
                    
                    <a href="/clients/scala-client"
                        class="navbar-item ">
                        Scala Client
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Tools
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/docs/tools/shell"
                        class="navbar-item ">
                        Pegasus Shell
                    </a>
                    
                    <a href="https://github.com/pegasus-kv/admin-cli"
                        class="navbar-item ">
                        Admin CLI
                    </a>
                    
                    <a href="https://github.com/pegasus-kv/pegic"
                        class="navbar-item ">
                        Pegasus data access CLI
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        API
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/api/ttl"
                        class="navbar-item ">
                        TTL(Time To Live)
                    </a>
                    
                    <a href="/api/single-atomic"
                        class="navbar-item ">
                        Single-Atomic Operations
                    </a>
                    
                    <a href="/api/redis"
                        class="navbar-item ">
                        Redis Adaption
                    </a>
                    
                    <a href="/api/geo"
                        class="navbar-item ">
                        GEO Support
                    </a>
                    
                    <a href="/api/http"
                        class="navbar-item ">
                        HTTP API
                    </a>
                    
                </div>
            </div>
            
            <!--dropdown-->
            <div class="navbar-item has-dropdown is-hoverable">
                <a href=""
                    class="navbar-link ">
                    <span>
                        Admin
                    </span>
                </a>
                <div class="navbar-dropdown">
                    
                    <a href="/administration/deployment"
                        class="navbar-item ">
                        Deployment
                    </a>
                    
                    <a href="/administration/config"
                        class="navbar-item ">
                        Configurations
                    </a>
                    
                    <a href="/administration/rebalance"
                        class="navbar-item is-active">
                        Rebalance
                    </a>
                    
                    <a href="/administration/monitoring"
                        class="navbar-item ">
                        Monitoring
                    </a>
                    
                    <a href="/administration/rolling-update"
                        class="navbar-item ">
                        Rolling Restart and Upgrade
                    </a>
                    
                    <a href="/administration/scale-in-out"
                        class="navbar-item ">
                        Scale-in and Scale-out
                    </a>
                    
                    <a href="/administration/resource-management"
                        class="navbar-item ">
                        Resource Management
                    </a>
                    
                    <a href="/administration/cold-backup"
                        class="navbar-item ">
                        Cold Backup
                    </a>
                    
                    <a href="/administration/meta-recovery"
                        class="navbar-item ">
                        Metadata Recovery
                    </a>
                    
                    <a href="/administration/replica-recovery"
                        class="navbar-item ">
                        Replica Data Recovery
                    </a>
                    
                    <a href="/administration/zk-migration"
                        class="navbar-item ">
                        Zookeeper Migration
                    </a>
                    
                    <a href="/administration/table-migration"
                        class="navbar-item ">
                        Table Migration
                    </a>
                    
                    <a href="/administration/table-soft-delete"
                        class="navbar-item ">
                        Table Soft-Delete
                    </a>
                    
                    <a href="/administration/table-env"
                        class="navbar-item ">
                        Table Environment Variables
                    </a>
                    
                    <a href="/administration/remote-commands"
                        class="navbar-item ">
                        Remote Command
                    </a>
                    
                    <a href="/administration/partition-split"
                        class="navbar-item ">
                        Partition-Split
                    </a>
                    
                    <a href="/administration/duplication"
                        class="navbar-item ">
                        Duplication
                    </a>
                    
                    <a href="/administration/compression"
                        class="navbar-item ">
                        Data Compression
                    </a>
                    
                    <a href="/administration/throttling"
                        class="navbar-item ">
                        Throttling
                    </a>
                    
                    <a href="/administration/experiences"
                        class="navbar-item ">
                        Experiences
                    </a>
                    
                    <a href="/administration/manual-compact"
                        class="navbar-item ">
                        Manual Compact
                    </a>
                    
                    <a href="/administration/usage-scenario"
                        class="navbar-item ">
                        Usage Scenario
                    </a>
                    
                    <a href="/administration/bad-disk"
                        class="navbar-item ">
                        Bad Disk Repair
                    </a>
                    
                    <a href="/administration/whitelist"
                        class="navbar-item ">
                        Replica Server Whitelist
                    </a>
                    
                    <a href="/administration/backup-request"
                        class="navbar-item ">
                        Backup Request
                    </a>
                    
                    <a href="/administration/hotspot-detection"
                        class="navbar-item ">
                        Hotspot Detection
                    </a>
                    
                </div>
            </div>
            
        </div>
    </div>
</nav>

<nav class="navbar is-hidden-mobile">
    <div class="navbar-start w-full">
        <div class="navbar-item pl-0 w-full">
            <!--TODO(wutao): Given the limitation of docsearch that couldn't handle multiple input,
                I make searchbox only shown in desktop. Fix this issue when docsearch.js v3 released.
                Related issue: https://github.com/algolia/docsearch/issues/230-->
            <div id="docsearch"></div>
        </div>
    </div>
    <div class="navbar-end">
        <div class="navbar-item">
            

<!--A simple language switch button that only supports zh and en.-->
<!--IF its language is zh, then switches to en.-->

<a class="button is-light is-outlined is-inverted" href="/zh/administration/rebalance"><strong>中</strong></a>

        </div>
    </div>
</nav>

            <section class="hero is-info lg:mr-3">
                <div class="hero-body">
                    
                    <p class="title is-size-2 is-centered">Rebalance</p>
                </div>
            </section>
            <section class="section" style="padding-top: 2rem;">
                <div class="content">
                    <p>This document mainly introduces the concepts, usage, and design of rebalance in Pegasus.</p>

<h2 id="concept-section">Concept Section</h2>
<p>In Pegasus, rebalance mainly includes the following aspects:</p>
<ol>
  <li>If a partition has less than 3 replicas (1 primary and 2 secondaries), a node needs to be selected to complete the missing replicas. This process in Pegasus is called <code class="language-plaintext highlighter-rouge">cure</code>.</li>
  <li>After all partitions have 3 replicas each, all replicas need to be distributed evenly across the replica servers. This process in Pegasus is called <code class="language-plaintext highlighter-rouge">balance</code>.</li>
  <li>If a replica server has multiple disks mounted and provided to Pegasus through the configuration file <code class="language-plaintext highlighter-rouge">data_dirs</code>, the replica server should try to keep the number of replicas on each disk at a similar level.</li>
</ol>

<p>Based on these points, Pegasus has introduced some concepts to conveniently describe these situations:</p>
<ol>
  <li>The Health Status of Partition
Pegasus has defined several health statuses for partitions:
    <ul>
      <li>【fully healthy】: Healthy, fully meeting the requirement of one primary and two secondaries.</li>
      <li>【unreadable】: The partition is unreadable. It means that the partition lacks a primary, but there is one or two secondaries.</li>
      <li>【readable but unwritable】: The partition is readable but not writable. It means that only one primary remains, and both secondary replicas are lost.</li>
      <li>【readable and writable but unhealthy】: The partition is both readable and writable, but still not healthy. It means that one secondary is missing among the three replicas.</li>
      <li>【dead】: All replicas of the partition are unavailable, also known as the DDD state.
<img src="/assets/images/pegasus-healthy-status.png" alt="pegasus-healthy-status" class="img-responsive" /></li>
    </ul>

    <p>When checking the status of the cluster, tables, and partitions through the Pegasus shell, you will often see the overall statistics or individual descriptions of the health conditions of the partitions. For example, by using the <code class="language-plaintext highlighter-rouge">ls -d</code> command, you can see the number of partitions in different health conditions for each table, including the following:</p>
    <ul>
      <li>fully_healthy: Completely healthy.</li>
      <li>unhealthy: Not completely healthy.</li>
      <li>write_unhealthy: Unwritable, including the above-mentioned readable but unwritable and dead states.</li>
      <li>read_unhealthy: Unreadable, including the above-mentioned unreadable and dead states.</li>
    </ul>
  </li>
  <li>The Operating Level of the Meta Server<br />
The operating level of the meta server determines the extent to which the meta server will manage the entire distributed system.<br />
The most commonly used operating levels include:
    <ul>
      <li>blind: Under this operating level, the meta_server rejects any operation that may modify the status of the metadata. This level is generally used when migrating Zookeeper.</li>
      <li>steady: Under this operating level, the meta server only performs cure, that is, it only processes unhealthy partitions.</li>
      <li>lively: Under this operating level, once all partitions have become healthy, the meta server will attempt to perform balance to adjust the number of replicas on each machine.</li>
    </ul>
  </li>
</ol>

<h2 id="operation-section">Operation Section</h2>

<h3 id="observing-the-system-status">Observing the System Status</h3>

<p>You can observe the partition status of the system through the Pegasus shell client:</p>

<ol>
  <li>
    <p>nodes -d</p>

    <p>It can be used to observe the number of replicas on each node in the system:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; nodes -d
address              status              replica_count       primary_count       secondary_count
10.132.5.1:32801     ALIVE               54                  18                  36
10.132.5.2:32801     ALIVE               54                  18                  36
10.132.5.3:32801     ALIVE               54                  18                  36
10.132.5.5:32801     ALIVE               54                  18                  36
</code></pre></div>    </div>

    <p>If the number of partitions on each node varies significantly, you can use the command “set_meta_level lively” to make adjustments.</p>
  </li>
  <li>
    <p>app <table_name> -d</table_name></p>

    <p>It can be used to view the distribution of all partitions of a certain table: You can observe the composition of a specific partition, and also summarize the number of partitions of this table served by each node.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; app temp -d
[Parameters]
app_name: temp
detailed: true
   
[Result]
app_name          : temp
app_id            : 14
partition_count   : 8
max_replica_count : 3
details           :
pidx      ballot    replica_count       primary                                 secondaries
0         22344     3/3                 10.132.5.2:32801                        [10.132.5.3:32801,10.132.5.5:32801]
1         20525     3/3                 10.132.5.3:32801                        [10.132.5.2:32801,10.132.5.5:32801]
2         19539     3/3                 10.132.5.1:32801                        [10.132.5.3:32801,10.132.5.5:32801]
3         18819     3/3                 10.132.5.5:32801                        [10.132.5.3:32801,10.132.5.1:32801]
4         18275     3/3                 10.132.5.5:32801                        [10.132.5.2:32801,10.132.5.1:32801]
5         18079     3/3                 10.132.5.3:32801                        [10.132.5.2:32801,10.132.5.1:32801]
6         17913     3/3                 10.132.5.2:32801                        [10.132.5.1:32801,10.132.5.5:32801]
7         17692     3/3                 10.132.5.1:32801                        [10.132.5.3:32801,10.132.5.2:32801]
   
node                                    primary   secondary total
10.132.5.1:32801                        2         4         6
10.132.5.2:32801                        2         4         6
10.132.5.3:32801                        2         4         6
10.132.5.5:32801                        2         4         6
                                        8         16        24
   
fully_healthy_partition_count   : 8
unhealthy_partition_count       : 0
write_unhealthy_partition_count : 0
read_unhealthy_partition_count  : 0
   
list app temp succeed
</code></pre></div>    </div>
  </li>
  <li>
    <p>server_stat</p>

    <p>It can be used to observe some current monitoring data of each replica server. If you want to analyze the balance degree of the traffic, you should focus on observing the QPS and latency of each operation. For the nodes with obviously abnormal data values (showing a large difference from other nodes), it is necessary to check whether the number of partitions is unevenly distributed, or whether there is a read-write hot spot for a certain partition.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; server_stat -t replica-server
COMMAND: server-stat
   
CALL [replica-server] [10.132.5.1:32801] succeed: manual_compact_enqueue_count=0, manual_compact_running_count=0, closing_replica_count=0, disk_available_max_ratio=88, disk_available_min_ratio=78, disk_available_total_ratio=85, disk_capacity_total(MB)=8378920, opening_replica_count=0, serving_replica_count=54, commit_throughput=0, learning_count=0, shared_log_size(MB)=4, memused_res(MB)=2499, memused_virt(MB)=4724, get_p99(ns)=0, get_qps=0, multi_get_p99(ns)=0, multi_get_qps=0, multi_put_p99(ns)=0, multi_put_qps=0, put_p99(ns)=0, put_qps=0
CALL [replica-server] [10.132.5.2:32801] succeed: manual_compact_enqueue_count=0, manual_compact_running_count=0, closing_replica_count=0, disk_available_max_ratio=88, disk_available_min_ratio=79, disk_available_total_ratio=86, disk_capacity_total(MB)=8378920, opening_replica_count=0, serving_replica_count=54, commit_throughput=0, learning_count=0, shared_log_size(MB)=4, memused_res(MB)=2521, memused_virt(MB)=4733, get_p99(ns)=0, get_qps=0, multi_get_p99(ns)=0, multi_get_qps=0, multi_put_p99(ns)=0, multi_put_qps=0, put_p99(ns)=0, put_qps=0
CALL [replica-server] [10.132.5.3:32801] succeed: manual_compact_enqueue_count=0, manual_compact_running_count=0, closing_replica_count=0, disk_available_max_ratio=90, disk_available_min_ratio=78, disk_available_total_ratio=85, disk_capacity_total(MB)=8378920, opening_replica_count=0, serving_replica_count=54, commit_throughput=0, learning_count=0, shared_log_size(MB)=4, memused_res(MB)=2489, memused_virt(MB)=4723, get_p99(ns)=0, get_qps=0, multi_get_p99(ns)=0, multi_get_qps=0, multi_put_p99(ns)=0, multi_put_qps=0, put_p99(ns)=0, put_qps=0
CALL [replica-server] [10.132.5.5:32801] succeed: manual_compact_enqueue_count=0, manual_compact_running_count=0, closing_replica_count=0, disk_available_max_ratio=88, disk_available_min_ratio=82, disk_available_total_ratio=85, disk_capacity_total(MB)=8378920, opening_replica_count=0, serving_replica_count=54, commit_throughput=0, learning_count=0, shared_log_size(MB)=4, memused_res(MB)=2494, memused_virt(MB)=4678, get_p99(ns)=0, get_qps=0, multi_get_p99(ns)=0, multi_get_qps=0, multi_put_p99(ns)=0, multi_put_qps=0, put_p99(ns)=0, put_qps=0
   
Succeed count: 4
Failed count: 0
</code></pre></div>    </div>
  </li>
  <li>
    <p>app_stat -a <app_name></app_name></p>

    <p>It can be used to observe the statistical information of each partition in a certain table. For the partitions with obviously abnormal data values, attention should be paid to whether there is a partition hot spot.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; app_stat -a temp
pidx                 GET   MULTI_GET         PUT   MULTI_PUT         DEL   MULTI_DEL        INCR         CAS        SCAN     expired    filtered    abnormal  storage_mb  file_count
0                      0           0           0           0           0           0           0           0           0           0           0           0           0           3
1                      0           0           0           0           0           0           0           0           0           0           0           0           0           1
2                      0           0           0           0           0           0           0           0           0           0           0           0           0           4
3                      0           0           0           0           0           0           0           0           0           0           0           0           0           2
4                      0           0           0           0           0           0           0           0           0           0           0           0           0           3
5                      0           0           0           0           0           0           0           0           0           0           0           0           0           2
6                      0           0           0           0           0           0           0           0           0           0           0           0           0           1
7                      0           0           0           0           0           0           0           0           0           0           0           0           0           3
                       0           0           0           0           0           0           0           0           0           0           0           0           0          19
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="controlling-the-load-balancing-of-the-cluster">Controlling the Load Balancing of the Cluster</h3>

<p>Peagsus provides the following commands to control the load balancing of the cluster:</p>

<ol>
  <li>
    <p>set_meta_level</p>

    <p>This command is used to control the operating level of the meta, and the following levels are supported:</p>
    <ul>
      <li>freezed：The meta server will stop the cure work for unhealthy partitions. It is generally used when there are many nodes crashing or the cluster is extremely unstable. In addition, if the number of nodes in the cluster drops below a certain quantity or proportion (controlled by the configuration files min_live_node_count_for_unfreeze and node_live_percentage_threshold_for_update), it will automatically change to the freezed state and wait for manual intervention.</li>
      <li>steady：The default level of the meta server. It only performs the cure operation and does not perform the balance operation.</li>
      <li>lively：The meta server will adjust the number of replicas to strive for balance.</li>
    </ul>

    <p>You can use either cluster_info or get_meta_level to check the current operating level of the cluster.</p>

    <p>Some Suggestions for Adjustment:</p>
    <ul>
      <li>First, use the nodes -d command in the shell to check whether the cluster is balanced, and then make adjustments when it is unbalanced. Usually, after the following situations occur, it is necessary to enable the lively mode for adjustment:
        <ul>
          <li>When a new table is created, the number of replicas may be uneven at this time.</li>
          <li>When nodes are launched, taken offline, or upgraded in the cluster, the number of replicas may also be uneven.</li>
          <li>When a node crashes and some replicas are migrated to other nodes.</li>
        </ul>
      </li>
      <li>The adjustment process will trigger replica migration, which will affect the availability of the cluster. Although the impact is not significant, if the requirement for availability is very high and the adjustment demand is not urgent, it is recommended to make the adjustment during the <strong>low-peak period</strong>.</li>
      <li>After the adjustment is completed, reset the level to the steady state by using the <code class="language-plaintext highlighter-rouge">set_meta_level steady</code> command to avoid unnecessary replica migration during normal times and reduce cluster jitter.</li>
      <li>Pegasus also provides some commands for fine-grained control of balance. Please refer to <a href="#advanced-options-for-load-balancing">Advanced Options for Load Balancing</a>.</li>
    </ul>
  </li>
  <li>
    <p>balance</p>

    <p>The balance command is used to manually send commands for replica migration. The supported migration types are:</p>
    <ul>
      <li>move_pri: Swap the primary and secondary of a certain partition (essentially in two steps: 1. Downgrade the “from” node; 2. Upgrade the “to” node. If the meta server goes down after the first step is completed, the new meta server will not continue with the second step, and the move_pri command can be regarded as interrupted).</li>
      <li>copy_pri: Migrate the primary of a certain partition to a new node.</li>
      <li>copy_sec: Migrate the secondary of a certain partition to a new node.</li>
    </ul>

    <p><strong>Note that when using these commands, ensure that the meta server is in the steady state; otherwise, the commands will not take effect.</strong></p>

    <p>Please refer to the following examples (irrelevant outputs have been deleted):</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; get_meta_level
current meta level is fl_steady
   
&gt;&gt;&gt; app temp -d
pidx      ballot    replica_count       primary                                 secondaries
0         3         3/3                 10.231.58.233:34803                     [10.231.58.233:34802,10.231.58.233:34801]
   
list app temp succeed
   
&gt;&gt;&gt; balance -g 1.0 -p move_pri -f 10.231.58.233:34803 -t 10.231.58.233:34802
send balance proposal result: ERR_OK
   
&gt;&gt;&gt; app temp -d
pidx      ballot    replica_count       primary                                 secondaries
0         5         3/3                 10.231.58.233:34802                     [10.231.58.233:34801,10.231.58.233:34803]
list app temp succeed
</code></pre></div>    </div>
  </li>
  <li>
    <p>propose</p>

    <p>The propose command is used to send replica adjustment commands at a lower primitive level, mainly including the following types:</p>
    <ul>
      <li>assign_primary：Assign the primary of a certain partition to a specific machine</li>
      <li>upgrade_to_primary：Upgrade the secondary of a certain partition to a primary</li>
      <li>add_secondary: Add a secondary for a certain partition</li>
      <li>upgrade_to_secondary: Upgrade a certain learner under a partition to a secondary</li>
      <li>downgrade_to_secondary：Downgrade the primary under a certain partition to a secondary</li>
      <li>downgrade_to_inactive：Downgrade the primary/secondary under a certain partition to an inactive state</li>
      <li>remove：Remove a certain replica under a certain partition</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; app temp -d
pidx      ballot    replica_count       primary                                 secondaries                             
0         5         3/3                 10.231.58.233:34802                     [10.231.58.233:34801,10.231.58.233:34803]
list app temp succeed
&gt;&gt;&gt; propose -g 1.0 -p downgrade_to_inactive -t 10.231.58.233:34802 -n 10.231.58.233:34801
send proposal response: ERR_OK
&gt;&gt;&gt; app temp -d
pidx      ballot    replica_count       primary                                 secondaries                             
0         7         3/3                 10.231.58.233:34802                     [10.231.58.233:34803,10.231.58.233:34801]
list app temp succeed
</code></pre></div>    </div>

    <p>In the above example, the propose command aims to downgrade 10.231.38.233:34801. Therefore, this command needs to be sent to the primary (10.231.58.233:34802) of the partition, and it will execute the specific matter of downgrading a certain replica. Note that this reflects the design concept of the Pegasus system: <strong>The meta server is responsible for managing the primary, and the primary is responsible for managing other replicas under the partition</strong>.</p>

    <p>In the above example, there may not be an obvious sign that 10.231.38.233:34801 has been downgraded. This is due to the existence of the system’s cure function, which will quickly repair an unhealthy partition. You can confirm that the command has taken effect by observing the changes in the ballot.</p>

    <p>Under normal circumstances, you shouldn’t need to use the propose command.</p>
  </li>
</ol>

<h3 id="advanced-options-for-load-balancing">Advanced Options for Load Balancing</h3>

<p>The meta server provides some more fine-grained parameters for load balancing control. These parameters are adjusted through the remote_command command:</p>

<h4 id="you-can-use-the-help-command-to-view-all-the-remote_command-options-available">You can use the help command to view all the remote_command options available.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; remote_command -l 127.0.0.1:34601 help
COMMAND: help

CALL [user-specified] [127.0.0.1:34601] succeed: help|Help|h|H [command] - display help information
repeat|Repeat|r|R interval_seconds max_count command - execute command periodically
...
meta.lb.assign_delay_ms [num | DEFAULT]
meta.lb.assign_secondary_black_list [&lt;ip:port,ip:port,ip:port&gt;|clear]
meta.lb.balancer_in_turn &lt;true|false&gt;
meta.lb.only_primary_balancer &lt;true|false&gt;
meta.lb.only_move_primary &lt;true|false&gt;
meta.lb.add_secondary_enable_flow_control &lt;true|false&gt;
meta.lb.add_secondary_max_count_for_one_node [num | DEFAULT]
...

Succeed count: 1
Failed count: 0
</code></pre></div></div>

<p><a href="https://github.com/apache/incubator-pegasus/blob/master/src/utils/command_manager.h">remote_command</a>The remote_command is a feature of Pegasus, which allows a server to register some commands, and then the command line can call these commands through RPC. Here, we use the <code class="language-plaintext highlighter-rouge">help</code> command to access the meta server leader and obtain all the commands supported on the meta server. In the example, all irrelevant lines have been omitted, leaving only all the commands related to load balancing that start with “meta.lb”.</p>

<p>Due to the inconsistency between the documentation and the code, the documentation may not necessarily cover all the current load balancing (lb) control commands of the meta. If you want to obtain the latest command list, please manually execute the <code class="language-plaintext highlighter-rouge">help</code> command using the latest code.</p>

<h4 id="assign_delay_ms">assign_delay_ms</h4>

<p>The <code class="language-plaintext highlighter-rouge">assign_delay_ms</code> is used to control <strong>how long we should delay before selecting a new secondary when a partition lacks one</strong>. The reason for this is that the disconnection of a replica may be temporary. If a new secondary is selected without providing a certain buffer period, it may lead to a huge amount of data copying.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; remote_command -t meta-server meta.lb.assign_delay_ms
COMMAND: meta.lb.assign_delay_ms
CALL [meta-server] [127.0.0.1:34601] succeed: 300000
CALL [meta-server] [127.0.0.1:34602] succeed: unknown command 'meta.lb.assign_delay_ms'
CALL [meta-server] [127.0.0.1:34603] succeed: unknown command 'meta.lb.assign_delay_ms'
Succeed count: 3
Failed count: 0
&gt;&gt;&gt; remote_command -t meta-server meta.lb.assign_delay_ms 10
COMMAND: meta.lb.assign_delay_ms 10
CALL [meta-server] [127.0.0.1:34601] succeed: OK
CALL [meta-server] [127.0.0.1:34602] succeed: unknown command 'meta.lb.assign_delay_ms'
CALL [meta-server] [127.0.0.1:34603] succeed: unknown command 'meta.lb.assign_delay_ms'
Succeed count: 3
Failed count: 0
&gt;&gt;&gt; remote_command -t meta-server meta.lb.assign_delay_ms
COMMAND: meta.lb.assign_delay_ms
CALL [meta-server] [127.0.0.1:34601] succeed: 10
CALL [meta-server] [127.0.0.1:34602] succeed: unknown command 'meta.lb.assign_delay_ms'
CALL [meta-server] [127.0.0.1:34603] succeed: unknown command 'meta.lb.assign_delay_ms'
Succeed count: 3
Failed count: 0
</code></pre></div></div>

<p>As shown in the example, when the command is executed without parameters, it indicates that the current set value will be returned. Adding parameters means specifying the expected new value.</p>

<h4 id="assign_secondary_black_list">assign_secondary_black_list</h4>

<p>This command is used to set <strong>the blacklist for adding secondaries</strong>. This command is extremely useful when taking nodes offline in batches from the cluster.</p>

<h4 id="flow-control-during-the-addition-of-secondaries">Flow Control during the Addition of Secondaries</h4>

<p>At some times, the decision algorithm of load balancing may require adding quite a few secondary replicas on one machine. For example:</p>
<ul>
  <li>The crash of one or more nodes will cause normal nodes to accept a large number of partitions instantaneously.</li>
  <li>When a new node is added, a large number of replicas may flood in.</li>
</ul>

<p>However, when executing these decision-making actions of adding replicas, we should avoid adding a large number of secondary shards simultaneously at the same moment, because:</p>
<ul>
  <li>Adding secondary replicas basically involves data copying. If the quantity is too large, it may affect normal reading and writing</li>
  <li>The total bandwidth is limited. If multiple tasks of adding replicas are sharing this bandwidth, then the execution time of each task will be prolonged. As a result, the system will be in a state where <strong>a large number of replicas are unhealthy for a long time</strong>, increasing the risk of instability.</li>
</ul>

<p>So, Pegasus uses two commands to support flow control:</p>
<ol>
  <li>meta.lb.add_secondary_enable_flow_control: It indicates whether to enable the flow control feature.</li>
  <li>meta.lb.add_secondary_max_count_for_one_node: It represents the number of add_secondary actions that can be executed simultaneously for each node.</li>
</ol>

<h4 id="fine-grained-control-of-the-balancer">Fine-grained Control of the Balancer</h4>

<p>In the current implementation of Pegasus, the balancer process can be roughly summarized in four points:</p>
<ol>
  <li>Try to achieve the balance of primaries as much as possible through role swapping.</li>
  <li>If it is not possible to make the primaries evenly distributed in step 1, achieve the balance of primaries by copying data.</li>
  <li>After step 2 is completed, achieve the balance of secondaries by copying data.</li>
  <li>Perform the actions in steps 1-2-3 for each table separately.</li>
</ol>

<p>Pegasus provides some control parameters for this process, enabling more fine-grained control:</p>
<ul>
  <li>meta.lb.only_primary_balancer: For each table, only steps 1 and 2 are carried out (reducing the data copying caused by copying secondaries).</li>
  <li>meta.lb.only_move_primary: For each table, when adjusting the primary, only consider method 1 (reducing the data copying caused by copying primaries).</li>
  <li>meta.lb.balancer_in_turn：The balancers of various tables are executed in a sequential manner instead of in parallel (used for debugging and observing the system behavior).</li>
</ul>

<h3 id="usage-examples-of-some-commands">Usage Examples of Some Commands</h3>

<p>By combining the above load balancing primitives, Pegasus provides some scripts to execute operations such as rolling upgrades and node offline processes, for example:</p>

<ol>
  <li>
    <p><a href="https://github.com/apache/incubator-pegasus/blob/master/scripts/migrate_node.sh">scripts/migrate_node.sh</a></p>

    <p>This script is used to drive away all the primaries of the services running on a certain node.</p>
  </li>
  <li>
    <p><a href="https://github.com/apache/incubator-pegasus/blob/master/scripts/pegasus_rolling_update.sh">scripts/pegasus_rolling_update.sh</a></p>

    <p>It is used to perform an online rolling upgrade on the nodes in the cluster.</p>
  </li>
  <li>
    <p><a href="https://github.com/apache/incubator-pegasus/blob/master/scripts/pegasus_offline_node_list.sh">scripts/pegasus_offline_node_list.sh</a></p>

    <p>It is used to take a batch of nodes offline.</p>
  </li>
</ol>

<p>However, the logic of some of the scripts depends on Xiaomi’s <a href="https://github.com/XiaoMi/minos">Minos Deployment System</a>。Here, it is hoped that everyone can offer assistance to Pegasus and enable it to support more deployment systems.</p>

<h2 id="cluster-level-load-balancing">Cluster-level Load Balancing</h2>
<ol>
  <li>The above descriptions all perform load balancing on a per-table basis. That is, when each table in a cluster is balanced on the replica servers, the meta server considers the entire cluster to be balanced.</li>
  <li>However, in some scenarios, especially when there are a large number of replica server nodes in the cluster and there are a large number of tables with <strong>small replicas</strong> in the cluster, even if each table is balanced, the entire cluster is not balanced.</li>
  <li>Starting from version 2.3.0, Pegasus supports cluster-level load balancing, ensuring that the number of replicas in the entire cluster is balanced without changing the balance of the tables.</li>
</ol>

<p>The usage method is the same as the method described above, and it supports all the commands mentioned above.<br />
If you need to use cluster-level load balancing, you need to modify the following configurations:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[meta_server]]
   balance_cluster = ture  // default is false
</code></pre></div></div>

<h2 id="design-section">Design Section</h2>
<p>In the current implementation of the Pegasus balancer, the meta server will regularly evaluate the replica distribution across of all replica servers. When it deems that the replicas are unevenly distributed across nodes, it will migrate the corresponding replicas.
The factors that need to be considered during the decision-making process of the balancer are as follows:</p>
<ul>
  <li>For any table, the partitions should be evenly distributed across nodes, which includes the following aspects:
    <ul>
      <li>The three replicas of a certain partition cannot all be located on one node.</li>
      <li>The number of primaries should be evenly distributed.</li>
      <li>The number of secondaries should also be evenly distributed.</li>
    </ul>
  </li>
  <li>When it is found that the distribution of primaries is uneven, the first strategy to be considered should be to switch the roles of the primaries, rather than directly performing data copying.</li>
  <li>Not only should the load balancing between nodes be considered, but also the number of replicas on each disk within a node should be balanced as much as possible.</li>
</ul>

<h3 id="move_primary">Move_Primary</h3>
<p>When the distribution of primaries is uneven, the first strategy to be considered is to perform role switching. That is to say, it is necessary to find a path to migrate the primaries from the “side with more primaries” to the “side with fewer primaries”. Taking the number of migrated primaries as the traffic, it is natural for us to think of the Ford-Fulkerson algorithm, which is as follows:</p>
<ol>
  <li>Find an augmenting path from the source to the sink.</li>
  <li>Modify the weights of each edge according to the augmenting path to form a residual network.</li>
  <li>Continue with step 1 in the residual network until no augmenting path can be found.</li>
</ol>

<p>However, we cannot directly apply the Ford-Fulkerson algorithm. The reason is that in step 2, according to the Ford-Fulkerson algorithm, an edge with a weight of x on the augmenting path means that the number of primaries flowing from A to B is x. At this time, when forming the residual network, the weight of this edge needs to be subtracted by x. However, the weight of its reverse edge also increases by x simultaneously(the function of the reverse edge is to provide an opportunity for adjustment. Since the previously formed augmenting path is likely not the maximum flow, the reverse edge is used to adjust the previously formed augmenting path. For details, refer to the Ford-Fulkerson algorithm). But in our model, it is unreasonable for the reverse edge to increase by x. For example, for Partition[Primary: A, Secondary: (B, C)], when the primary flows from A to B, and finally the partition becomes [Primary: B, Secondary: (A, C)], this means that:</p>
<ol>
  <li>The flow from A to B decreases.</li>
  <li>The flow from A to C decreases.</li>
  <li>The flow from B to A increases.</li>
  <li>The flow from B to C increases.</li>
</ol>

<p>This is obviously different from the weight change of the reverse edge in the residual network of the Ford-Fulkerson algorithm. Therefore, we modify the algorithm as follows:</p>
<ol>
  <li>Generate a graph structure according to the current partition distribution, and find an augmenting path according to the Ford-Fulkerson algorithm.</li>
  <li>Based on the found augmenting path, construct the decision-making action for the primary role switch, and execute this action in the cluster to generate a new partition distribution.</li>
  <li>According to the new partition distribution, iterate step 1 until no augmenting path can be found.</li>
</ol>

<p>As can be seen from the above, this algorithm mainly modifies step 2, and it is not as simple as modifying the edge weights like in the Ford-Fulkerson algorithm.</p>

<p>NOTE：When we execute the Ford-Fulkerson algorithm for primary migration, it is carried out for a single table. That is to say, constructing the network and performing the role switch are all targeted at a single table. When it comes to migrating multiple tables, we just need to loop through and execute the above process for each of all the tables.</p>

<h3 id="copy_primary">Copy_Primary</h3>
<p>When an augmenting path cannot be successfully obtained, it indicates that simply achieving load balancing through role switching is no longer possible, and it is necessary to achieve it by migrating the Primary. The implementation of the Primary migration algorithm is relatively simple, and its specific execution steps are as follows:</p>
<ol>
  <li>Sort the nodes in ascending order according to the number of Primaries to obtain the pri_queue.</li>
  <li>In the pri_queue, id_min always points to the head node of the pri_queue, and id_max always points to the tail node of the pri_queue, as shown in the following figure:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> +------+------+------+------+------+------+------+------+
 |                                                       |
 V                                                       V
id_min                                                  id_max
</code></pre></div>    </div>
  </li>
  <li>For all the Primaries on the current id_max, find their corresponding disks respectively and obtain the disk loads. Select the disk with the maximum load and its corresponding Primary for migration.</li>
  <li>Increment the number of Primaries pointed to by the current id_min by 1 and decrement the number of Primaries pointed to by the current id_max by 1 respectively. Re-sort the nodes, and then loop through and execute the above steps until the number of Primaries on the id_min node is greater than or equal to N/M. At this point, it indicates that the balance has been achieved.</li>
</ol>

<h3 id="copy_secondary">Copy_Secondary</h3>
<p>The above has explained the load balancing of Primaries. Certainly, the load balancing of Secondaries is also necessary. Otherwise, it may occur that the Primaries on different nodes are balanced, but the total number of replicas is unbalanced. Since the role switching has already been carried out during the Primary migration, the Secondary migration is not as complicated as that of the Primaries, and there is no need to consider the issue of role switching. At this time, direct copying is sufficient. Therefore, for the load balancing of Secondaries, the same algorithm as that for copying Primaries is directly adopted, and the details will not be repeated here. Similarly, the load balancing of Secondaries also needs to be carried out for all tables separately.</p>

<p>NOTE： The above operations of constructing the graph, finding the augmenting path, Move_Primary, Copy_Primary, and Copy_Secondary are all carried out for a single table. For multiple tables in the cluster, the above steps need to be executed once for each table.</p>

                </div>
            </section>
            <footer class="footer">
    <div class="container">
        <div class="content is-small has-text-centered">
            <div style="margin-bottom: 20px;">
                <a href="http://incubator.apache.org">
                    <img src="/assets/images/egg-logo.png"
                         width="15%"
                         alt="Apache Incubator"/>
                </a>
            </div>
            Copyright &copy; 2023 <a href="http://www.apache.org">The Apache Software Foundation</a>.
            Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version
            2.0</a>.
            <br><br>
            
            Apache Pegasus is an effort undergoing incubation at The Apache Software Foundation (ASF),
            sponsored by the Apache Incubator. Incubation is required of all newly accepted projects
            until a further review indicates that the infrastructure, communications, and decision making process
            have stabilized in a manner consistent with other successful ASF projects. While incubation status is
            not necessarily a reflection of the completeness or stability of the code, it does indicate that the
            project has yet to be fully endorsed by the ASF.
            
            <br><br>
            Apache Pegasus, Pegasus, Apache, the Apache feather logo, and the Apache Pegasus project logo are either
            registered trademarks or trademarks of The Apache Software Foundation in the United States and other
            countries.
        </div>
    </div>
</footer>
        </div>

        <!-- right panel -->
        <div class="dashboard-panel is-small is-scrollable is-hidden-mobile">
            <p class="menu-label">
    <span class="icon">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </span>
    Table of contents
</p>
<ul class="menu-list">
  <li><a href="#concept-section">Concept Section</a></li>
  <li><a href="#operation-section">Operation Section</a>
    <ul>
      <li><a href="#observing-the-system-status">Observing the System Status</a></li>
      <li><a href="#controlling-the-load-balancing-of-the-cluster">Controlling the Load Balancing of the Cluster</a></li>
      <li><a href="#advanced-options-for-load-balancing">Advanced Options for Load Balancing</a>
        <ul>
          <li><a href="#you-can-use-the-help-command-to-view-all-the-remote_command-options-available">You can use the help command to view all the remote_command options available.</a></li>
          <li><a href="#assign_delay_ms">assign_delay_ms</a></li>
          <li><a href="#assign_secondary_black_list">assign_secondary_black_list</a></li>
          <li><a href="#flow-control-during-the-addition-of-secondaries">Flow Control during the Addition of Secondaries</a></li>
          <li><a href="#fine-grained-control-of-the-balancer">Fine-grained Control of the Balancer</a></li>
        </ul>
      </li>
      <li><a href="#usage-examples-of-some-commands">Usage Examples of Some Commands</a></li>
    </ul>
  </li>
  <li><a href="#cluster-level-load-balancing">Cluster-level Load Balancing</a></li>
  <li><a href="#design-section">Design Section</a>
    <ul>
      <li><a href="#move_primary">Move_Primary</a></li>
      <li><a href="#copy_primary">Copy_Primary</a></li>
      <li><a href="#copy_secondary">Copy_Secondary</a></li>
    </ul>
  </li>
</ul>

        </div>
    </div>

    <script src="/assets/js/app.js" type="text/javascript"></script>
     <script>
     docsearch({
         container: '#docsearch',
         appId: 'QRN30RBW0S',
         indexName: 'pegasus-apache',
         apiKey: 'd3a3252fa344359766707a106c4ed88f',
         debug: true
     });
 </script>

</body>

</html>